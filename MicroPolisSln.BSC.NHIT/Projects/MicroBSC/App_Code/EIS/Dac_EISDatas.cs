using System;
using System.Data;
using System.Configuration;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

using MicroBSC.Data;

namespace MicroBSC.EIS.Dac
{
    public class Dac_EISDatas : DbAgentBase
    {
        #region =================== 공통 ===============================

        public DataTable GetEISMain()
        {
            string query = @"SELECT    M_ID
                                      ,DEPT_REF_ID
                                      ,M_NAME
                                  FROM EIS_MAIN_ITEM";

			DataSet ds = DbAgentObj.FillDataSet( query, "CTRLINFOGET" , null, null, CommandType.Text);
			return ds.Tables[0];
        }

        public DataTable GetEISSub(int m_id, int s_id)
        {
            string query = @"SELECT   MP.M_ID
	                                , M.M_NAME
	                                , MP.S_ID
	                                , S.S_NAME
	                                , MP.SORT_ORDER
	                                , MP.MULTI_YMD_YN
	                                , MP.TITLE_NAME
	                                , MP.PAGE_NAME
	                                FROM     EIS_MAIN_SUB_MAP   MP
		                                JOIN EIS_MAIN_ITEM      M ON (MP.M_ID = M.M_ID)
		                                JOIN EIS_SUB_ITEM       S ON (MP.S_ID = S.S_ID)
                                WHERE    M.M_ID  = @M_ID 
                                    AND (S.S_ID = @S_ID OR @S_ID = 0)";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@M_ID", SqlDbType.Int);
            paramArray[0].Value = m_id;
            paramArray[1] 		= CreateDataParameter("@S_ID", SqlDbType.Int);
            paramArray[1].Value = s_id;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds.Tables[0];
        }

        public DataTable GetEISComment(int estterm_ref_id, string ymd, int m_id, int s_id, int area_id)
        {
            string query = @"SELECT ESTTERM_REF_ID
                                  ,YMD
                                  ,M_ID
                                  ,S_ID
                                  ,TEXT_DATA
                                  ,CREATE_DATE
                                  ,CREATE_USER
                                  ,UPDATE_DATE
                                  ,UPDATE_USER
                              FROM EIS_COMMENT
                                WHERE    
                                        ESTTERM_REF_ID  = @ESTTERM_REF_ID
                                    AND YMD             = @YMD
                                    AND M_ID            = @M_ID 
                                    AND S_ID            = @S_ID
                                    AND AREA_ID         = @AREA_ID";

            IDbDataParameter[] paramArray = CreateDataParameters(5);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;
            paramArray[2] 		= CreateDataParameter("@M_ID", SqlDbType.Int);
            paramArray[2].Value = m_id;
            paramArray[3] 		= CreateDataParameter("@S_ID", SqlDbType.Int);
            paramArray[3].Value = s_id;
            paramArray[4] 		= CreateDataParameter("@AREA_ID", SqlDbType.Int);
            paramArray[4].Value = area_id;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds.Tables[0];
        }

        public int SaveEISComment(int estterm_ref_id, string ymd, int m_id, int s_id, int area_id, string text_data, DateTime date, int user)
        {
            string query = @"

IF EXISTS (SELECT * FROM EIS_COMMENT 
				WHERE ESTTERM_REF_ID = @ESTTERM_REF_ID
					AND YMD = @YMD
					AND M_ID = @M_ID
					AND S_ID = @S_ID
                    AND AREA_ID = @AREA_ID)
	BEGIN
		UPDATE EIS_COMMENT
			SET TEXT_DATA = @TEXT_DATA
				, UPDATE_DATE = @DATE
				, UPDATE_USER = @USER
		WHERE ESTTERM_REF_ID = @ESTTERM_REF_ID
					AND YMD = @YMD
					AND M_ID = @M_ID
					AND S_ID = @S_ID
                    AND AREA_ID = @AREA_ID
	END
ELSE
	BEGIN
		INSERT INTO EIS_COMMENT (ESTTERM_REF_ID
								, YMD
								, M_ID
								, S_ID
                                , AREA_ID
								, TEXT_DATA
								, CREATE_DATE
								, CREATE_USER
								, UPDATE_DATE
								, UPDATE_USER)
								VALUES (@ESTTERM_REF_ID
								, @YMD
								, @M_ID
								, @S_ID
                                , @AREA_ID
								, @TEXT_DATA
								, @DATE
								, @USER
								, NULL
								, NULL)
	END
";
            IDbDataParameter[] paramArray = CreateDataParameters(8);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;
            paramArray[2] 		= CreateDataParameter("@M_ID", SqlDbType.Int);
            paramArray[2].Value = m_id;
            paramArray[3] 		= CreateDataParameter("@S_ID", SqlDbType.Int);
            paramArray[3].Value = s_id;
            paramArray[4] 		= CreateDataParameter("@AREA_ID", SqlDbType.Int);
            paramArray[4].Value = area_id;
            paramArray[5] 		= CreateDataParameter("@TEXT_DATA", SqlDbType.NVarChar);
            paramArray[5].Value = text_data;
            paramArray[6] 		= CreateDataParameter("@DATE", SqlDbType.DateTime);
            paramArray[6].Value = date;
            paramArray[7] 		= CreateDataParameter("@USER", SqlDbType.Int);
            paramArray[7].Value = user;

            int affectedRow = DbAgentObj.ExecuteNonQuery(query, paramArray);
            return affectedRow;
        }

        #endregion
        
        #region =================== 전사 - 총괄 ===============================

        public DataSet GetData_M_0_S_1( int estterm_ref_id
                                        , string ymd)
        {
			#region 기존쿼리
			string query_old =
@"

--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)

DECLARE @KPI_REF_ID_01 INT   -- 전사-Global매출액
DECLARE @KPI_REF_ID_03 INT   -- 전사-매출원가
DECLARE @KPI_REF_ID_04 INT   -- 전사-판관비
                             -- 
DECLARE @KPI_REF_ID_05 INT   -- DD사업부-Global매출액
DECLARE @KPI_REF_ID_06 INT   -- DD사업부-매출원가
DECLARE @KPI_REF_ID_07 INT   -- DD사업부-판관비
                             -- 
DECLARE @KPI_REF_ID_08 INT   -- DO사업부-Global매출액
DECLARE @KPI_REF_ID_09 INT   -- DO사업부-매출원가
DECLARE @KPI_REF_ID_10 INT   -- DO사업부-판관비

--SET @ESTTERM_REF_ID =999
--SET @YMD ='200912'

SET @KPI_REF_ID_01 = 3639	 -- 1367->3639로 변경(2010.07.15)
SET @KPI_REF_ID_03 = 3640	 -- 1004->3640로 변경(2010.07.15)
SET @KPI_REF_ID_04 = 3641	 -- 1472->3641로 변경(2010.07.15)

--SET @KPI_REF_ID_05= 1371    
SET @KPI_REF_ID_05= 1393    
--SET @KPI_REF_ID_06= 1375
SET @KPI_REF_ID_06= 1383
SET @KPI_REF_ID_07= 1473

SET @KPI_REF_ID_08 = 1400    
SET @KPI_REF_ID_09 = 1389
SET @KPI_REF_ID_10 = 1474


/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 03
*	2009.12.23
*	Page view  : 전사/DD/DO-총괄 (슬라이드 No.2,8,16)
*	Grid 구성
*	관련 KPI : 상위 정의 참조
*	KPI_REF_ID : 상위 정의 참조
* 
* 
**************************************************************************/

/*************
*    전사
**************/

SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,1                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END	                                    AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,2                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'				      
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-1												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익'											AS KPI_NAME 		--지표명
      ,'매출총이익'                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS-bkt2.TARGET_MS                         AS TARGET_MS		--당월목표
	  ,bkr.RESULT_MS-bkr3.RESULT_MS							AS RESULT_MS		--당월실적
	  ,CASE WHEN (bkt.TARGET_MS-bkt2.TARGET_MS)<>0
	        THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/(bkt.TARGET_MS-bkt2.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS-bkt2.TARGET_TS							AS TARGET_TS		--누계목표
	  ,bkr.RESULT_TS-bkr3.RESULT_TS							AS RESULT_TS	    --누계실적
	  ,CASE WHEN (bkt.TARGET_TS-bkt2.TARGET_TS)<>0
			THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/(bkt.TARGET_TS-bkt2.TARGET_TS))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS-bkr4.RESULT_TS						AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN (bkr2.RESULT_TS-bkr4.RESULT_TS)<>0
	        THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-(bkr2.RESULT_TS-bkr4.RESULT_TS))/(bkr2.RESULT_TS-bkr4.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,3                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_03 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-2												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익율'										AS KPI_NAME 		--지표명
      ,'매출총이익율(%)'									AS ALIAS 		    --지표명
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS)*100   
	        ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0 THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS)*100	
	        ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0 THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS))*100)/((((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS))*100))*100		
	        ELSE 0 END                                      AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN ((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100
	        ELSE 0 END                                  	AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100
	        ELSE 0 END                                   	AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS))*100)/((((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS))*100))*100
	        ELSE 0 END                              		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                   	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100)-(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))/(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,4                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_03 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                   					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                  					AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,5                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-3												    AS KPI_REF_ID   	--지표코드
      ,'영업이익'											AS KPI_NAME 		--지표명
      ,'영업이익'                                           AS ALIAS 			--지표별칭
	  ,(bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS        AS TARGET_MS		--당월목표
	  ,(bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS		AS RESULT_MS		--당월실적
	  ,CASE WHEN ((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)<>0
	        THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,(bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS    	AS TARGET_TS		--누계목표
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS    	AS RESULT_TS	    --누계실적
	  ,CASE WHEN ((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS )<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS ))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,(bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS		AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)<>0
	        THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					-((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))
						/((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,6                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID		 = @KPI_REF_ID_03 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID		 = @KPI_REF_ID_04 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND bkr5.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_04
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-4												    AS KPI_REF_ID   	--지표코드
      ,'영업이익율'											AS KPI_NAME 		--지표명
      ,'영업이익율(%)'                                      AS ALIAS 			--지표별칭
	  ,CASE WHEN bkt.TARGET_MS<>0
			THEN (((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)
					/bkt.TARGET_MS)*100  
			ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0
			THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/bkr.RESULT_MS)*100		
			ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0
	        THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)/bkr.RESULT_MS)*100)
						/((((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)/bkt.TARGET_MS)*100 ))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0
			THEN (((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)
					/bkt.TARGET_TS)*100		
			ELSE 0 END										AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/bkr.RESULT_TS)*100
			ELSE 0 END                              		AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 AND bkr.RESULT_TS<>0
			THEN (((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100)
						/((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0
			THEN (((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)
					/bkr2.RESULT_TS)*100
			ELSE 0 END                                     	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0
	        THEN ((((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100)
						-((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))
								/((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,7                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID	     = @KPI_REF_ID_03 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID	     = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND bkr5.YMD				 = bkt.YMD 
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID-1
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkt.YMD,5,6)                        
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/*************
*  DD사업부
**************/

SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,1                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END	                                    AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,2                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'				      
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-1												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익'											AS KPI_NAME 		--지표명
      ,'매출총이익'                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS-bkt2.TARGET_MS                         AS TARGET_MS		--당월목표
	  ,bkr.RESULT_MS-bkr3.RESULT_MS							AS RESULT_MS		--당월실적
	  ,CASE WHEN (bkt.TARGET_MS-bkt2.TARGET_MS)<>0
	        THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/(bkt.TARGET_MS-bkt2.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS-bkt2.TARGET_TS							AS TARGET_TS		--누계목표
	  ,bkr.RESULT_TS-bkr3.RESULT_TS							AS RESULT_TS	    --누계실적
	  ,CASE WHEN (bkt.TARGET_TS-bkt2.TARGET_TS)<>0
			THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/(bkt.TARGET_TS-bkt2.TARGET_TS))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS-bkr4.RESULT_TS						AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN (bkr2.RESULT_TS-bkr4.RESULT_TS)<>0
	        THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-(bkr2.RESULT_TS-bkr4.RESULT_TS))/(bkr2.RESULT_TS-bkr4.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,3                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_06 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_06
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-2												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익율'										AS KPI_NAME 		--지표명
      ,'매출총이익율(%)'									AS ALIAS 		    --지표명
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS)*100   
	        ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0 THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS)*100	
	        ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0 THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS))*100)/((((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS))*100))*100		
	        ELSE 0 END                                      AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN ((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100
	        ELSE 0 END                                  	AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100
	        ELSE 0 END                                   	AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS))*100)/((((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS))*100))*100
	        ELSE 0 END                              		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                   	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100)-(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))/(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,4                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_06 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_06
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                   					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                  					AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,5                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-3												    AS KPI_REF_ID   	--지표코드
      ,'영업이익'											AS KPI_NAME 		--지표명
      ,'영업이익'                                           AS ALIAS 			--지표별칭
	  ,(bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS        AS TARGET_MS		--당월목표
	  ,(bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS		AS RESULT_MS		--당월실적
	  ,CASE WHEN ((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)<>0
	        THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,(bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS    	AS TARGET_TS		--누계목표
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS    	AS RESULT_TS	    --누계실적
	  ,CASE WHEN ((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS )<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS ))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,(bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS		AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)<>0
	        THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					-((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))
						/((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,6                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID		 = @KPI_REF_ID_06 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID		 = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_07
                          AND bkr5.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_07
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-4												    AS KPI_REF_ID   	--지표코드
      ,'영업이익율'											AS KPI_NAME 		--지표명
      ,'영업이익율(%)'                                      AS ALIAS 			--지표별칭
	  ,CASE WHEN bkt.TARGET_MS<>0
			THEN (((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)
					/bkt.TARGET_MS)*100  
			ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0
			THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/bkr.RESULT_MS)*100		
			ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0
	        THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)/bkr.RESULT_MS)*100)
						/((((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)/bkt.TARGET_MS)*100 ))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0
			THEN (((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)
					/bkt.TARGET_TS)*100		
			ELSE 0 END										AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/bkr.RESULT_TS)*100
			ELSE 0 END                              		AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 AND bkr.RESULT_TS<>0
			THEN (((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100)
						/((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0
			THEN (((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)
					/bkr2.RESULT_TS)*100
			ELSE 0 END                                     	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0
	        THEN ((((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100)
						-((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))
								/((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,7                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID	     = @KPI_REF_ID_06 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID	     = @KPI_REF_ID_07
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_07
                          AND bkr5.YMD				 = bkt.YMD 
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID-1
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_07
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkt.YMD,5,6)                        
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/*************
*  DO사업부
**************/

SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,1                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END	                                    AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,2                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'				      
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-1												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익'											AS KPI_NAME 		--지표명
      ,'매출총이익'                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS-bkt2.TARGET_MS                         AS TARGET_MS		--당월목표
	  ,bkr.RESULT_MS-bkr3.RESULT_MS							AS RESULT_MS		--당월실적
	  ,CASE WHEN (bkt.TARGET_MS-bkt2.TARGET_MS)<>0
	        THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/(bkt.TARGET_MS-bkt2.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS-bkt2.TARGET_TS							AS TARGET_TS		--누계목표
	  ,bkr.RESULT_TS-bkr3.RESULT_TS							AS RESULT_TS	    --누계실적
	  ,CASE WHEN (bkt.TARGET_TS-bkt2.TARGET_TS)<>0
			THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/(bkt.TARGET_TS-bkt2.TARGET_TS))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS-bkr4.RESULT_TS						AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN (bkr2.RESULT_TS-bkr4.RESULT_TS)<>0
	        THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-(bkr2.RESULT_TS-bkr4.RESULT_TS))/(bkr2.RESULT_TS-bkr4.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,3                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_09 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_09
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-2												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익율'										AS KPI_NAME 		--지표명
      ,'매출총이익율(%)'									AS ALIAS 		    --지표명
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS)*100   
	        ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0 THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS)*100	
	        ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0 THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS))*100)/((((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS))*100))*100		
	        ELSE 0 END                                      AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN ((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100
	        ELSE 0 END                                  	AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100
	        ELSE 0 END                                   	AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS))*100)/((((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS))*100))*100
	        ELSE 0 END                              		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                   	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100)-(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))/(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,4                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_09 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_09
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                   					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                  					AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,5                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-3												    AS KPI_REF_ID   	--지표코드
      ,'영업이익'											AS KPI_NAME 		--지표명
      ,'영업이익'                                           AS ALIAS 			--지표별칭
	  ,(bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS        AS TARGET_MS		--당월목표
	  ,(bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS		AS RESULT_MS		--당월실적
	  ,CASE WHEN ((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)<>0
	        THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,(bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS    	AS TARGET_TS		--누계목표
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS    	AS RESULT_TS	    --누계실적
	  ,CASE WHEN ((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS )<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS ))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,(bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS		AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)<>0
	        THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					-((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))
						/((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,6                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID		 = @KPI_REF_ID_09 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID		 = @KPI_REF_ID_10 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_10
                          AND bkr5.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_10
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-4												    AS KPI_REF_ID   	--지표코드
      ,'영업이익율'											AS KPI_NAME 		--지표명
      ,'영업이익율(%)'                                      AS ALIAS 			--지표별칭
	  ,CASE WHEN bkt.TARGET_MS<>0
			THEN (((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)
					/bkt.TARGET_MS)*100  
			ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0
			THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/bkr.RESULT_MS)*100		
			ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0
	        THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)/bkr.RESULT_MS)*100)
						/((((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)/bkt.TARGET_MS)*100 ))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0
			THEN (((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)
					/bkt.TARGET_TS)*100		
			ELSE 0 END										AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/bkr.RESULT_TS)*100
			ELSE 0 END                              		AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 AND bkr.RESULT_TS<>0
			THEN (((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100)
						/((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0
			THEN (((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)
					/bkr2.RESULT_TS)*100
			ELSE 0 END                                     	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0
	        THEN ((((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100)
						-((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))
								/((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,7                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID	     = @KPI_REF_ID_09 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID	     = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_10
                          AND bkr5.YMD				 = bkt.YMD 
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID-1
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_10
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkt.YMD,5,6)                        
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')"; 
			#endregion

			IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;
            //paramArray[2] 		= CreateDataParameter("@KPI_REF_ID_01", SqlDbType.Int);
            //paramArray[2].Value = kpi_id_01;
            //paramArray[3] 		= CreateDataParameter("@KPI_REF_ID_02", SqlDbType.Int);
            //paramArray[3].Value = kpi_id_02;
            //paramArray[4] 		= CreateDataParameter("@KPI_REF_ID_03", SqlDbType.Int);
            //paramArray[4].Value = kpi_id_03;
            //paramArray[5] 		= CreateDataParameter("@KPI_REF_ID_04", SqlDbType.Int);
            //paramArray[5].Value = kpi_id_04;

			DataSet ds = DbAgentObj.FillDataSet( query_old, "DATA" , null, paramArray, CommandType.Text);
			return ds;
        }
        


        #endregion

        #region =================== 전사 - 사업부/천진/말레이/혜주 ===============================

        public DataTable GetData_M_1_S_2( int estterm_ref_id
                                        , string ymd)
        {
			#region 기존 쿼리[안씀]
			string queryOld =
	@"



--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부-Global매출액
DECLARE @KPI_REF_ID_02 INT   -- DD사업부-Global영업이익
DECLARE @KPI_REF_ID_03 INT   -- DO사업부-Global매출액(실제지표:DO영업팀)
DECLARE @KPI_REF_ID_04 INT   -- DO사업부-Global영업이익(실제지표:DO영업팀)
DECLARE @KPI_REF_ID_05 INT   -- 천진법인_매출액
DECLARE @KPI_REF_ID_06 INT   -- 천진법인_영업이익
DECLARE @KPI_REF_ID_07 INT   -- 혜주법인_매출액
DECLARE @KPI_REF_ID_08 INT   -- 혜주법인_영업이익
DECLARE @KPI_REF_ID_09 INT   -- 말레이법인_매출액
DECLARE @KPI_REF_ID_10 INT   -- 말레이법인_영업이익
DECLARE @KPI_REF_ID_11 INT   -- 기타_매출액 [베트남법인_매출액]
DECLARE @KPI_REF_ID_12 INT   -- 기타_영업이익 [베트남법인_영업이익]


--SET @ESTTERM_REF_ID =999
--SET @YMD ='200912'
--SET @KPI_REF_ID_01 = 1371
--SET @KPI_REF_ID_02 = 1372    
SET @KPI_REF_ID_01 = 3642	-- 1371 -> 3642 로 변경(2010.07.15)
SET @KPI_REF_ID_02 = 3643   -- 1372 -> 3643 로 변경(2010.07.15)
SET @KPI_REF_ID_03 = 3644   -- 1400 -> 3644 로 변경(2010.07.15)
SET @KPI_REF_ID_04 = 3645   -- 1401 -> 3645 로 변경(2010.07.15)
SET @KPI_REF_ID_05 = 3646   -- 1475 -> 3646 로 변경(2010.07.15)
SET @KPI_REF_ID_06 = 3647   -- 1476 -> 3647 로 변경(2010.07.15)
SET @KPI_REF_ID_07 = 3648   -- 1477 -> 3648 로 변경(2010.07.15)
SET @KPI_REF_ID_08 = 3649   -- 1478 -> 3649 로 변경(2010.07.15)
SET @KPI_REF_ID_09 = 3650   -- 1479 -> 3650 로 변경(2010.07.15)
SET @KPI_REF_ID_10 = 3651   -- 1480 -> 3651 로 변경(2010.07.15)
SET @KPI_REF_ID_11 = 3652   -- 1525 -> 3652 로 변경(2010.07.15)
SET @KPI_REF_ID_12 = 3653   -- 1526 -> 3653 로 변경(2010.07.15)

    


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.14
*	Page view  : 전사-공장별 (슬라이드 No.03)
*	Grid 구성
*	관련 KPI : 천진법인_매출액
*			   천진법인_영업이익
*			   혜주법인_매출액
*			   혜주법인_영업이익
*			   말레이법인_매출액
*			   말레이법인_영업이익
*	KPI_REF_ID : 1371,1372,1400,1401,1475,1476,1477,1478,1479,1480
*									 
*									 
**************************************************************************/


SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,0                                                   AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,0                                                   AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,0                                                   AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,0                                                   AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL          
SELECT ITEM_SUM.ESTTERM_REF_ID                                                       --평가년 
	  ,ITEM_SUM.YMD                                                                  --평가월
      ,-1                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부/DO사업부 매출액 소계'                     AS KPI_NAME   		--지표명
      ,'소계'                                              AS ALIAS				--지표별칭
      ,SUM(ITEM_SUM.RESULT_MS)                             AS RESULT_MS         --당월실적
      ,SUM(ITEM_SUM.RESULT_TS)                             AS RESULT_TS         --누계실적
      ,SUM(ITEM_SUM.RESULT_RNF)                            AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (SUM(ITEM_SUM.RESULT_TS)+bkr3.RESULT_TS 
			 +bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS)<>0
			THEN (SUM(ITEM_SUM.RESULT_TS)
					/(SUM(ITEM_SUM.RESULT_TS)+bkr3.RESULT_TS 
					  +bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS))*100 
		    ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM (
  	
  		SELECT bkr.ESTTERM_REF_ID                                                        --평가년 
			   ,bkr.YMD                                                                  --평가월
			   ,bki.KPI_REF_ID                                                           --지표코드
			   ,bkp.KPI_NAME						 									 --지표명
			   ,bkp.KPI_DESC                                        AS ALIAS			 --지표별칭
			   ,bkr.RESULT_MS                                                            --당월실적
			   ,bkr.RESULT_TS                                                            --누계실적
			   ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,0                                                   AS RATIO             --전체구성비
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,1                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)			
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
		 UNION ALL	
		 SELECT bkr.ESTTERM_REF_ID                                                        --평가년 
			   ,bkr.YMD                                                                  --평가월
			   ,bki.KPI_REF_ID                                                           --지표코드
			   ,bkp.KPI_NAME						 									 --지표명
			   ,bkp.KPI_DESC                                        AS ALIAS			 --지표별칭
			   ,bkr.RESULT_MS                                                            --당월실적
			   ,bkr.RESULT_TS                                                            --누계실적
			   ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,0                                                   AS RATIO             --전체구성비
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,3                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)			
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')

  ) AS ITEM_SUM
    JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr3.YMD			  = ITEM_SUM.YMD
							AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_05	
	JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr4.YMD			  = ITEM_SUM.YMD
							AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_07
	JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr5.YMD			  = ITEM_SUM.YMD
							AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_09	
	JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr6.YMD			  = ITEM_SUM.YMD
							AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11	
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD, bkr3.RESULT_TS, bkr4.RESULT_TS, bkr5.RESULT_TS, bkr6.RESULT_TS
UNION ALL      
SELECT ITEM_SUM.ESTTERM_REF_ID                                                       --평가년 
	  ,ITEM_SUM.YMD                                                                  --평가월
      ,-2                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부/DO사업부 영업이익 소계'                   AS KPI_NAME   		--지표명
      ,'소계'                                              AS ALIAS				--지표별칭
      ,SUM(ITEM_SUM.RESULT_MS)                             AS RESULT_MS         --당월실적
      ,SUM(ITEM_SUM.RESULT_TS)                             AS RESULT_TS         --누계실적
      ,SUM(ITEM_SUM.RESULT_RNF)                            AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (SUM(ITEM_SUM.RESULT_TS)+bkr3.RESULT_TS 
				  +bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS)<>0
			THEN (SUM(ITEM_SUM.RESULT_TS)
					/(SUM(ITEM_SUM.RESULT_TS)+bkr3.RESULT_TS 
					  +bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS))*100 
		    ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,6                                                   AS SORT_ORDER        --정렬순서
  FROM (
  	
  		SELECT bkr.ESTTERM_REF_ID                                                        --평가년 
			   ,bkr.YMD                                                                  --평가월
			   ,bki.KPI_REF_ID                                                           --지표코드
			   ,bkp.KPI_NAME						 									 --지표명
			   ,bkp.KPI_DESC                                        AS ALIAS			 --지표별칭
			   ,bkr.RESULT_MS                                                            --당월실적
			   ,bkr.RESULT_TS                                                            --누계실적
			   ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,0                                                   AS RATIO             --전체구성비
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,2                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)			
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
		 UNION ALL	
		 SELECT bkr.ESTTERM_REF_ID                                                        --평가년 
			   ,bkr.YMD                                                                  --평가월
			   ,bki.KPI_REF_ID                                                           --지표코드
			   ,bkp.KPI_NAME						 									 --지표명
			   ,bkp.KPI_DESC                                        AS ALIAS			 --지표별칭
			   ,bkr.RESULT_MS                                                            --당월실적
			   ,bkr.RESULT_TS                                                            --누계실적
			   ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,0                                                   AS RATIO             --전체구성비
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,4                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)			
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
  	
  	
  ) AS ITEM_SUM
    JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr3.YMD			  = ITEM_SUM.YMD
							AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_06	
	JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr4.YMD			  = ITEM_SUM.YMD
							AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_08
	JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr5.YMD			  = ITEM_SUM.YMD
							AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10	
	JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr6.YMD			  = ITEM_SUM.YMD
							AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD, bkr3.RESULT_TS, bkr4.RESULT_TS, bkr5.RESULT_TS, bkr6.RESULT_TS  
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,7                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_01	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_07	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_11						  			
WHERE (bkr.ESTTERM_REF_ID   = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,8                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_08	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,9                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_01	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_11		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,10                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_06	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,11                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_01	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_07
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_11						
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,12                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_06	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,13                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_01	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_07
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_09			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                                            --당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,14                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_06	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_10			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
"; 
			#endregion

			#region DD 사업부, DO 사업부 분리 쿼리
			string query = string.Format(@"

--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부-Global매출액
DECLARE @KPI_REF_ID_02 INT   -- DD사업부-Global영업이익
DECLARE @KPI_REF_ID_03 INT   -- DO사업부-Global매출액(실제지표:DO영업팀)
DECLARE @KPI_REF_ID_04 INT   -- DO사업부-Global영업이익(실제지표:DO영업팀)
DECLARE @KPI_REF_ID_05 INT   -- 천진법인_매출액
DECLARE @KPI_REF_ID_06 INT   -- 천진법인_영업이익
DECLARE @KPI_REF_ID_07 INT   -- 혜주법인_매출액
DECLARE @KPI_REF_ID_08 INT   -- 혜주법인_영업이익
DECLARE @KPI_REF_ID_09 INT   -- 말레이법인_매출액
DECLARE @KPI_REF_ID_10 INT   -- 말레이법인_영업이익
DECLARE @KPI_REF_ID_11 INT   -- 베트남법인_매출액
DECLARE @KPI_REF_ID_12 INT   -- 베트남법인_영업이익


--SET @ESTTERM_REF_ID =1000
--SET @YMD ='201006'
SET @KPI_REF_ID_01 = 3642     -- 1371 -> 3642 로 변경(2010.07.15) 
SET @KPI_REF_ID_02 = 3643     -- 1372 -> 3643 로 변경(2010.07.15)
SET @KPI_REF_ID_03 = 3644     -- 1400 -> 3644 로 변경(2010.07.15)
SET @KPI_REF_ID_04 = 3645     -- 1401 -> 3645 로 변경(2010.07.15)
SET @KPI_REF_ID_05 = 3646     -- 1475 -> 3646 로 변경(2010.07.15)
SET @KPI_REF_ID_06 = 3647     -- 1476 -> 3647 로 변경(2010.07.15)
SET @KPI_REF_ID_07 = 3648     -- 1477 -> 3648 로 변경(2010.07.15)
SET @KPI_REF_ID_08 = 3649     -- 1478 -> 3649 로 변경(2010.07.15)
SET @KPI_REF_ID_09 = 3650     -- 1479 -> 3650 로 변경(2010.07.15)
SET @KPI_REF_ID_10 = 3651     -- 1480 -> 3651 로 변경(2010.07.15)
SET @KPI_REF_ID_11 = 3652     -- 1525 -> 3652 로 변경(2010.07.15)
SET @KPI_REF_ID_12 = 3653     -- 1526 -> 3653 로 변경(2010.07.15)

    


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.14
*	Page view  : 전사-공장별 (슬라이드 No.03)
*	Grid 구성
*	관련 KPI : 천진법인_매출액
*			   천진법인_영업이익
*			   혜주법인_매출액
*			   혜주법인_영업이익
*			   말레이법인_매출액
*			   말레이법인_영업이익
*	KPI_REF_ID : 1371,1372,1400,1401,1475,1476,1477,1478,1479,1480
*									 
*									 
**************************************************************************/


SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,0                                                   AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					      AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					      AND bkt.YMD	              = bkr.YMD
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
     --,bkr.RESULT_MS                                                            --당월실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,0                                                   AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					      AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					      AND bkt.YMD	              = bkr.YMD			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
     --,bkr.RESULT_MS                                                            --당월실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,0                                                   AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)	
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					      AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					      AND bkt.YMD	              = bkr.YMD						  				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
   --,bkr.RESULT_MS                                                            --당월실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,0                                                   AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)	
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					      AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					      AND bkt.YMD	              = bkr.YMD				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL          
SELECT ITEM_SUM.ESTTERM_REF_ID                                                       --평가년 
	  ,ITEM_SUM.YMD                                                                  --평가월
      ,-1                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부/DO사업부 매출액 소계'                     AS KPI_NAME   		--지표명
      ,'소계'                                              AS ALIAS				--지표별칭
      ,SUM(ITEM_SUM.TARGET_TS)                             AS TARGET_TS         --누계목표
      ,SUM(ITEM_SUM.RESULT_TS)                             AS RESULT_TS         --누계실적
      ,SUM(ITEM_SUM.RESULT_RNF)                            AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (SUM(ITEM_SUM.RESULT_TS)+bkr3.RESULT_TS 
			 +bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS)<>0
			THEN (SUM(ITEM_SUM.RESULT_TS)
					/(SUM(ITEM_SUM.RESULT_TS)+bkr3.RESULT_TS 
					  +bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS))*100 
		    ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM (
  	
  		SELECT bkr.ESTTERM_REF_ID                                                        --평가년 
			   ,bkr.YMD                                                                  --평가월
			   ,bki.KPI_REF_ID                                                           --지표코드
			   ,bkp.KPI_NAME						 									 --지표명
			   ,bkp.KPI_DESC                                        AS ALIAS			 --지표별칭
			--,bkr.RESULT_MS                                                            --당월실적
			   ,bkt.TARGET_TS															--누계목표
			   ,bkr.RESULT_TS                                                            --누계실적
			   ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,0                                                   AS RATIO             --전체구성비
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,1                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
		  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					              AND bkt.YMD	              = bkr.YMD			
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
		 UNION ALL	
		 SELECT bkr.ESTTERM_REF_ID                                                        --평가년 
			   ,bkr.YMD                                                                  --평가월
			   ,bki.KPI_REF_ID                                                           --지표코드
			   ,bkp.KPI_NAME						 									 --지표명
			   ,bkp.KPI_DESC                                        AS ALIAS			 --지표별칭
			 --,bkr.RESULT_MS                                                            --당월실적
			   ,bkt.TARGET_TS   														 --누계목표
			   ,bkr.RESULT_TS                                                            --누계실적
			   ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,0                                                   AS RATIO             --전체구성비
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,3                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
		  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					              AND bkt.YMD	              = bkr.YMD				
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')

  ) AS ITEM_SUM
    JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr3.YMD			  = ITEM_SUM.YMD
							AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_05	
	JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr4.YMD			  = ITEM_SUM.YMD
							AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_07
	JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr5.YMD			  = ITEM_SUM.YMD
							AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_09	
	JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr6.YMD			  = ITEM_SUM.YMD
							AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11	
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD, bkr3.RESULT_TS, bkr4.RESULT_TS, bkr5.RESULT_TS, bkr6.RESULT_TS
UNION ALL      
SELECT ITEM_SUM.ESTTERM_REF_ID                                                       --평가년 
	  ,ITEM_SUM.YMD                                                                  --평가월
      ,-2                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부/DO사업부 영업이익 소계'                   AS KPI_NAME   		--지표명
      ,'소계'                                              AS ALIAS				--지표별칭
      ,SUM(ITEM_SUM.TARGET_TS)                             AS TARGET_TS         --누계목표
      ,SUM(ITEM_SUM.RESULT_TS)                             AS RESULT_TS         --누계실적
      ,SUM(ITEM_SUM.RESULT_RNF)                            AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (SUM(ITEM_SUM.RESULT_TS)+bkr3.RESULT_TS 
				  +bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS)<>0
			THEN (SUM(ITEM_SUM.RESULT_TS)
					/(SUM(ITEM_SUM.RESULT_TS)+bkr3.RESULT_TS 
					  +bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS))*100 
		    ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,6                                                   AS SORT_ORDER        --정렬순서
  FROM (
  	
  		SELECT bkr.ESTTERM_REF_ID                                                        --평가년 
			   ,bkr.YMD                                                                  --평가월
			   ,bki.KPI_REF_ID                                                           --지표코드
			   ,bkp.KPI_NAME						 									 --지표명
			   ,bkp.KPI_DESC                                        AS ALIAS			 --지표별칭
			 --,bkr.RESULT_MS                                                            --당월실적
			   ,bkt.TARGET_TS   														 --누계목표
			   ,bkr.RESULT_TS                                                            --누계실적
			   ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,0                                                   AS RATIO             --전체구성비
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,2                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
		  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					              AND bkt.YMD	              = bkr.YMD				
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
		 UNION ALL	
		 SELECT bkr.ESTTERM_REF_ID                                                        --평가년 
			   ,bkr.YMD                                                                  --평가월
			   ,bki.KPI_REF_ID                                                           --지표코드
			   ,bkp.KPI_NAME						 									 --지표명
			   ,bkp.KPI_DESC                                        AS ALIAS			 --지표별칭
			 --,bkr.RESULT_MS                                                            --당월실적
			   ,bkt.TARGET_TS   														 --누계목표
			   ,bkr.RESULT_TS                                                            --누계실적
			   ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,0                                                   AS RATIO             --전체구성비
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,4                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
		  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					              AND bkt.YMD	              = bkr.YMD				
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
  	
  	
  ) AS ITEM_SUM
    JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr3.YMD			  = ITEM_SUM.YMD
							AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_06	
	JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr4.YMD			  = ITEM_SUM.YMD
							AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_08
	JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr5.YMD			  = ITEM_SUM.YMD
							AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10	
	JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr6.YMD			  = ITEM_SUM.YMD
							AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD, bkr3.RESULT_TS, bkr4.RESULT_TS, bkr5.RESULT_TS, bkr6.RESULT_TS  
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
	--,bkr.RESULT_MS                                                            --당월실적
	  ,bkt.TARGET_TS     														--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,7                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_01	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_07	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD							  						  			
WHERE (bkr.ESTTERM_REF_ID   = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
	--,bkr.RESULT_MS                                                            --당월실적
	  ,bkt.TARGET_TS     														--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,8                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_08	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD					
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
	--,bkr.RESULT_MS                                                            --당월실적
	  ,bkt.TARGET_TS     														--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,9                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_01	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
	--,bkr.RESULT_MS                                                            --당월실적
	  ,bkt.TARGET_TS     														--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,10                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_06	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD					
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
	--,bkr.RESULT_MS                                                            --당월실적
	  ,bkt.TARGET_TS     														--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,11                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_01	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_07
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD							
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
	--,bkr.RESULT_MS                                                            --당월실적
	  ,bkt.TARGET_TS     														--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,12                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_06	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
	--,bkr.RESULT_MS                                                            --당월실적
	  ,bkt.TARGET_TS     														--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,13                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_01	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_07
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
	--,bkr.RESULT_MS                                                            --당월실적
	  ,bkt.TARGET_TS     														--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,CASE WHEN (bkr.RESULT_TS+bkr3.RESULT_TS
				  +bkr4.RESULT_TS+bkr5.RESULT_TS
				  +bkr6.RESULT_TS+bkr7.RESULT_TS)<>0
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr3.RESULT_TS
					    	    +bkr4.RESULT_TS+bkr5.RESULT_TS
							    +bkr6.RESULT_TS+bkr7.RESULT_TS))*100 
			ELSE 0 END                                     AS RATIO             --전체구성비
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,14                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
	   					  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_06	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
");
			#endregion

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds.Tables[0];
        }

        #endregion

        #region =================== 전사 - Item별 - 총괄 ===============================

        public DataTable GetData_M_1_S_3_A(int estterm_ref_id
                                         , string ymd)
        {
            string query = 
@"

--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부-PTC_매출액
DECLARE @KPI_REF_ID_02 INT   -- DD사업부-VM_매출액
DECLARE @KPI_REF_ID_03 INT   -- DD사업부-EV_매출액
DECLARE @KPI_REF_ID_04 INT   -- DD사업부-AFA_매출액
DECLARE @KPI_REF_ID_05 INT   -- DD사업부-ALC_매출액
DECLARE @KPI_REF_ID_06 INT   -- DD사업부-기타_매출액

DECLARE @KPI_REF_ID_07 INT   -- DO사업부-PCM_매출액
DECLARE @KPI_REF_ID_08 INT   -- DO사업부-TS_매출액
DECLARE @KPI_REF_ID_09 INT   -- DO사업부-Roller_매출액
DECLARE @KPI_REF_ID_10 INT   -- DO사업부-Sleeve_매출액
DECLARE @KPI_REF_ID_11 INT   -- DO사업부-CTR_매출액
DECLARE @KPI_REF_ID_12 INT   -- DO사업부-FCCL_매출액
DECLARE @KPI_REF_ID_13 INT   -- DO사업부-Film_매출액
DECLARE @KPI_REF_ID_14 INT   -- DO사업부-기타_매출액

DECLARE @KPI_REF_ID_15 INT   -- DD사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_16 INT   -- DD사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_17 INT   -- DD사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_18 INT   -- DD사업부-추가여분4_매출액

DECLARE @KPI_REF_ID_19 INT   -- DO사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_20 INT   -- DO사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_21 INT   -- DO사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_22 INT   -- DO사업부-추가여분4_매출액


--SET @ESTTERM_REF_ID =999
--SET @YMD ='200912'
SET @KPI_REF_ID_01 = 1484    
SET @KPI_REF_ID_02 = 1485
SET @KPI_REF_ID_03 = 1483
SET @KPI_REF_ID_04 = 1481
SET @KPI_REF_ID_05 = 1482
SET @KPI_REF_ID_06 = 1486

SET @KPI_REF_ID_07 = 1490
SET @KPI_REF_ID_08 = 1493
SET @KPI_REF_ID_09 = 1491 
SET @KPI_REF_ID_10 = 1492
SET @KPI_REF_ID_11 = 1487
SET @KPI_REF_ID_12 = 1488
SET @KPI_REF_ID_13 = 1489
SET @KPI_REF_ID_14 = 1494

SET @KPI_REF_ID_15 = 1495
SET @KPI_REF_ID_16 = 1496
SET @KPI_REF_ID_17 = 1497
SET @KPI_REF_ID_18 = 1498

SET @KPI_REF_ID_19 = 1499
SET @KPI_REF_ID_20 = 1500
SET @KPI_REF_ID_21 = 1501
SET @KPI_REF_ID_22 = 1502


    


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.14
*	Page view  : 전사-ITEM별-총괄 (슬라이드 No.04)
*	Grid 구성
*	관련 KPI : 상단 정의 참조
*	KPI_REF_ID : 상단 정의 참조
*									 
*									 
**************************************************************************/

/***********
* DD사업부
************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_02 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')   
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
       ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_15		OR @KPI_REF_ID_15=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_15	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_16		OR @KPI_REF_ID_16=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_15	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_15	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_17								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_18		OR @KPI_REF_ID_18=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'') 
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,0                                                   AS KPI_CODE          --지표코드
      ,'DD사업부_합계'									   AS KPI_NAME   		--지표명
      ,'합계'                                              AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
       bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
       bkr10.RESULT_TS                                     AS RESULT_TS  --누계실적                                                          --누계실적
      ,0                                                   AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_02 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')  
   
";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds.Tables[0];
        }

        public DataTable GetData_M_1_S_3_B(int estterm_ref_id
                                         , string ymd)
        {
            string query = 
@"

--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부-PTC_매출액
DECLARE @KPI_REF_ID_02 INT   -- DD사업부-VM_매출액
DECLARE @KPI_REF_ID_03 INT   -- DD사업부-EV_매출액
DECLARE @KPI_REF_ID_04 INT   -- DD사업부-AFA_매출액
DECLARE @KPI_REF_ID_05 INT   -- DD사업부-ALC_매출액
DECLARE @KPI_REF_ID_06 INT   -- DD사업부-기타_매출액

DECLARE @KPI_REF_ID_07 INT   -- DO사업부-PCM_매출액
DECLARE @KPI_REF_ID_08 INT   -- DO사업부-TS_매출액
DECLARE @KPI_REF_ID_09 INT   -- DO사업부-Roller_매출액
DECLARE @KPI_REF_ID_10 INT   -- DO사업부-Sleeve_매출액
DECLARE @KPI_REF_ID_11 INT   -- DO사업부-CTR_매출액
DECLARE @KPI_REF_ID_12 INT   -- DO사업부-FCCL_매출액
DECLARE @KPI_REF_ID_13 INT   -- DO사업부-Film_매출액
DECLARE @KPI_REF_ID_14 INT   -- DO사업부-기타_매출액

DECLARE @KPI_REF_ID_15 INT   -- DD사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_16 INT   -- DD사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_17 INT   -- DD사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_18 INT   -- DD사업부-추가여분4_매출액

DECLARE @KPI_REF_ID_19 INT   -- DO사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_20 INT   -- DO사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_21 INT   -- DO사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_22 INT   -- DO사업부-추가여분4_매출액


--SET @ESTTERM_REF_ID =1000
--SET @YMD ='201003'
SET @KPI_REF_ID_01 = 1484    
SET @KPI_REF_ID_02 = 1485
SET @KPI_REF_ID_03 = 1483
SET @KPI_REF_ID_04 = 1481
SET @KPI_REF_ID_05 = 1482
SET @KPI_REF_ID_06 = 1486

SET @KPI_REF_ID_07 = 1490
SET @KPI_REF_ID_08 = 1493
SET @KPI_REF_ID_09 = 1491 
SET @KPI_REF_ID_10 = 1492
SET @KPI_REF_ID_11 = 1487
SET @KPI_REF_ID_12 = 1488
SET @KPI_REF_ID_13 = 1489
SET @KPI_REF_ID_14 = 1494

SET @KPI_REF_ID_15 = 1495
SET @KPI_REF_ID_16 = 1496
SET @KPI_REF_ID_17 = 1497
SET @KPI_REF_ID_18 = 1498

SET @KPI_REF_ID_19 = 1499
SET @KPI_REF_ID_20 = 1500
SET @KPI_REF_ID_21 = 1501
SET @KPI_REF_ID_22 = 1502


    
/***********
* DO사업부
************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_08 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_14		OR @KPI_REF_ID_14=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_19		OR @KPI_REF_ID_19=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_19
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_20		OR @KPI_REF_ID_20=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_19
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN (bkr.RESULT_TS+bkr2.RESULT_TS+
				  bkr3.RESULT_TS+bkr4.RESULT_TS+
				  bkr5.RESULT_TS+bkr6.RESULT_TS+
				  bkr7.RESULT_TS+bkr8.RESULT_TS+
				  bkr9.RESULT_TS+bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+
								 bkr3.RESULT_TS+bkr4.RESULT_TS+
								 bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+
								 bkr9.RESULT_TS+bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_19
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_21									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_22		OR @KPI_REF_ID_22=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,0                                                   AS KPI_CODE          --지표코드
      ,'DO사업부_합계'									   AS KPI_NAME   		--지표명
      ,'합계'                                              AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
       bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
       bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS     AS RESULT_TS         --누계실적                                                          --누계실적
      ,0                                                   AS RATE              --실적비율
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_08 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22									  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds.Tables[0];
        }

        #endregion

        #region =================== 전사 - Item별 - 상세 ===============================

        public DataSet GetData_M_1_S_4(int estterm_ref_id
                                     , string ymd)
        {
            string query = 
@"



--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부-PTC_매출액
DECLARE @KPI_REF_ID_02 INT   -- DD사업부-VM_매출액
DECLARE @KPI_REF_ID_03 INT   -- DD사업부-EV_매출액
DECLARE @KPI_REF_ID_04 INT   -- DD사업부-AFA_매출액
DECLARE @KPI_REF_ID_05 INT   -- DD사업부-ALC_매출액
DECLARE @KPI_REF_ID_06 INT   -- DD사업부-기타_매출액

DECLARE @KPI_REF_ID_07 INT   -- DO사업부-PCM_매출액
DECLARE @KPI_REF_ID_08 INT   -- DO사업부-TS_매출액
DECLARE @KPI_REF_ID_09 INT   -- DO사업부-Roller_매출액
DECLARE @KPI_REF_ID_10 INT   -- DO사업부-Sleeve_매출액
DECLARE @KPI_REF_ID_11 INT   -- DO사업부-CTR_매출액
DECLARE @KPI_REF_ID_12 INT   -- DO사업부-FCCL_매출액
DECLARE @KPI_REF_ID_13 INT   -- DO사업부-Film_매출액
DECLARE @KPI_REF_ID_14 INT   -- DO사업부-기타_매출액

DECLARE @KPI_REF_ID_15 INT   -- DD사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_16 INT   -- DD사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_17 INT   -- DD사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_18 INT   -- DD사업부-추가여분4_매출액

DECLARE @KPI_REF_ID_19 INT   -- DO사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_20 INT   -- DO사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_21 INT   -- DO사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_22 INT   -- DO사업부-추가여분4_매출액

DECLARE @KPI_REF_ID_23 INT   -- DD사업부-PTC_영업이익
DECLARE @KPI_REF_ID_24 INT   -- DD사업부-VM_영업이익
DECLARE @KPI_REF_ID_25 INT   -- DD사업부-EV_영업이익
DECLARE @KPI_REF_ID_26 INT   -- DD사업부-AFA_영업이익
DECLARE @KPI_REF_ID_27 INT   -- DD사업부-ALC_영업이익
DECLARE @KPI_REF_ID_28 INT   -- DD사업부-기타_영업이익

DECLARE @KPI_REF_ID_29 INT   -- DO사업부-PCM_영업이익
DECLARE @KPI_REF_ID_30 INT   -- DO사업부-TS_영업이익
DECLARE @KPI_REF_ID_31 INT   -- DO사업부-Roller_영업이익
DECLARE @KPI_REF_ID_32 INT   -- DO사업부-Sleeve_영업이익
DECLARE @KPI_REF_ID_33 INT   -- DO사업부-CTR_영업이익
DECLARE @KPI_REF_ID_34 INT   -- DO사업부-FCCL_영업이익
DECLARE @KPI_REF_ID_35 INT   -- DO사업부-Film_영업이익
DECLARE @KPI_REF_ID_36 INT   -- DO사업부-기타_영업이익

DECLARE @KPI_REF_ID_37 INT   -- DD사업부-추가여분1_영업이익
DECLARE @KPI_REF_ID_38 INT   -- DD사업부-추가여분2_영업이익
DECLARE @KPI_REF_ID_39 INT   -- DD사업부-추가여분3_영업이익
DECLARE @KPI_REF_ID_40 INT   -- DD사업부-추가여분4_영업이익

DECLARE @KPI_REF_ID_41 INT   -- DO사업부-추가여분1_영업이익
DECLARE @KPI_REF_ID_42 INT   -- DO사업부-추가여분2_영업이익
DECLARE @KPI_REF_ID_43 INT   -- DO사업부-추가여분3_영업이익
DECLARE @KPI_REF_ID_44 INT   -- DO사업부-추가여분4_영업이익
                                                          
DECLARE @KPI_REF_ID_45 INT   --천진법인_PTC_매출액         
DECLARE @KPI_REF_ID_46 INT   --천진법인_VM_매출액          
DECLARE @KPI_REF_ID_47 INT   --천진법인_EV_매출액          
DECLARE @KPI_REF_ID_48 INT   --천진법인_AFA_매출액         
DECLARE @KPI_REF_ID_49 INT   --천진법인_PCM_매출액         
DECLARE @KPI_REF_ID_50 INT   --천진법인_ROLLER_매출액      
DECLARE @KPI_REF_ID_51 INT   --천진법인_기타_매출액        
                                                          
DECLARE @KPI_REF_ID_52 INT   --천진법인_추가여분1_매출액   
DECLARE @KPI_REF_ID_53 INT   --천진법인_추가여분2_매출액   
DECLARE @KPI_REF_ID_54 INT   --천진법인_추가여분3_매출액   
DECLARE @KPI_REF_ID_55 INT   --천진법인_추가여분4_매출액    
                                                          
DECLARE @KPI_REF_ID_56 INT   --천진법인_PTC_영업이익       
DECLARE @KPI_REF_ID_57 INT   --천진법인_VM_영업이익        
DECLARE @KPI_REF_ID_58 INT   --천진법인_EV_영업이익        
DECLARE @KPI_REF_ID_59 INT   --천진법인_AFA_영업이익       
DECLARE @KPI_REF_ID_60 INT   --천진법인_PCM_영업이익       
DECLARE @KPI_REF_ID_61 INT   --천진법인_ROLLER_영업이익    
DECLARE @KPI_REF_ID_62 INT   --천진법인_기타_영업이익      
                                                          
DECLARE @KPI_REF_ID_63 INT   --천진법인_추가여분1_영업이익 
DECLARE @KPI_REF_ID_64 INT   --천진법인_추가여분2_영업이익 
DECLARE @KPI_REF_ID_65 INT   --천진법인_추가여분3_영업이익 
DECLARE @KPI_REF_ID_66 INT   --천진법인_추가여분4_영업이익                           


--SET @ESTTERM_REF_ID =1000                                        
--SET @YMD ='201003'                                         
SET @KPI_REF_ID_01 = 1484             SET @KPI_REF_ID_23 = 1504                                                       
SET @KPI_REF_ID_02 = 1485             SET @KPI_REF_ID_24 = 1503                                                       
SET @KPI_REF_ID_03 = 1483             SET @KPI_REF_ID_25 = 1505                                                       
SET @KPI_REF_ID_04 = 1481             SET @KPI_REF_ID_26 = 1507                                                       
SET @KPI_REF_ID_05 = 1482             SET @KPI_REF_ID_27 = 1506                                                       
SET @KPI_REF_ID_06 = 1486             SET @KPI_REF_ID_28 = 1508                                                       
                                                                                                                      
SET @KPI_REF_ID_07 = 1490             SET @KPI_REF_ID_29 = 1516                                                       
SET @KPI_REF_ID_08 = 1493             SET @KPI_REF_ID_30 = 1513                                                       
SET @KPI_REF_ID_09 = 1491             SET @KPI_REF_ID_31 = 1515                                                       
SET @KPI_REF_ID_10 = 1492             SET @KPI_REF_ID_32 = 1514                                                       
SET @KPI_REF_ID_11 = 1487             SET @KPI_REF_ID_33 = 1519                                                       
SET @KPI_REF_ID_12 = 1488             SET @KPI_REF_ID_34 = 1518                                                       
SET @KPI_REF_ID_13 = 1489             SET @KPI_REF_ID_35 = 1517                                                       
SET @KPI_REF_ID_14 = 1494             SET @KPI_REF_ID_36 = 1520                                                       
                                                                                                                      
SET @KPI_REF_ID_15 = 1495             SET @KPI_REF_ID_37 = 1509                                                       
SET @KPI_REF_ID_16 = 1496             SET @KPI_REF_ID_38 = 1510                                                       
SET @KPI_REF_ID_17 = 1497             SET @KPI_REF_ID_39 = 1512                                                       
SET @KPI_REF_ID_18 = 1498             SET @KPI_REF_ID_40 = 1511                                                       
                                                                                                                      
SET @KPI_REF_ID_19 = 1499             SET @KPI_REF_ID_41 = 1521                                                       
SET @KPI_REF_ID_20 = 1500             SET @KPI_REF_ID_42 = 1523                                                       
SET @KPI_REF_ID_21 = 1501             SET @KPI_REF_ID_43 = 1522                                                       
SET @KPI_REF_ID_22 = 1502             SET @KPI_REF_ID_44 = 1524 

--천진 추가  
SET @KPI_REF_ID_45 = 1635             SET @KPI_REF_ID_56 = 1636  
SET @KPI_REF_ID_46 = 1637             SET @KPI_REF_ID_57 = 1638 
SET @KPI_REF_ID_47 = 1639             SET @KPI_REF_ID_58 = 1640 
SET @KPI_REF_ID_48 = 1641             SET @KPI_REF_ID_59 = 1642 
SET @KPI_REF_ID_49 = 1643             SET @KPI_REF_ID_60 = 1644 
SET @KPI_REF_ID_50 = 1645             SET @KPI_REF_ID_61 = 1646 
SET @KPI_REF_ID_51 = 1647             SET @KPI_REF_ID_62 = 1648 
                                                                
SET @KPI_REF_ID_52 = 1649             SET @KPI_REF_ID_63 = 1650 
SET @KPI_REF_ID_53 = 1651             SET @KPI_REF_ID_64 = 1652 
SET @KPI_REF_ID_54 = 1653             SET @KPI_REF_ID_65 = 1654 
SET @KPI_REF_ID_55 = 1655             SET @KPI_REF_ID_66 = 1656 

 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.22
*	Page view  : 전사/DD/DO/천진-ITEM별-상세 (슬라이드 No.05,11,19)
*	Grid 구성
*	관련 KPI : 상단 정의 참조
*	KPI_REF_ID : 상단 정의 참조
*									 
*									 
**************************************************************************/

/********************************************
* DD사업부_PTC 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_23		OR @KPI_REF_ID_23=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-1                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_PTC_영업이익율'                           AS KPI_NAME   		--지표명
      ,'PTC'                                               AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_23
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_23
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')



/********************************************
* DD사업부_VM 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_24		OR @KPI_REF_ID_24=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-2                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_VM_영업이익율'                            AS KPI_NAME   		--지표명
      ,'VM'                                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_24
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
/********************************************
* DD사업부_EV 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_25		OR @KPI_REF_ID_25=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-3                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_EV_영업이익율'                            AS KPI_NAME   		--지표명
      ,'EV'                                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_25
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
/********************************************
* DD사업부_AFA 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_26		OR @KPI_REF_ID_26=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-4                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_AFA_영업이익율'                           AS KPI_NAME   		--지표명
      ,'AFA'                                               AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_26
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_26
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   

/********************************************
* DD사업부_ALC 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_27		OR @KPI_REF_ID_27=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-5                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_ALC_영업이익율'                           AS KPI_NAME   		--지표명
      ,'ALC'                                               AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_27
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_27
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   



/********************************************
* DO사업부_PCM_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,6                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,6                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_29		OR @KPI_REF_ID_29=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-6                                                  AS KPI_REF_ID        --지표코드
      ,'DO사업부_PCM_영업이익율'                           AS KPI_NAME   		--지표명
      ,'PCM'                                               AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,6                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_29
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_29
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/********************************************
* DO사업부_TS_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,7                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,7                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_30		OR @KPI_REF_ID_30=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-7                                                  AS KPI_REF_ID        --지표코드
      ,'DO사업부_TS_영업이익율'                            AS KPI_NAME   		--지표명
      ,'TS'                                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0  
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,7                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_30
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_30
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/********************************************
* DO사업부_Roller_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,8                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,8                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_31		OR @KPI_REF_ID_31=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-8                                                  AS KPI_REF_ID        --지표코드
      ,'DO사업부_Roller_영업이익율'                        AS KPI_NAME   		--지표명
      ,'Roller'                                            AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0  
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,8                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_31
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_31
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
/********************************************
* DO사업부_Sleeve_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,9                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,9                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_32		OR @KPI_REF_ID_32=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-9                                                  AS KPI_REF_ID        --지표코드
      ,'DO사업부_Sleeve_영업이익율'                        AS KPI_NAME   		--지표명
      ,'Sleeve'                                            AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0  
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,9                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_32
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_32
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
/********************************************
* DO사업부_CTR_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,10                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,10                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_33		OR @KPI_REF_ID_33=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-10                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_CTR_영업이익율'                           AS KPI_NAME   		--지표명
      ,'CTR'                                               AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,10                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_33
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_33
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   



/********************************************
* DO사업부_FCCL_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,11                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,11                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_34		OR @KPI_REF_ID_34=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-11                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_FCCL_영업이익율'                          AS KPI_NAME   		--지표명
      ,'FCCL'                                              AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,11                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_34
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_34
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
   
/********************************************
* DO사업부_Film_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,12                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,12                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_35		OR @KPI_REF_ID_35=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-12                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_Film_영업이익율'                          AS KPI_NAME   		--지표명
      ,'Film'                                              AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,12                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_35
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
/********************************************
* DD사업부_기타_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,13                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,13                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_28		OR @KPI_REF_ID_28=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-13                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_기타_영업이익율'                          AS KPI_NAME   		--지표명
      ,'DD사업부_기타'                                     AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,13                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_28
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_28
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
   
/********************************************
* DO사업부_기타_매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,14                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_14		OR @KPI_REF_ID_14=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,14                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_36		OR @KPI_REF_ID_36=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-14                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_기타_영업이익율'                          AS KPI_NAME   		--지표명
      ,'DO사업부_기타'                                     AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,14                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_36
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_14		OR @KPI_REF_ID_14=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
/*************************************************
* DD사업부_추가여분1_매출액, 영업이익, 영업이익율
**************************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,15                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_15		OR @KPI_REF_ID_15=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,15                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_37		OR @KPI_REF_ID_37=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-15                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_추가여분1_영업이익율'                     AS KPI_NAME   		--지표명
      ,'DD사업부_추가여분1'                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,15                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_37
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_37
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_15		OR @KPI_REF_ID_15=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/*************************************************
* DD사업부_추가여분2_매출액, 영업이익, 영업이익율
**************************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,16                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_16		OR @KPI_REF_ID_16=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,16                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_38		OR @KPI_REF_ID_38=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-16                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_추가여분2_영업이익율'                     AS KPI_NAME   		--지표명
      ,'DD사업부_추가여분2'                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,16                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_38
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_38
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_16		OR @KPI_REF_ID_16=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
   
/*************************************************
* DD사업부_추가여분3_매출액, 영업이익, 영업이익율
**************************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,17                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,17                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_39		OR @KPI_REF_ID_39=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-17                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_추가여분3_영업이익율'                     AS KPI_NAME   		--지표명
      ,'DD사업부_추가여분3'                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,17                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_39
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_39
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
   
/*************************************************
* DD사업부_추가여분4_매출액, 영업이익, 영업이익율
**************************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,18                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_18		OR @KPI_REF_ID_18=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DD'                                                AS BU                --사업장구분
      ,18                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_40		OR @KPI_REF_ID_40=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-18                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_추가여분4_영업이익율'                     AS KPI_NAME   		--지표명
      ,'DD사업부_추가여분4'                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DD'                                                AS BU                --사업장구분
      ,18                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_40
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_40
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_18		OR @KPI_REF_ID_18=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
/*************************************************
* DO사업부_추가여분1_매출액, 영업이익, 영업이익율
**************************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,19                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_19		OR @KPI_REF_ID_19=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,19                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_41		OR @KPI_REF_ID_41=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-19                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_추가여분1_영업이익율'                     AS KPI_NAME   		--지표명
      ,'DO사업부_추가여분1'                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,19                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_41
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_41
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_19		OR @KPI_REF_ID_19=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
/*************************************************
* DO사업부_추가여분2_매출액, 영업이익, 영업이익율
**************************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,20                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_20		OR @KPI_REF_ID_20=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,20                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_42		OR @KPI_REF_ID_42=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-20                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_추가여분2_영업이익율'                     AS KPI_NAME   		--지표명
      ,'DO사업부_추가여분2'                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,20                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_42
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_42
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_20		OR @KPI_REF_ID_20=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
/*************************************************
* DO사업부_추가여분3_매출액, 영업이익, 영업이익율
**************************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,21                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,21                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_43		OR @KPI_REF_ID_43=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-21                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_추가여분3_영업이익율'                     AS KPI_NAME   		--지표명
      ,'DO사업부_추가여분3'                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,21                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_43
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_43
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
   
/*************************************************
* DO사업부_추가여분4_매출액, 영업이익, 영업이익율
**************************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,22                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_22		OR @KPI_REF_ID_22=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'DO'                                                AS BU                --사업장구분
      ,22                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_44		OR @KPI_REF_ID_44=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-22                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_추가여분4_영업이익율'                     AS KPI_NAME   		--지표명
      ,'DO사업부_추가여분4'                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0   
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'DO'                                                AS BU                --사업장구분
      ,22                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_44
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_44
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_22		OR @KPI_REF_ID_22=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/********************************************
* 천진법인_PTC 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,23                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_45		OR @KPI_REF_ID_45=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,23                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_56		OR @KPI_REF_ID_56=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-23                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_PTC_영업이익율'                           AS KPI_NAME   		--지표명
      ,'PTC'                                               AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,23                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_56
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_56
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_45		OR @KPI_REF_ID_45=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
/********************************************
* 천진법인_VM 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,24                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_46		OR @KPI_REF_ID_46=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,24                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_57		OR @KPI_REF_ID_57=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-24                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_VM_영업이익율'                            AS KPI_NAME   		--지표명
      ,'VM'                                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,24                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_57
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_57
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_46		OR @KPI_REF_ID_46=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
/********************************************
* 천진법인_EV 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,25                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_47		OR @KPI_REF_ID_47=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,25                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_58		OR @KPI_REF_ID_58=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-25                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_EV_영업이익율'                            AS KPI_NAME   		--지표명
      ,'EV'                                                AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,25                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_58
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_58
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_47		OR @KPI_REF_ID_47=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
/********************************************
* 천진법인_AFA 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,26                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_48		OR @KPI_REF_ID_48=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,26                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_59		OR @KPI_REF_ID_59=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-26                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_AFA_영업이익율'                           AS KPI_NAME   		--지표명
      ,'AFA'                                               AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,26                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_59
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_59
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_48		OR @KPI_REF_ID_48=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
/********************************************
* 천진법인_PCM 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,27                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_49		OR @KPI_REF_ID_49=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,27                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_60		OR @KPI_REF_ID_60=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-27                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_PCM_영업이익율'                           AS KPI_NAME   		--지표명
      ,'PCM'                                               AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,27                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_60
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_60
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_49		OR @KPI_REF_ID_49=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
/********************************************
* 천진법인_ROLLER 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,28                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_50		OR @KPI_REF_ID_50=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,28                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_61		OR @KPI_REF_ID_61=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-28                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_ROLLER_영업이익율'                        AS KPI_NAME   		--지표명
      ,'ROLLER'                                            AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,28                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_61
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_61
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_50		OR @KPI_REF_ID_50=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
/********************************************
* 천진법인_기타 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,29                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_51		OR @KPI_REF_ID_51=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,29                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_62		OR @KPI_REF_ID_62=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-29                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_기타_영업이익율'                          AS KPI_NAME   		--지표명
      ,'기타'                                              AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,29                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_62
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_62
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_51		OR @KPI_REF_ID_51=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
/********************************************
* 천진법인_추가여분1 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,30                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_52		OR @KPI_REF_ID_52=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,30                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_63		OR @KPI_REF_ID_63=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-30                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_추가여분1_영업이익율'                     AS KPI_NAME   		--지표명
      ,'추가여분1'                                         AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,30                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_63
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_63
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_52		OR @KPI_REF_ID_52=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/********************************************
* 천진법인_추가여분2 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,31                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_53		OR @KPI_REF_ID_53=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,31                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_64		OR @KPI_REF_ID_64=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-31                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_추가여분2_영업이익율'                     AS KPI_NAME   		--지표명
      ,'추가여분2'                                         AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,31                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_64
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_64
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_53		OR @KPI_REF_ID_53=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/********************************************
* 천진법인_추가여분3 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,32                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_54		OR @KPI_REF_ID_54=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,32                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_65		OR @KPI_REF_ID_65=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-32                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_추가여분3_영업이익율'                     AS KPI_NAME   		--지표명
      ,'추가여분3'                                         AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,32                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_65
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_65
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_54		OR @KPI_REF_ID_54=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/********************************************
* 천진법인_추가여분4 매출액, 영업이익, 영업이익율
*********************************************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,33                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_55		OR @KPI_REF_ID_55=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_MS                                               				--당월실적
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr2.RESULT_TS                                      AS BF_RESULT_TS      --전년동기대비실적
      ,'CJ'                                                AS BU                --사업장구분
      ,33                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_66		OR @KPI_REF_ID_66=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-33                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_추가여분4_영업이익율'                     AS KPI_NAME   		--지표명
      ,'추가여분4'                                         AS ALIAS				--지표별칭
      ,CASE WHEN bkr.RESULT_MS<>0 
            THEN (bkr3.RESULT_MS/bkr.RESULT_MS)*100
            ELSE 0 END                                     AS RESULT_MS    		--당월실적 영업이익율
      ,CASE WHEN bkr.RESULT_TS<>0 
            THEN (bkr3.RESULT_TS/bkr.RESULT_TS)*100
            ELSE 0 END                                     AS RESULT_TS    		--누계실적 영업이익율
      ,CASE WHEN bkr2.RESULT_TS<>0 
            THEN (bkr4.RESULT_TS/bkr2.RESULT_TS)*100
            ELSE 0 END                                     AS BF_RESULT_TS      --전년동기대비실적 영업이익율
      ,'CJ'                                                AS BU                --사업장구분
      ,33                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_66
						  AND bkr3.YMD				  = bkr.YMD
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
                          AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_66
                          AND SUBSTRING(bkr4.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)					  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_55		OR @KPI_REF_ID_55=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds;
        }

        #endregion

        #region =================== 전사 - 예산집행실적 ===============================

        public DataSet GetData_M_1_S_5(int estterm_ref_id
                                     , string ymd)
        {
            string query = 
@"


--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- 전사_제조원가_제조경비
DECLARE @KPI_REF_ID_02 INT   -- 전사_제조원가_노무비
DECLARE @KPI_REF_ID_03 INT   -- 전사_제조원가_재료비
DECLARE @KPI_REF_ID_04 INT   -- 전사_판관비_지원부서
DECLARE @KPI_REF_ID_05 INT   -- 전사_판관비_연구소
DECLARE @KPI_REF_ID_06 INT   -- 전사_판관비_임원
DECLARE @KPI_REF_ID_07 INT   -- 전사_판관비_직접판매비



--SET @ESTTERM_REF_ID =1000                                        
--SET @YMD ='201003'
SET @KPI_REF_ID_01 = 1529                                                                                              
SET @KPI_REF_ID_02 = 1528                                                 
SET @KPI_REF_ID_03 = 1527
SET @KPI_REF_ID_04 = 1533
SET @KPI_REF_ID_05 = 1532
SET @KPI_REF_ID_06 = 1531                                              
SET @KPI_REF_ID_07 = 1530                                                
                                       


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.15
*	Page view  : 전사-예산집행실적 (슬라이드 No.06)
*	Grid 구성
*	관련 KPI : 상단 정의 참조
*	KPI_REF_ID : 상단 정의 참조
*									 
*									 
**************************************************************************/

/****************
*    제조원가
*****************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,0                                                   AS RNF_RATE          --증감율
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,0                                                   AS RNF_RATE          --증감율
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,0                                                   AS RNF_RATE          --증감율
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-1                                                  AS KPI_REF_ID        --지표코드
      ,'제조원가_합계'                                     AS KPI_NAME			--지표명
      ,'제조원가_합계'                                     AS ALIAS				--지표별칭
      ,bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS         AS TARGET_TS  		--누계계획
      ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS         AS RESULT_TS         --누계실적
      ,CASE WHEN (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS)<>0 
            THEN ((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS)/(bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS))*100
            ELSE 0 END                                     AS RNF_RATE          --증감율
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt2.YMD				  = bkr.YMD
						  AND bkt2.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt3.YMD				  = bkr.YMD
						  AND bkt3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
                          AND bkr2.YMD				  = bkr.YMD
                          AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/********************
*    판매비와관리비
*********************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,0                                                   AS RNF_RATE          --증감율
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,0                                                   AS RNF_RATE          --증감율
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,0                                                   AS RNF_RATE          --증감율
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,0                                                   AS RNF_RATE          --증감율
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-2                                                  AS KPI_REF_ID        --지표코드
      ,'판관비_합계'                                       AS KPI_NAME			--지표명
      ,'판관비_합계'                                       AS ALIAS				--지표별칭
      ,bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+bkt4.TARGET_TS         AS TARGET_TS  		--누계계획
      ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+bkr4.RESULT_TS         AS RESULT_TS         --누계실적
      ,CASE WHEN (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+bkt4.TARGET_TS)<>0 
            THEN ((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+bkr4.RESULT_TS)/(bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+bkt4.TARGET_TS))*100
            ELSE 0 END                                     AS RNF_RATE          --증감율
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt2.YMD				  = bkr.YMD
						  AND bkt2.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt3.YMD				  = bkr.YMD
						  AND bkt3.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_TARGET bkt4 ON bkt4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt4.YMD				  = bkr.YMD
						  AND bkt4.KPI_REF_ID		  = @KPI_REF_ID_07
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
                          AND bkr2.YMD				  = bkr.YMD
                          AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_07				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds;
        }

        #endregion

        #region =================== 사업부- 매출원가 ===============================

        public DataSet GetData_M_2_S_6(int estterm_ref_id
                                     , string ymd)
        {
            string query = 
@"

--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부_매출원가_재료비
DECLARE @KPI_REF_ID_02 INT   -- DD사업부_매출원가_노무비
DECLARE @KPI_REF_ID_03 INT   -- DD사업부_매출원가_외주가공비
DECLARE @KPI_REF_ID_04 INT   -- DD사업부_매출원가_감가상각비
DECLARE @KPI_REF_ID_05 INT   -- DD사업부_매출원가_소모품비
DECLARE @KPI_REF_ID_06 INT   -- DD사업부_매출원가_기타

DECLARE @KPI_REF_ID_07 INT   -- DO사업부_매출원가_재료비
DECLARE @KPI_REF_ID_08 INT   -- DO사업부_매출원가_노무비
DECLARE @KPI_REF_ID_09 INT   -- DO사업부_매출원가_외주가공비
DECLARE @KPI_REF_ID_10 INT   -- DO사업부_매출원가_감가상각비
DECLARE @KPI_REF_ID_11 INT   -- DO사업부_매출원가_소모품비
DECLARE @KPI_REF_ID_12 INT   -- DO사업부_매출원가_기타


--SET @ESTTERM_REF_ID =1000                                        
--SET @YMD ='201003'
SET @KPI_REF_ID_01 = 1534                                                                                              
SET @KPI_REF_ID_02 = 1537                                                 
SET @KPI_REF_ID_03 = 1538
SET @KPI_REF_ID_04 = 1536
SET @KPI_REF_ID_05 = 1539
SET @KPI_REF_ID_06 = 1540

SET @KPI_REF_ID_07 = 1541                                                                                              
SET @KPI_REF_ID_08 = 1542                                                 
SET @KPI_REF_ID_09 = 1543
SET @KPI_REF_ID_10 = 1544
SET @KPI_REF_ID_11 = 1545
SET @KPI_REF_ID_12 = 1546                                               


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.16
*	Page view  : DD사업부/DO사업부-매출원가 (슬라이드 No.09,17)
*	Grid 구성
*	관련 KPI : 상단 정의 참조
*	KPI_REF_ID : 상단 정의 참조
*									 
*									 
**************************************************************************/

/********************
* DD사업부_매출원가
*********************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DD'                                                AS BU                --사업장
      ,'Y'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DD'                                                AS BU                --사업장
      ,'Y'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-1                                                  AS KPI_CODE          --지표코드
      ,'DD사업부_매출원가_제조경비'						   AS KPI_NAME			--지표명
      ,'제조경비'	                                       AS ALIAS				--지표별칭
      ,bkt.TARGET_TS+bkt2.TARGET_TS+
       bkt3.TARGET_TS+bkt4.TARGET_TS                       AS TARGET_TS  		--누계계획
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,0                                                   AS RNF               --증감
      ,0                                                   AS EXE_RATE          --집행율
      ,'DD'                                                AS BU                --사업장
      ,'Y'                                                 AS CHART_USE         --Chart사용여부
      ,'N'                                                 AS GRID_USE          --Grid사용여부
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt2  ON bkt2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt2.KPI_REF_ID		  = @KPI_REF_ID_04
						  AND bkt2.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt3  ON bkt3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt3.KPI_REF_ID		  = @KPI_REF_ID_05
						  AND bkt3.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt4  ON bkt4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt4.KPI_REF_ID		  = @KPI_REF_ID_06
						  AND bkt4.YMD				  = bkr.YMD							  				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DD'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DD'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DD'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,6                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DD'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,7                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-2                                                  AS KPI_CODE          --지표코드
      ,'DD사업부_매출원가_합계'	    					   AS KPI_NAME			--지표명
      ,'합계'	                                           AS ALIAS				--지표별칭
      ,bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
       bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS        AS TARGET_TS  		--누계계획
      ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
       bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS        AS RESULT_TS         --누계실적
      ,(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
        bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS)-
       (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
        bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS)      AS RNF               --증감
      ,CASE WHEN (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
				  bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS)<>0 
		    THEN ((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS)/(bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
																  bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS))*100
            ELSE 0 END                                     AS EXE_RATE          --집행율
      ,'DD'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,8                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
 JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt2  ON bkt2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt2.KPI_REF_ID		  = @KPI_REF_ID_02
						  AND bkt2.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt3  ON bkt3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt3.KPI_REF_ID		  = @KPI_REF_ID_03
						  AND bkt3.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt4  ON bkt4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt4.KPI_REF_ID		  = @KPI_REF_ID_04
						  AND bkt4.YMD				  = bkr.YMD	
  JOIN BSC_KPI_TARGET bkt5  ON bkt5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt5.KPI_REF_ID		  = @KPI_REF_ID_05
						  AND bkt5.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt6  ON bkt6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt6.KPI_REF_ID		  = @KPI_REF_ID_06
						  AND bkt6.YMD				  = bkr.YMD				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
/********************
* DO사업부_매출원가
*********************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DO'                                                AS BU                --사업장
      ,'Y'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DO'                                                AS BU                --사업장
      ,'Y'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-3                                                  AS KPI_CODE          --지표코드
      ,'DO사업부_매출원가_제조경비'						   AS KPI_NAME			--지표명
      ,'제조경비'	                                       AS ALIAS				--지표별칭
      ,bkt.TARGET_TS+bkt2.TARGET_TS+
       bkt3.TARGET_TS+bkt4.TARGET_TS                       AS TARGET_TS  		--누계계획
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,0                                                   AS RNF               --증감
      ,0                                                   AS EXE_RATE          --집행율
      ,'DO'                                                AS BU                --사업장
      ,'Y'                                                 AS CHART_USE         --Chart사용여부
      ,'N'                                                 AS GRID_USE          --Grid사용여부
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt2  ON bkt2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt2.KPI_REF_ID		  = @KPI_REF_ID_10
						  AND bkt2.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt3  ON bkt3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt3.KPI_REF_ID		  = @KPI_REF_ID_11
						  AND bkt3.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt4  ON bkt4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt4.KPI_REF_ID		  = @KPI_REF_ID_12
						  AND bkt4.YMD				  = bkr.YMD							  				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DO'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DO'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DO'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,6                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_TS                                               				--누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,bkr.RESULT_TS-bkt.TARGET_TS                         AS RNF               --증감
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
           ELSE 0 END                                      AS EXE_RATE          --집행율
      ,'DO'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,7                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-4                                                  AS KPI_CODE          --지표코드
      ,'DO사업부_매출원가_합계'	    					   AS KPI_NAME			--지표명
      ,'합계'	                                           AS ALIAS				--지표별칭
      ,bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
       bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS        AS TARGET_TS  		--누계계획
      ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
       bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS        AS RESULT_TS         --누계실적
      ,(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
        bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS)-
       (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
        bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS)      AS RNF               --증감
      ,CASE WHEN (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
				  bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS)<>0 
		    THEN ((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS)/(bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
																  bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS))*100
            ELSE 0 END                                     AS EXE_RATE          --집행율
      ,'DO'                                                AS BU                --사업장
      ,'N'                                                 AS CHART_USE         --Chart사용여부
      ,'Y'                                                 AS GRID_USE          --Grid사용여부
      ,8                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
 JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt2  ON bkt2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt2.KPI_REF_ID		  = @KPI_REF_ID_08
						  AND bkt2.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt3  ON bkt3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt3.KPI_REF_ID		  = @KPI_REF_ID_09
						  AND bkt3.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt4  ON bkt4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt4.KPI_REF_ID		  = @KPI_REF_ID_10
						  AND bkt4.YMD				  = bkr.YMD	
  JOIN BSC_KPI_TARGET bkt5  ON bkt5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt5.KPI_REF_ID		  = @KPI_REF_ID_11
						  AND bkt5.YMD				  = bkr.YMD
  JOIN BSC_KPI_TARGET bkt6  ON bkt6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt6.KPI_REF_ID		  = @KPI_REF_ID_12
						  AND bkt6.YMD				  = bkr.YMD				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds;
        }

        #endregion

        #region =================== 사업부- 재고현황 ===============================

        public DataSet GetData_M_2_S_3(int estterm_ref_id
                                     , string ymd)
        {
            string query = 
@"


--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT --DD사업부_PTC_제품
DECLARE @KPI_REF_ID_02 INT --DD사업부_PTC_부품
DECLARE @KPI_REF_ID_03 INT --DD사업부_PTC_원자재
DECLARE @KPI_REF_ID_04 INT --DD사업부_PTC_재공품
                           --
DECLARE @KPI_REF_ID_05 INT --DD사업부_VM_제품
DECLARE @KPI_REF_ID_06 INT --DD사업부_VM_부품
DECLARE @KPI_REF_ID_07 INT --DD사업부_VM_원자재
DECLARE @KPI_REF_ID_08 INT --DD사업부_VM_재공품
                           --
DECLARE @KPI_REF_ID_09 INT --DD사업부_EV_제품
DECLARE @KPI_REF_ID_10 INT --DD사업부_EV_부품
DECLARE @KPI_REF_ID_11 INT --DD사업부_EV_원자재
DECLARE @KPI_REF_ID_12 INT --DD사업부_EV_재공품
                           --
DECLARE @KPI_REF_ID_13 INT --DD사업부_AFA_제품
DECLARE @KPI_REF_ID_14 INT --DD사업부_AFA_부품
DECLARE @KPI_REF_ID_15 INT --DD사업부_AFA_원자재
DECLARE @KPI_REF_ID_16 INT --DD사업부_AFA_재공품
                           --
DECLARE @KPI_REF_ID_17 INT --DD사업부_ALC_제품
DECLARE @KPI_REF_ID_18 INT --DD사업부_ALC_부품
DECLARE @KPI_REF_ID_19 INT --DD사업부_ALC_원자재
DECLARE @KPI_REF_ID_20 INT --DD사업부_ALC_재공품
                           --
DECLARE @KPI_REF_ID_21 INT --DD사업부_기타_제품
DECLARE @KPI_REF_ID_22 INT --DD사업부_기타_부품
DECLARE @KPI_REF_ID_23 INT --DD사업부_기타_원자재
DECLARE @KPI_REF_ID_24 INT --DD사업부_기타_재공품
                           --
DECLARE @KPI_REF_ID_25 INT --DD사업부_추가여분1_제품
DECLARE @KPI_REF_ID_26 INT --DD사업부_추가여분1_부품
DECLARE @KPI_REF_ID_27 INT --DD사업부_추가여분1_원자재
DECLARE @KPI_REF_ID_28 INT --DD사업부_추가여분1_재공품
                           --
DECLARE @KPI_REF_ID_29 INT --DD사업부_추가여분2_제품
DECLARE @KPI_REF_ID_30 INT --DD사업부_추가여분2_부품
DECLARE @KPI_REF_ID_31 INT --DD사업부_추가여분2_원자재
DECLARE @KPI_REF_ID_32 INT --DD사업부_추가여분2_재공품
                           --
DECLARE @KPI_REF_ID_33 INT --DD사업부_추가여분3_제품
DECLARE @KPI_REF_ID_34 INT --DD사업부_추가여분3_부품
DECLARE @KPI_REF_ID_35 INT --DD사업부_추가여분3_원자재
DECLARE @KPI_REF_ID_36 INT --DD사업부_추가여분3_재공품
                           --
DECLARE @KPI_REF_ID_37 INT --DD사업부_추가여분4_제품
DECLARE @KPI_REF_ID_38 INT --DD사업부_추가여분4_부품
DECLARE @KPI_REF_ID_39 INT --DD사업부_추가여분4_원자재
DECLARE @KPI_REF_ID_40 INT --DD사업부_추가여분4_재공품
                           --
DECLARE @KPI_REF_ID_41 INT --DO사업부_PCM_제품
DECLARE @KPI_REF_ID_42 INT --DO사업부_PCM_부품
DECLARE @KPI_REF_ID_43 INT --DO사업부_PCM_원자재
DECLARE @KPI_REF_ID_44 INT --DO사업부_PCM_재공품
                           --
DECLARE @KPI_REF_ID_45 INT --DO사업부_TS_제품
DECLARE @KPI_REF_ID_46 INT --DO사업부_TS_부품
DECLARE @KPI_REF_ID_47 INT --DO사업부_TS_원자재
DECLARE @KPI_REF_ID_48 INT --DO사업부_TS_재공품
                           --
DECLARE @KPI_REF_ID_49 INT --DO사업부_Roller_제품
DECLARE @KPI_REF_ID_50 INT --DO사업부_Roller_부품
DECLARE @KPI_REF_ID_51 INT --DO사업부_Roller_원자재
DECLARE @KPI_REF_ID_52 INT --DO사업부_Roller_재공품
                           --
DECLARE @KPI_REF_ID_53 INT --DO사업부_Sleeve_제품
DECLARE @KPI_REF_ID_54 INT --DO사업부_Sleeve_부품
DECLARE @KPI_REF_ID_55 INT --DO사업부_Sleeve_원자재
DECLARE @KPI_REF_ID_56 INT --DO사업부_Sleeve_재공품
                           --
DECLARE @KPI_REF_ID_57 INT --DO사업부_CTR_제품
DECLARE @KPI_REF_ID_58 INT --DO사업부_CTR_부품
DECLARE @KPI_REF_ID_59 INT --DO사업부_CTR_원자재
DECLARE @KPI_REF_ID_60 INT --DO사업부_CTR_재공품
                           --
DECLARE @KPI_REF_ID_61 INT --DO사업부_FCCL_제품
DECLARE @KPI_REF_ID_62 INT --DO사업부_FCCL_부품
DECLARE @KPI_REF_ID_63 INT --DO사업부_FCCL_원자재
DECLARE @KPI_REF_ID_64 INT --DO사업부_FCCL_재공품
                           --
DECLARE @KPI_REF_ID_65 INT --DO사업부_Film_제품
DECLARE @KPI_REF_ID_66 INT --DO사업부_Film_부품
DECLARE @KPI_REF_ID_67 INT --DO사업부_Film_원자재
DECLARE @KPI_REF_ID_68 INT --DO사업부_Film_재공품
                           --
DECLARE @KPI_REF_ID_69 INT --DO사업부_기타_제품
DECLARE @KPI_REF_ID_70 INT --DO사업부_기타_부품
DECLARE @KPI_REF_ID_71 INT --DO사업부_기타_원자재
DECLARE @KPI_REF_ID_72 INT --DO사업부_기타_재공품
                           --
DECLARE @KPI_REF_ID_73 INT --DO사업부_추가여분1_제품
DECLARE @KPI_REF_ID_74 INT --DO사업부_추가여분1_부품
DECLARE @KPI_REF_ID_75 INT --DO사업부_추가여분1_원자재
DECLARE @KPI_REF_ID_76 INT --DO사업부_추가여분1_재공품
                           --
DECLARE @KPI_REF_ID_77 INT --DO사업부_추가여분2_제품
DECLARE @KPI_REF_ID_78 INT --DO사업부_추가여분2_부품
DECLARE @KPI_REF_ID_79 INT --DO사업부_추가여분2_원자재
DECLARE @KPI_REF_ID_80 INT --DO사업부_추가여분2_재공품
                           --
DECLARE @KPI_REF_ID_81 INT --DO사업부_추가여분3_제품
DECLARE @KPI_REF_ID_82 INT --DO사업부_추가여분3_부품
DECLARE @KPI_REF_ID_83 INT --DO사업부_추가여분3_원자재
DECLARE @KPI_REF_ID_84 INT --DO사업부_추가여분3_재공품
                           --
DECLARE @KPI_REF_ID_85 INT --DO사업부_추가여분4_제품
DECLARE @KPI_REF_ID_86 INT --DO사업부_추가여분4_부품
DECLARE @KPI_REF_ID_87 INT --DO사업부_추가여분4_원자재
DECLARE @KPI_REF_ID_88 INT --DO사업부_추가여분4_재공품
                           --
--천진법인                           
                           
DECLARE @KPI_REF_ID_89  INT --천진법인_PTC_제품         
DECLARE @KPI_REF_ID_90  INT --천진법인_PTC_부품         
DECLARE @KPI_REF_ID_91  INT --천진법인_PTC_원자재       
DECLARE @KPI_REF_ID_92  INT --천진법인_PTC_재공품       
                                                       
DECLARE @KPI_REF_ID_93  INT --천진법인_VM_제품          
DECLARE @KPI_REF_ID_94  INT --천진법인_VM_부품          
DECLARE @KPI_REF_ID_95  INT --천진법인_VM_원자재        
DECLARE @KPI_REF_ID_96  INT --천진법인_VM_재공품        
                                                       
DECLARE @KPI_REF_ID_97  INT --천진법인_EV_제품          
DECLARE @KPI_REF_ID_98  INT --천진법인_EV_부품          
DECLARE @KPI_REF_ID_99  INT --천진법인_EV_원자재        
DECLARE @KPI_REF_ID_100 INT --천진법인_EV_재공품       
                                                       
DECLARE @KPI_REF_ID_101 INT --천진법인_AFA_제품         
DECLARE @KPI_REF_ID_102 INT --천진법인_AFA_부품         
DECLARE @KPI_REF_ID_103 INT --천진법인_AFA_원자재       
DECLARE @KPI_REF_ID_104 INT --천진법인_AFA_재공품       
                                                       
DECLARE @KPI_REF_ID_105 INT --천진법인_PCM_제품         
DECLARE @KPI_REF_ID_106 INT --천진법인_PCM_부품         
DECLARE @KPI_REF_ID_107 INT --천진법인_PCM_원자재       
DECLARE @KPI_REF_ID_108 INT --천진법인_PCM_재공품      
                         
DECLARE @KPI_REF_ID_109 INT --천진법인_ROLLER_제품      
DECLARE @KPI_REF_ID_110 INT --천진법인_ROLLER_부품      
DECLARE @KPI_REF_ID_111 INT --천진법인_ROLLER_원자재    
DECLARE @KPI_REF_ID_112 INT --천진법인_ROLLER_재공품   
                         
DECLARE @KPI_REF_ID_113 INT --천진법인_기타_제품        
DECLARE @KPI_REF_ID_114 INT --천진법인_기타_부품        
DECLARE @KPI_REF_ID_115 INT --천진법인_기타_원자재      
DECLARE @KPI_REF_ID_116 INT --천진법인_기타_재공품      
                                                       
DECLARE @KPI_REF_ID_117 INT --천진법인_추가여분1_제품   
DECLARE @KPI_REF_ID_118 INT --천진법인_추가여분1_부품   
DECLARE @KPI_REF_ID_119 INT --천진법인_추가여분1_원자재 
DECLARE @KPI_REF_ID_120 INT --천진법인_추가여분1_재공품 
                                                       
DECLARE @KPI_REF_ID_121 INT --천진법인_추가여분2_제품   
DECLARE @KPI_REF_ID_122 INT --천진법인_추가여분2_부품   
DECLARE @KPI_REF_ID_123 INT --천진법인_추가여분2_원자재 
DECLARE @KPI_REF_ID_124 INT --천진법인_추가여분2_재공품
                          
DECLARE @KPI_REF_ID_125 INT --천진법인_추가여분3_제품   
DECLARE @KPI_REF_ID_126 INT --천진법인_추가여분3_부품   
DECLARE @KPI_REF_ID_127 INT --천진법인_추가여분3_원자재 
DECLARE @KPI_REF_ID_128 INT --천진법인_추가여분3_재공품 
                          
DECLARE @KPI_REF_ID_129 INT --천진법인_추가여분4_제품   
DECLARE @KPI_REF_ID_130 INT --천진법인_추가여분4_부품   
DECLARE @KPI_REF_ID_131 INT --천진법인_추가여분4_원자재 
DECLARE @KPI_REF_ID_132 INT --천진법인_추가여분4_재공품 


--SET @ESTTERM_REF_ID =1000
--SET @YMD ='201003'
SET @KPI_REF_ID_01 = 1547     SET @KPI_REF_ID_17 = 1563      SET @KPI_REF_ID_33 = 1579     SET @KPI_REF_ID_49 = 1595
SET @KPI_REF_ID_02 = 1548     SET @KPI_REF_ID_18 = 1564      SET @KPI_REF_ID_34 = 1580     SET @KPI_REF_ID_50 = 1596
SET @KPI_REF_ID_03 = 1549     SET @KPI_REF_ID_19 = 1565      SET @KPI_REF_ID_35 = 1581     SET @KPI_REF_ID_51 = 1597
SET @KPI_REF_ID_04 = 1550     SET @KPI_REF_ID_20 = 1566      SET @KPI_REF_ID_36 = 1582     SET @KPI_REF_ID_52 = 1598
                                                                                                      
SET @KPI_REF_ID_05 = 1551     SET @KPI_REF_ID_21 = 1567      SET @KPI_REF_ID_37 = 1583     SET @KPI_REF_ID_53 = 1599
SET @KPI_REF_ID_06 = 1552     SET @KPI_REF_ID_22 = 1568      SET @KPI_REF_ID_38 = 1584     SET @KPI_REF_ID_54 = 1600
SET @KPI_REF_ID_07 = 1553     SET @KPI_REF_ID_23 = 1569      SET @KPI_REF_ID_39 = 1585     SET @KPI_REF_ID_55 = 1601
SET @KPI_REF_ID_08 = 1554     SET @KPI_REF_ID_24 = 1570      SET @KPI_REF_ID_40 = 1586     SET @KPI_REF_ID_56 = 1602
                                                                                                      
SET @KPI_REF_ID_09 = 1555     SET @KPI_REF_ID_25 = 1571      SET @KPI_REF_ID_41 = 1587     SET @KPI_REF_ID_57 = 1603
SET @KPI_REF_ID_10 = 1556     SET @KPI_REF_ID_26 = 1572      SET @KPI_REF_ID_42 = 1588     SET @KPI_REF_ID_58 = 1604
SET @KPI_REF_ID_11 = 1557     SET @KPI_REF_ID_27 = 1573      SET @KPI_REF_ID_43 = 1589     SET @KPI_REF_ID_59 = 1605
SET @KPI_REF_ID_12 = 1558     SET @KPI_REF_ID_28 = 1574      SET @KPI_REF_ID_44 = 1590     SET @KPI_REF_ID_60 = 1606
                                                                                                      
SET @KPI_REF_ID_13 = 1559     SET @KPI_REF_ID_29 = 1575      SET @KPI_REF_ID_45 = 1591     SET @KPI_REF_ID_61 = 1607
SET @KPI_REF_ID_14 = 1560     SET @KPI_REF_ID_30 = 1576      SET @KPI_REF_ID_46 = 1592     SET @KPI_REF_ID_62 = 1608
SET @KPI_REF_ID_15 = 1561     SET @KPI_REF_ID_31 = 1577      SET @KPI_REF_ID_47 = 1593     SET @KPI_REF_ID_63 = 1609
SET @KPI_REF_ID_16 = 1562     SET @KPI_REF_ID_32 = 1578      SET @KPI_REF_ID_48 = 1594     SET @KPI_REF_ID_64 = 1610
                                                                                                                                          
SET @KPI_REF_ID_65 = 1611     SET @KPI_REF_ID_81 = 1627  
SET @KPI_REF_ID_66 = 1612     SET @KPI_REF_ID_82 = 1628  
SET @KPI_REF_ID_67 = 1613     SET @KPI_REF_ID_83 = 1629
SET @KPI_REF_ID_68 = 1614     SET @KPI_REF_ID_84 = 1630
                             
SET @KPI_REF_ID_69 = 1615     SET @KPI_REF_ID_85 = 1631
SET @KPI_REF_ID_70 = 1616     SET @KPI_REF_ID_86 = 1632
SET @KPI_REF_ID_71 = 1617     SET @KPI_REF_ID_87 = 1633
SET @KPI_REF_ID_72 = 1618     SET @KPI_REF_ID_88 = 1634

SET @KPI_REF_ID_73 = 1619
SET @KPI_REF_ID_74 = 1620
SET @KPI_REF_ID_75 = 1621
SET @KPI_REF_ID_76 = 1622

SET @KPI_REF_ID_77 = 1623
SET @KPI_REF_ID_78 = 1624
SET @KPI_REF_ID_79 = 1625
SET @KPI_REF_ID_80 = 1626

--천진법인

SET @KPI_REF_ID_89  = 1657      SET @KPI_REF_ID_97  = 1665      SET @KPI_REF_ID_105 = 1673
SET @KPI_REF_ID_90  = 1658      SET @KPI_REF_ID_98  = 1666      SET @KPI_REF_ID_106 = 1674
SET @KPI_REF_ID_91  = 1659      SET @KPI_REF_ID_99  = 1667      SET @KPI_REF_ID_107 = 1675
SET @KPI_REF_ID_92  = 1660      SET @KPI_REF_ID_100 = 1668      SET @KPI_REF_ID_108 = 1676
                                                                                          
SET @KPI_REF_ID_93  = 1661      SET @KPI_REF_ID_101 = 1669      SET @KPI_REF_ID_109 = 1677
SET @KPI_REF_ID_94  = 1662      SET @KPI_REF_ID_102 = 1670      SET @KPI_REF_ID_110 = 1678
SET @KPI_REF_ID_95  = 1663      SET @KPI_REF_ID_103 = 1671      SET @KPI_REF_ID_111 = 1679
SET @KPI_REF_ID_96  = 1664      SET @KPI_REF_ID_104 = 1672      SET @KPI_REF_ID_112 = 1680

             
SET @KPI_REF_ID_113 = 1681      SET @KPI_REF_ID_121 = 1689      SET @KPI_REF_ID_129 = 1697
SET @KPI_REF_ID_114 = 1682      SET @KPI_REF_ID_122 = 1690      SET @KPI_REF_ID_130 = 1698
SET @KPI_REF_ID_115 = 1683      SET @KPI_REF_ID_123 = 1691      SET @KPI_REF_ID_131 = 1699
SET @KPI_REF_ID_116 = 1684      SET @KPI_REF_ID_124 = 1692      SET @KPI_REF_ID_132 = 1700
                                                          
SET @KPI_REF_ID_117 = 1685      SET @KPI_REF_ID_125 = 1693
SET @KPI_REF_ID_118 = 1686      SET @KPI_REF_ID_126 = 1694
SET @KPI_REF_ID_119 = 1687      SET @KPI_REF_ID_127 = 1695
SET @KPI_REF_ID_120 = 1688      SET @KPI_REF_ID_128 = 1696


    


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.16
*	Page view  : DD사업부/DO사업부-ITEM별-재고현황 (슬라이드 No.12,20)
*	Grid 구성
*	관련 KPI : 상단 정의 참조
*	KPI_REF_ID : 상단 정의 참조
*									 
*									 
**************************************************************************/

/**************
* DD사업부
***************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,1												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,2												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,3												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,4												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-1                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_PTC_총제고'	                           AS KPI_NAME      	--지표명
      ,'PTC_총제고'                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,5												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_02	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,6												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,7												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,8												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,9												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-2                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_VM_총제고'	                               AS KPI_NAME      	--지표명
      ,'VM_총제고'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,10												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_06	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_07
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_08					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,11												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,12												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,13												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,14												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-3                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_EV_총제고'	                               AS KPI_NAME      	--지표명
      ,'EV_총제고'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,15												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_10	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_12					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,16												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,17												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_14		OR @KPI_REF_ID_14=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,18												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_15		OR @KPI_REF_ID_15=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,19												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_16		OR @KPI_REF_ID_16=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-4                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_AFA_총제고'	                           AS KPI_NAME      	--지표명
      ,'AFA_총제고'                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,20												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_16					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,21												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,22												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_18		OR @KPI_REF_ID_18=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,23												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_19		OR @KPI_REF_ID_19=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,24												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_20		OR @KPI_REF_ID_20=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-5                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_ALC_총제고'	                           AS KPI_NAME      	--지표명
      ,'ALC_총제고'                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,25												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_18	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_19
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_20					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,26												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,27												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_22		OR @KPI_REF_ID_22=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,28												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_23		OR @KPI_REF_ID_23=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,29												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_24		OR @KPI_REF_ID_24=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-6                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_기타_총제고'	                           AS KPI_NAME      	--지표명
      ,'기타_총제고'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,30												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_22	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_23
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_24					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,31												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_25		OR @KPI_REF_ID_25=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,32												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_26		OR @KPI_REF_ID_26=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,33												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_27		OR @KPI_REF_ID_27=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,34												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_28		OR @KPI_REF_ID_28=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-7                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_추가여분1_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분1_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,35												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_26	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_28					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_25		OR @KPI_REF_ID_25=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,36												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_29		OR @KPI_REF_ID_29=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,37												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_30		OR @KPI_REF_ID_30=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,38												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_31		OR @KPI_REF_ID_31=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,39												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_32		OR @KPI_REF_ID_32=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-8                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_추가여분2_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분2_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,40												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_31
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_32					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_29		OR @KPI_REF_ID_29=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,41												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_33		OR @KPI_REF_ID_33=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,42												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_34		OR @KPI_REF_ID_34=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,43												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_35		OR @KPI_REF_ID_35=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,44												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_36		OR @KPI_REF_ID_36=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-9                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_추가여분3_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분3_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,45												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_33		OR @KPI_REF_ID_33=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,46												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_37		OR @KPI_REF_ID_37=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,47												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_38		OR @KPI_REF_ID_38=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,48												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_39		OR @KPI_REF_ID_39=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,49												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_40		OR @KPI_REF_ID_40=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-10                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_추가여분4_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분4_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,50												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_38	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_40					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_37		OR @KPI_REF_ID_37=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-11                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_제품_합계'                                AS KPI_NAME      	--지표명
      ,'제품_합계'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS                      AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,51												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_05	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_21	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_25	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_29	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_33	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_37					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-12                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_부품_합계'                                AS KPI_NAME      	--지표명
      ,'부품_합계'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS                      AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,52												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_06	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_18	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_22	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_26	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_34	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_38					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-13                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_원자재_합계'                              AS KPI_NAME      	--지표명
      ,'원자재_합계'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS                      AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,53												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_15	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_23	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_27	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_35	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_39					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-14                                                 AS KPI_REF_ID        --지표코드
      ,'DD사업부_재공품_합계'                              AS KPI_NAME      	--지표명
      ,'재공품_합계'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS                      AS RESULT_TS         --누계실적
      ,'DD'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,54												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_08	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_20	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_24	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_28	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_32	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_36	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_40					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT SUM_ITEM.ESTTERM_REF_ID                                                      --평가년
	  ,SUM_ITEM.YMD                                                                 --평가월
	  ,-15                                                      AS KPI_REF_ID       --지표코드
	  ,'DD사업부_총제고_합계'                                   AS KPI_NAME         --지표명
	  ,'총제고_합계'                                            AS ALIAS            --지표별칭
	  ,SUM(SUM_ITEM.RESULT_TS)                                  AS RESULT_TS        --누계실적
	  ,'DD'                                                     AS BU               --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
	  ,55                                                       AS SORT_ORDER       --정렬순서
FROM (
      	   SELECT bkr.ESTTERM_REF_ID                                                  --평가년 
      	    ,bkr.YMD                                                                  --평가월
            ,-11                                                 AS KPI_REF_ID        --지표코드
            ,'DD사업부_제품_합계'                                AS KPI_NAME          --지표명
            ,'제품_합계'                                         AS ALIAS			  --지표별칭
            ,bkr.RESULT_TS+bkr2.RESULT_TS+
             bkr3.RESULT_TS+bkr4.RESULT_TS+
             bkr5.RESULT_TS+bkr6.RESULT_TS+
             bkr7.RESULT_TS+bkr8.RESULT_TS+
             bkr9.RESULT_TS+bkr10.RESULT_TS                      AS RESULT_TS         --누계실적
            ,'DD'                                                AS BU                --사업장구분
            ,51												     AS SORT_ORDER        --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr2.YMD				  = bkr.YMD
      						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_05	
        JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr3.YMD				  = bkr.YMD
      						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
        JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr4.YMD				  = bkr.YMD
      						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_13	
        JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr5.YMD				  = bkr.YMD
      						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_17	
        JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr6.YMD				  = bkr.YMD
      						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_21	
        JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr7.YMD				  = bkr.YMD
      						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_25	
        JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr8.YMD				  = bkr.YMD
      						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_29	
        JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr9.YMD				  = bkr.YMD
      						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_33	
        JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr10.YMD				  = bkr.YMD
      						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_37					  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
      	    ,bkr.YMD                                                                  --평가월
            ,-12                                                 AS KPI_REF_ID        --지표코드
            ,'DD사업부_부품_합계'                                AS KPI_NAME          --지표명
            ,'부품_합계'                                         AS ALIAS			  --지표별칭
            ,bkr.RESULT_TS+bkr2.RESULT_TS+
             bkr3.RESULT_TS+bkr4.RESULT_TS+
             bkr5.RESULT_TS+bkr6.RESULT_TS+
             bkr7.RESULT_TS+bkr8.RESULT_TS+
             bkr9.RESULT_TS+bkr10.RESULT_TS                      AS RESULT_TS         --누계실적
            ,'DD'                                                AS BU                --사업장구분
            ,52												     AS SORT_ORDER        --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr2.YMD				  = bkr.YMD
      						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_06	
        JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr3.YMD				  = bkr.YMD
      						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_10
        JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr4.YMD				  = bkr.YMD
      						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_14	
        JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr5.YMD				  = bkr.YMD
      						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_18	
        JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr6.YMD				  = bkr.YMD
      						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_22	
        JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr7.YMD				  = bkr.YMD
      						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_26	
        JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr8.YMD				  = bkr.YMD
      						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
        JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr9.YMD				  = bkr.YMD
      						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_34	
        JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr10.YMD				  = bkr.YMD
      						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_38					  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
        	  ,bkr.YMD                                                                --평가월
            ,-13                                                 AS KPI_REF_ID        --지표코드
            ,'DD사업부_원자재_합계'                              AS KPI_NAME          --지표명
            ,'원자재_합계'                                       AS ALIAS			  --지표별칭
            ,bkr.RESULT_TS+bkr2.RESULT_TS+
             bkr3.RESULT_TS+bkr4.RESULT_TS+
             bkr5.RESULT_TS+bkr6.RESULT_TS+
             bkr7.RESULT_TS+bkr8.RESULT_TS+
             bkr9.RESULT_TS+bkr10.RESULT_TS                      AS RESULT_TS         --누계실적
            ,'DD'                                                AS BU                --사업장구분
            ,53												     AS SORT_ORDER        --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr2.YMD				  = bkr.YMD
      						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07	
        JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr3.YMD				  = bkr.YMD
      						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_11
        JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr4.YMD				  = bkr.YMD
      						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_15	
        JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr5.YMD				  = bkr.YMD
      						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_19	
        JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr6.YMD				  = bkr.YMD
      						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_23	
        JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr7.YMD				  = bkr.YMD
      						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_27	
        JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr8.YMD				  = bkr.YMD
      						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_31	
        JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr9.YMD				  = bkr.YMD
      						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_35	
        JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr10.YMD				  = bkr.YMD
      						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_39					  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
      	    ,bkr.YMD                                                                   --평가월
            ,-14                                                 AS KPI_REF_ID         --지표코드
            ,'DD사업부_재공품_합계'                              AS KPI_NAME      	   --지표명
            ,'재공품_합계'                                       AS ALIAS			   --지표별칭
            ,bkr.RESULT_TS+bkr2.RESULT_TS+
             bkr3.RESULT_TS+bkr4.RESULT_TS+
             bkr5.RESULT_TS+bkr6.RESULT_TS+
             bkr7.RESULT_TS+bkr8.RESULT_TS+
             bkr9.RESULT_TS+bkr10.RESULT_TS                      AS RESULT_TS         --누계실적
            ,'DD'                                                AS BU                --사업장구분
            ,54												     AS SORT_ORDER        --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr2.YMD				  = bkr.YMD
      						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_08	
        JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr3.YMD				  = bkr.YMD
      						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_12
        JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr4.YMD				  = bkr.YMD
      						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_16	
        JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr5.YMD				  = bkr.YMD
      						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_20	
        JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr6.YMD				  = bkr.YMD
      						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_24	
        JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr7.YMD				  = bkr.YMD
      						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_28	
        JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr8.YMD				  = bkr.YMD
      						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_32	
        JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr9.YMD				  = bkr.YMD
      						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_36	
        JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
      						  AND bkr10.YMD				  = bkr.YMD
      						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_40					  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
	    ) AS SUM_ITEM
GROUP BY SUM_ITEM.ESTTERM_REF_ID, SUM_ITEM.YMD
   
   
   
   
/********************
* DO사업부
*********************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,56												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_41		OR @KPI_REF_ID_41=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,57												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_42		OR @KPI_REF_ID_42=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,58												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_43		OR @KPI_REF_ID_43=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,59												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_44		OR @KPI_REF_ID_44=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-16                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_PCM_총제고'                               AS KPI_NAME      	--지표명
      ,'PCM_총제고'                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,60												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_44					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_41		OR @KPI_REF_ID_41=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,61												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_45		OR @KPI_REF_ID_45=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,62												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_46		OR @KPI_REF_ID_46=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,63												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_47		OR @KPI_REF_ID_47=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,64												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_48		OR @KPI_REF_ID_48=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-17                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_TS_총제고'                                AS KPI_NAME      	--지표명
      ,'TS_총제고'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,65												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_46	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_47
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_48					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_45		OR @KPI_REF_ID_45=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,66												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_49		OR @KPI_REF_ID_49=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,67												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_50		OR @KPI_REF_ID_50=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,68												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_51		OR @KPI_REF_ID_51=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,69												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_52		OR @KPI_REF_ID_52=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-18                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_Roller_총제고'                            AS KPI_NAME      	--지표명
      ,'Roller_총제고'                                     AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_03'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,70												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_50	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_51
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_52					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_49		OR @KPI_REF_ID_49=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,71												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_53		OR @KPI_REF_ID_53=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,72												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_54		OR @KPI_REF_ID_54=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,73												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_55		OR @KPI_REF_ID_55=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,74												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_56		OR @KPI_REF_ID_56=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-19                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_Sleeve_총제고'                            AS KPI_NAME      	--지표명
      ,'Sleeve_총제고'                                     AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_04'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,75												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_54	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_55
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_56					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_53		OR @KPI_REF_ID_53=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,76												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_57		OR @KPI_REF_ID_57=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,77												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_58		OR @KPI_REF_ID_58=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,78												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_59		OR @KPI_REF_ID_59=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,79												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_60		OR @KPI_REF_ID_60=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-20                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_CTR_총제고'                               AS KPI_NAME      	--지표명
      ,'CTR_총제고'                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_05'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,80												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_58	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_59
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_60					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_57		OR @KPI_REF_ID_57=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,81												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_61		OR @KPI_REF_ID_61=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,82												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_62		OR @KPI_REF_ID_62=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,83												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_63		OR @KPI_REF_ID_63=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,84												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_64		OR @KPI_REF_ID_64=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-21                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_FCCL_총제고'                              AS KPI_NAME      	--지표명
      ,'FCCL_총제고'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_06'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,85												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_62	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_63
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_64					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_61		OR @KPI_REF_ID_61=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,86												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_65		OR @KPI_REF_ID_65=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,87												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_66		OR @KPI_REF_ID_66=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,88												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_67		OR @KPI_REF_ID_67=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,89												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_68		OR @KPI_REF_ID_68=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-22                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_Film_총제고'                              AS KPI_NAME      	--지표명
      ,'Film_총제고'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_07'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,90												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_66	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_67
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_68					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_65		OR @KPI_REF_ID_65=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,91												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_69		OR @KPI_REF_ID_69=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,92												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_70		OR @KPI_REF_ID_70=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,93												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_71		OR @KPI_REF_ID_71=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,94												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_72		OR @KPI_REF_ID_72=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-23                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_기타_총제고'                              AS KPI_NAME      	--지표명
      ,'기타_총제고'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_08'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,95												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_70	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_71
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_72					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_69		OR @KPI_REF_ID_69=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,96												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_73		OR @KPI_REF_ID_73=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,97												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_74		OR @KPI_REF_ID_74=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,98												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_75		OR @KPI_REF_ID_75=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,99												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_76		OR @KPI_REF_ID_76=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-24                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_추가여분1_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분1_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_09'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,100												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_74	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_75
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_76					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_73		OR @KPI_REF_ID_73=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,101												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_77		OR @KPI_REF_ID_77=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,102												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_78		OR @KPI_REF_ID_78=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,103												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_79		OR @KPI_REF_ID_79=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,104												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_80		OR @KPI_REF_ID_80=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-25                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_추가여분2_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분2_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_10'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,105												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_78	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_79
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_80					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_77		OR @KPI_REF_ID_77=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,106												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_81		OR @KPI_REF_ID_81=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,107												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_82		OR @KPI_REF_ID_82=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,108												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_83		OR @KPI_REF_ID_83=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,109												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_84		OR @KPI_REF_ID_84=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-26                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_추가여분3_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분3_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_11'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,110												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_82	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_83
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_84					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_81		OR @KPI_REF_ID_81=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_12'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,111												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_85		OR @KPI_REF_ID_85=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_12'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,112												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_86		OR @KPI_REF_ID_86=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_12'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,113												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_87		OR @KPI_REF_ID_87=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_12'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,114												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_88		OR @KPI_REF_ID_88=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-27                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_추가여분4_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분4_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_12'                                             AS ITEM_CODE         --ITEM코드
      ,'S_05'                                             AS STOCK_CODE        --재고코드
      ,115												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_86	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_87
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_88					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_85		OR @KPI_REF_ID_85=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-28                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_제품_합계'                                AS KPI_NAME      	--지표명
      ,'제품_합계'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS+
       bkr11.RESULT_TS+bkr12.RESULT_TS                     AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_13'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,116												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_45	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_49
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_53	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_57	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_61	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_65	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_69	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_73	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_77
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_81
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_85 					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_41		OR @KPI_REF_ID_41=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-29                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_부품_합계'                                AS KPI_NAME      	--지표명
      ,'부품_합계'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS+
       bkr11.RESULT_TS+bkr12.RESULT_TS                     AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_13'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,117												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_46	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_50
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_54	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_58	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_62	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_66	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_70	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_74	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_78
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_82
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_86 					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_42		OR @KPI_REF_ID_42=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-30                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_원자재_합계'                              AS KPI_NAME      	--지표명
      ,'원자재_합계'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS+
       bkr11.RESULT_TS+bkr12.RESULT_TS                     AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_13'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,118												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_47	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_51
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_55	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_59	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_63	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_67	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_71	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_75	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_79
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_83
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_87 					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_43		OR @KPI_REF_ID_43=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-31                                                 AS KPI_REF_ID        --지표코드
      ,'DO사업부_재공품_합계'                              AS KPI_NAME      	--지표명
      ,'재공품_합계'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS+
       bkr11.RESULT_TS+bkr12.RESULT_TS                     AS RESULT_TS         --누계실적
      ,'DO'                                                AS BU                --사업장구분
      ,'I_13'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,119												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_48	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_52
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_56	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_60	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_64	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_68	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_72	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_76	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_80
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_84
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_88 					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_44		OR @KPI_REF_ID_44=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT SUM_ITEM.ESTTERM_REF_ID                                                      --평가년
	  ,SUM_ITEM.YMD                                                                 --평가월
	  ,-32                                                      AS KPI_REF_ID       --지표코드
	  ,'DO사업부_총제고_합계'                                   AS KPI_NAME         --지표명
	  ,'총제고_합계'                                            AS ALIAS            --지표별칭
	  ,SUM(SUM_ITEM.RESULT_TS)                                  AS RESULT_TS        --누계실적
	  ,'DO'                                                     AS BU               --사업장구분
      ,'I_13'                                                  AS ITEM_CODE        --ITEM코드
      ,'S_05'                                                  AS STOCK_CODE       --재고코드
	  ,120                                                      AS SORT_ORDER       --정렬순서
FROM (
      	   SELECT bkr.ESTTERM_REF_ID                                                 --평가년 
     	   ,bkr.YMD                                                                  --평가월
           ,-28                                                 AS KPI_REF_ID        --지표코드
           ,'DO사업부_제품_합계'                                AS KPI_NAME          --지표명
           ,'제품_합계'                                         AS ALIAS			 --지표별칭
           ,bkr.RESULT_TS+bkr2.RESULT_TS+
            bkr3.RESULT_TS+bkr4.RESULT_TS+
            bkr5.RESULT_TS+bkr6.RESULT_TS+
            bkr7.RESULT_TS+bkr8.RESULT_TS+
            bkr9.RESULT_TS+bkr10.RESULT_TS+
            bkr11.RESULT_TS+bkr12.RESULT_TS                     AS RESULT_TS         --누계실적
           ,'DO'                                                AS BU                --사업장구분
           ,'I_13'                                             AS ITEM_CODE         --ITEM코드
           ,'S_01'                                             AS STOCK_CODE        --재고코드
           ,116												   AS SORT_ORDER         --정렬순서
       FROM BSC_KPI_RESULT bkr
       JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr2.YMD				  = bkr.YMD
     						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_45	
       JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr3.YMD				  = bkr.YMD
     						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_49
       JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr4.YMD				  = bkr.YMD
     						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_53	
       JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr5.YMD				  = bkr.YMD
     						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_57	
       JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr6.YMD				  = bkr.YMD
     						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_61	
       JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr7.YMD				  = bkr.YMD
     						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_65	
       JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr8.YMD				  = bkr.YMD
     						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_69	
       JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr9.YMD				  = bkr.YMD
     						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_73	
       JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr10.YMD				  = bkr.YMD
     						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_77
       JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr11.YMD				  = bkr.YMD
     						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_81
       JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr12.YMD				  = bkr.YMD
     						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_85 					  						   						  					      		
      WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
        AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_41		OR @KPI_REF_ID_41=0)
        AND (bkr.YMD			    = @YMD					OR @YMD=N'')
     UNION ALL
     SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
     	  ,bkr.YMD                                                                   --평가월
           ,-29                                                 AS KPI_REF_ID        --지표코드
           ,'DO사업부_부품_합계'                                AS KPI_NAME      	 --지표명
           ,'부품_합계'                                         AS ALIAS			 --지표별칭
           ,bkr.RESULT_TS+bkr2.RESULT_TS+
            bkr3.RESULT_TS+bkr4.RESULT_TS+
            bkr5.RESULT_TS+bkr6.RESULT_TS+
            bkr7.RESULT_TS+bkr8.RESULT_TS+
            bkr9.RESULT_TS+bkr10.RESULT_TS+
            bkr11.RESULT_TS+bkr12.RESULT_TS                     AS RESULT_TS         --누계실적
           ,'DO'                                                AS BU                --사업장구분
           ,'I_13'                                             AS ITEM_CODE         --ITEM코드
           ,'S_02'                                             AS STOCK_CODE        --재고코드
           ,117												   AS SORT_ORDER         --정렬순서
       FROM BSC_KPI_RESULT bkr
       JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr2.YMD				  = bkr.YMD
     						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_46	
       JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr3.YMD				  = bkr.YMD
     						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_50
       JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr4.YMD				  = bkr.YMD
     						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_54	
       JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr5.YMD				  = bkr.YMD
     						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_58	
       JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr6.YMD				  = bkr.YMD
     						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_62	
       JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr7.YMD				  = bkr.YMD
     						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_66	
       JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr8.YMD				  = bkr.YMD
     						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_70	
       JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr9.YMD				  = bkr.YMD
     						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_74	
       JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr10.YMD				  = bkr.YMD
     						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_78
       JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr11.YMD				  = bkr.YMD
     						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_82
       JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr12.YMD				  = bkr.YMD
     						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_86 					  						   						  					      		
      WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
        AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_42		OR @KPI_REF_ID_42=0)
        AND (bkr.YMD			    = @YMD					OR @YMD=N'')
     UNION ALL
     SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
     	  ,bkr.YMD                                                                   --평가월
           ,-30                                                 AS KPI_REF_ID        --지표코드
           ,'DO사업부_원자재_합계'                              AS KPI_NAME      	 --지표명
           ,'원자재_합계'                                       AS ALIAS			 --지표별칭
           ,bkr.RESULT_TS+bkr2.RESULT_TS+
            bkr3.RESULT_TS+bkr4.RESULT_TS+
            bkr5.RESULT_TS+bkr6.RESULT_TS+
            bkr7.RESULT_TS+bkr8.RESULT_TS+
            bkr9.RESULT_TS+bkr10.RESULT_TS+
            bkr11.RESULT_TS+bkr12.RESULT_TS                     AS RESULT_TS         --누계실적
           ,'DO'                                                AS BU                --사업장구분
           ,'I_13'                                             AS ITEM_CODE         --ITEM코드
           ,'S_03'                                             AS STOCK_CODE        --재고코드
           ,118												   AS SORT_ORDER         --정렬순서
       FROM BSC_KPI_RESULT bkr
       JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr2.YMD				  = bkr.YMD
     						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_47	
       JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr3.YMD				  = bkr.YMD
     						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_51
       JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr4.YMD				  = bkr.YMD
     						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_55	
       JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr5.YMD				  = bkr.YMD
     						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_59	
       JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr6.YMD				  = bkr.YMD
     						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_63	
       JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr7.YMD				  = bkr.YMD
     						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_67	
       JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr8.YMD				  = bkr.YMD
     						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_71	
       JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr9.YMD				  = bkr.YMD
     						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_75	
       JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr10.YMD				  = bkr.YMD
     						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_79
       JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr11.YMD				  = bkr.YMD
     						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_83
       JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr12.YMD				  = bkr.YMD
     						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_87 					  						   						  					      		
      WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
        AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_43		OR @KPI_REF_ID_43=0)
        AND (bkr.YMD			    = @YMD					OR @YMD=N'')
     UNION ALL
     SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
     	  ,bkr.YMD                                                                   --평가월
           ,-31                                                 AS KPI_REF_ID        --지표코드
           ,'DO사업부_재공품_합계'                              AS KPI_NAME      	 --지표명
           ,'재공품_합계'                                       AS ALIAS			 --지표별칭
           ,bkr.RESULT_TS+bkr2.RESULT_TS+
            bkr3.RESULT_TS+bkr4.RESULT_TS+
            bkr5.RESULT_TS+bkr6.RESULT_TS+
            bkr7.RESULT_TS+bkr8.RESULT_TS+
            bkr9.RESULT_TS+bkr10.RESULT_TS+
            bkr11.RESULT_TS+bkr12.RESULT_TS                     AS RESULT_TS         --누계실적
           ,'DO'                                                AS BU                --사업장구분
           ,'I_13'                                             AS ITEM_CODE         --ITEM코드
           ,'S_04'                                             AS STOCK_CODE        --재고코드
           ,119												   AS SORT_ORDER         --정렬순서
       FROM BSC_KPI_RESULT bkr
       JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr2.YMD				  = bkr.YMD
     						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_48	
       JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr3.YMD				  = bkr.YMD
     						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_52
       JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr4.YMD				  = bkr.YMD
     						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_56	
       JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr5.YMD				  = bkr.YMD
     						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_60	
       JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr6.YMD				  = bkr.YMD
     						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_64	
       JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr7.YMD				  = bkr.YMD
     						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_68	
       JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr8.YMD				  = bkr.YMD
     						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_72	
       JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr9.YMD				  = bkr.YMD
     						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_76	
       JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr10.YMD				  = bkr.YMD
     						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_80
       JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr11.YMD				  = bkr.YMD
     						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_84
       JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
     						  AND bkr12.YMD				  = bkr.YMD
     						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_88 					  						   						  					      		
      WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
        AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_44		OR @KPI_REF_ID_44=0)
        AND (bkr.YMD			    = @YMD					OR @YMD=N'')
	    ) AS SUM_ITEM
GROUP BY SUM_ITEM.ESTTERM_REF_ID, SUM_ITEM.YMD





/********************
*   천진법인
*********************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,121												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_89		OR @KPI_REF_ID_89=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,122												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_90		OR @KPI_REF_ID_90=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,123												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_91		OR @KPI_REF_ID_91=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_01'                                             AS ITEM_CODE         --ITEM코드
      ,'S_04'                                             AS STOCK_CODE        --재고코드
      ,124												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_92		OR @KPI_REF_ID_92=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-33                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_PTC_총제고'	                           AS KPI_NAME      	--지표명
      ,'PTC_총제고'                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_01'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,125												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_90	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_91
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_92					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_89		OR @KPI_REF_ID_89=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,126												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_93		OR @KPI_REF_ID_93=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_02'                                             AS ITEM_CODE         --ITEM코드
      ,'S_02'                                             AS STOCK_CODE        --재고코드
      ,127												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_94		OR @KPI_REF_ID_94=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_02'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,128												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_95		OR @KPI_REF_ID_95=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_02'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,129												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_96		OR @KPI_REF_ID_96=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-34                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_VM_총제고'  	                           AS KPI_NAME      	--지표명
      ,'VM_총제고'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_02'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,130												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_94	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_95
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_96					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_93		OR @KPI_REF_ID_93=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_03'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,131												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_97		OR @KPI_REF_ID_97=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_03'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,132												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_98		OR @KPI_REF_ID_98=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_03'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,133												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_99		OR @KPI_REF_ID_99=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_03'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,134												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_100		OR @KPI_REF_ID_100=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-35                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_EV_총제고'  	                           AS KPI_NAME      	--지표명
      ,'EV_총제고'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_03'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,135												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_98	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_99
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_100					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_97		OR @KPI_REF_ID_97=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_04'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,136												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_101		OR @KPI_REF_ID_101=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_04'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,137												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_102		OR @KPI_REF_ID_102=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_04'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,138												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_103		OR @KPI_REF_ID_103=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_04'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,139												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_104		OR @KPI_REF_ID_104=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-36                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_AFA_총제고'  	                           AS KPI_NAME      	--지표명
      ,'AFA_총제고'                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_04'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,140												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_102	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_103
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_104					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_101		OR @KPI_REF_ID_101=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_05'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,141												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_105		OR @KPI_REF_ID_105=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_05'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,142												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_106		OR @KPI_REF_ID_106=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_05'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,143												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_107		OR @KPI_REF_ID_107=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_05'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,144												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_108		OR @KPI_REF_ID_108=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-37                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_PCM_총제고'  	                           AS KPI_NAME      	--지표명
      ,'PCM_총제고'                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_05'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,145												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_106	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_107
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_108					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_105		OR @KPI_REF_ID_105=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_06'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,146												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_109		OR @KPI_REF_ID_109=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_06'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,147												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_110		OR @KPI_REF_ID_110=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_06'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,148												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_111		OR @KPI_REF_ID_111=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_06'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,149												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_112		OR @KPI_REF_ID_112=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-38                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_ROLLER_총제고'                            AS KPI_NAME      	--지표명
      ,'ROLLER_총제고'                                     AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_06'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,150												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_110	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_111
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_112					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_109		OR @KPI_REF_ID_109=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_07'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,151												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_113		OR @KPI_REF_ID_113=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_07'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,152												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_114		OR @KPI_REF_ID_114=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_07'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,153												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_115		OR @KPI_REF_ID_115=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_07'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,154												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_116		OR @KPI_REF_ID_116=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-39                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_기타_총제고'                              AS KPI_NAME      	--지표명
      ,'기타_총제고'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_07'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,155												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_114	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_115
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_116					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_113		OR @KPI_REF_ID_113=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_08'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,156												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_117		OR @KPI_REF_ID_117=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_08'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,157												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_118		OR @KPI_REF_ID_118=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_08'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,158												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_119		OR @KPI_REF_ID_119=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_08'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,159												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_120		OR @KPI_REF_ID_120=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-40                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_추가여분1_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분1_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_08'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,160												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_118	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_119
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_120					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_117		OR @KPI_REF_ID_117=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_09'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,161												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_121		OR @KPI_REF_ID_121=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_09'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,162												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_122		OR @KPI_REF_ID_122=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_09'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,163												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_123		OR @KPI_REF_ID_123=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_09'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,164												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_124		OR @KPI_REF_ID_124=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-41                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_추가여분2_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분2_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_09'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,165												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_122	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_123
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_124					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_121		OR @KPI_REF_ID_121=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_10'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,166												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_125		OR @KPI_REF_ID_125=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_10'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,167												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_126		OR @KPI_REF_ID_126=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_10'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,168												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_127		OR @KPI_REF_ID_127=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_10'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,169												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_128		OR @KPI_REF_ID_128=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-42                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_추가여분3_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분3_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_10'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,170												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_126	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_127
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_128					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_125		OR @KPI_REF_ID_125=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_11'                                              AS ITEM_CODE         --ITEM코드
      ,'S_01'                                              AS STOCK_CODE        --재고코드
      ,171												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_129		OR @KPI_REF_ID_129=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_11'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,172												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_130		OR @KPI_REF_ID_130=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_11'                                              AS ITEM_CODE         --ITEM코드
      ,'S_03'                                              AS STOCK_CODE        --재고코드
      ,173												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_131		OR @KPI_REF_ID_131=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkr.RESULT_TS                                                            --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_11'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,174												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_132		OR @KPI_REF_ID_132=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-43                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_추가여분4_총제고'                         AS KPI_NAME      	--지표명
      ,'추가여분4_총제고'                                  AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS                       AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_11'                                              AS ITEM_CODE         --ITEM코드
      ,'S_05'                                              AS STOCK_CODE        --재고코드
      ,175												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_130	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_131
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_132					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_129		OR @KPI_REF_ID_129=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-44                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_제품_합계'                                AS KPI_NAME      	--지표명
      ,'제품_합계'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS+
       bkr11.RESULT_TS                                     AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_12'                                             AS ITEM_CODE         --ITEM코드
      ,'S_01'                                             AS STOCK_CODE        --재고코드
      ,176												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_93	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_97
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_101	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_105	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_109	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_113	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_117	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_121	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_125
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_129				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_89		OR @KPI_REF_ID_89=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-45                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_부품_합계'                                AS KPI_NAME      	--지표명
      ,'부품_합계'                                         AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS+
       bkr11.RESULT_TS                                     AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_12'                                              AS ITEM_CODE         --ITEM코드
      ,'S_02'                                              AS STOCK_CODE        --재고코드
      ,177												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_94	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_98
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_102	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_106	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_110	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_114	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_118	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_122	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_126
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_130					  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_90		OR @KPI_REF_ID_90=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-46                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_원자재_합계'                              AS KPI_NAME      	--지표명
      ,'원자재_합계'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS+
       bkr11.RESULT_TS                                     AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_12'                                             AS ITEM_CODE         --ITEM코드
      ,'S_03'                                             AS STOCK_CODE        --재고코드
      ,178												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_95	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_99
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_103	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_107	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_111	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_115	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_119	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_123	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_127
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_131				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_91		OR @KPI_REF_ID_91=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-47                                                 AS KPI_REF_ID        --지표코드
      ,'천진법인_재공품_합계'                              AS KPI_NAME      	--지표명
      ,'재공품_합계'                                       AS ALIAS				--지표별칭
      ,bkr.RESULT_TS+bkr2.RESULT_TS+
       bkr3.RESULT_TS+bkr4.RESULT_TS+
       bkr5.RESULT_TS+bkr6.RESULT_TS+
       bkr7.RESULT_TS+bkr8.RESULT_TS+
       bkr9.RESULT_TS+bkr10.RESULT_TS+
       bkr11.RESULT_TS                                     AS RESULT_TS         --누계실적
      ,'CJ'                                                AS BU                --사업장구분
      ,'I_12'                                              AS ITEM_CODE         --ITEM코드
      ,'S_04'                                              AS STOCK_CODE        --재고코드
      ,179												   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_96	
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_100
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_104	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_108	
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_112	
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_116	
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_120	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_124	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_128
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_132				  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_92		OR @KPI_REF_ID_92=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT SUM_ITEM.ESTTERM_REF_ID                                                      --평가년
	  ,SUM_ITEM.YMD                                                                 --평가월
	  ,-48                                                      AS KPI_REF_ID       --지표코드
	  ,'천진법인_총제고_합계'                                   AS KPI_NAME         --지표명
	  ,'총제고_합계'                                            AS ALIAS            --지표별칭
	  ,SUM(SUM_ITEM.RESULT_TS)                                  AS RESULT_TS        --누계실적
	  ,'CJ'                                                     AS BU               --사업장구분
      ,'I_12'                                                  AS ITEM_CODE        --ITEM코드
      ,'S_05'                                                  AS STOCK_CODE       --재고코드
	  ,180                                                      AS SORT_ORDER       --정렬순서
FROM (
       SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
        	   ,bkr.YMD                                                                  --평가월
             ,-44                                                 AS KPI_REF_ID        --지표코드
             ,'천진법인_제품_합계'                                AS KPI_NAME      	--지표명
             ,'제품_합계'                                         AS ALIAS				--지표별칭
             ,bkr.RESULT_TS+bkr2.RESULT_TS+
              bkr3.RESULT_TS+bkr4.RESULT_TS+
              bkr5.RESULT_TS+bkr6.RESULT_TS+
              bkr7.RESULT_TS+bkr8.RESULT_TS+
              bkr9.RESULT_TS+bkr10.RESULT_TS+
              bkr11.RESULT_TS                                     AS RESULT_TS         --누계실적
             ,'CJ'                                                AS BU                --사업장구분
             ,'I_12'                                             AS ITEM_CODE         --ITEM코드
             ,'S_01'                                             AS STOCK_CODE        --재고코드
             ,174												   AS SORT_ORDER        --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr2.YMD				  = bkr.YMD
       						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_93	
         JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr3.YMD				  = bkr.YMD
       						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_97
         JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr4.YMD				  = bkr.YMD
       						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_101	
         JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr5.YMD				  = bkr.YMD
       						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_105	
         JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr6.YMD				  = bkr.YMD
       						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_109	
         JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr7.YMD				  = bkr.YMD
       						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_113	
         JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr8.YMD				  = bkr.YMD
       						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_117	
         JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr9.YMD				  = bkr.YMD
       						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_121	
         JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr10.YMD				  = bkr.YMD
       						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_125
         JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr11.YMD				  = bkr.YMD
       						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_129				  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_89		OR @KPI_REF_ID_89=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
       	     ,bkr.YMD                                                                  --평가월
             ,-45                                                 AS KPI_REF_ID        --지표코드
             ,'천진법인_부품_합계'                                AS KPI_NAME      	--지표명
             ,'부품_합계'                                         AS ALIAS				--지표별칭
             ,bkr.RESULT_TS+bkr2.RESULT_TS+
              bkr3.RESULT_TS+bkr4.RESULT_TS+
              bkr5.RESULT_TS+bkr6.RESULT_TS+
              bkr7.RESULT_TS+bkr8.RESULT_TS+
              bkr9.RESULT_TS+bkr10.RESULT_TS+
              bkr11.RESULT_TS                                     AS RESULT_TS         --누계실적
             ,'CJ'                                                AS BU                --사업장구분
             ,'I_12'                                              AS ITEM_CODE         --ITEM코드
             ,'S_02'                                              AS STOCK_CODE        --재고코드
             ,175												   AS SORT_ORDER        --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr2.YMD				  = bkr.YMD
       						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_94	
         JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr3.YMD				  = bkr.YMD
       						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_98
         JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr4.YMD				  = bkr.YMD
       						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_102	
         JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr5.YMD				  = bkr.YMD
       						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_106	
         JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr6.YMD				  = bkr.YMD
       						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_110	
         JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr7.YMD				  = bkr.YMD
       						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_114	
         JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr8.YMD				  = bkr.YMD
       						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_118	
         JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr9.YMD				  = bkr.YMD
       						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_122	
         JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr10.YMD				  = bkr.YMD
       						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_126
         JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr11.YMD				  = bkr.YMD
       						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_130					  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_90		OR @KPI_REF_ID_90=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
       	     ,bkr.YMD                                                                  --평가월
             ,-46                                                 AS KPI_REF_ID        --지표코드
             ,'천진법인_원자재_합계'                              AS KPI_NAME      	--지표명
             ,'원자재_합계'                                       AS ALIAS				--지표별칭
             ,bkr.RESULT_TS+bkr2.RESULT_TS+
              bkr3.RESULT_TS+bkr4.RESULT_TS+
              bkr5.RESULT_TS+bkr6.RESULT_TS+
              bkr7.RESULT_TS+bkr8.RESULT_TS+
              bkr9.RESULT_TS+bkr10.RESULT_TS+
              bkr11.RESULT_TS                                     AS RESULT_TS         --누계실적
             ,'CJ'                                                AS BU                --사업장구분
             ,'I_12'                                             AS ITEM_CODE         --ITEM코드
             ,'S_03'                                             AS STOCK_CODE        --재고코드
             ,176												   AS SORT_ORDER        --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr2.YMD				  = bkr.YMD
       						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_95	
         JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr3.YMD				  = bkr.YMD
       						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_99
         JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr4.YMD				  = bkr.YMD
       						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_103	
         JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr5.YMD				  = bkr.YMD
       						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_107	
         JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr6.YMD				  = bkr.YMD
       						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_111	
         JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr7.YMD				  = bkr.YMD
       						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_115	
         JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr8.YMD				  = bkr.YMD
       						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_119	
         JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr9.YMD				  = bkr.YMD
       						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_123	
         JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr10.YMD				  = bkr.YMD
       						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_127
         JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr11.YMD				  = bkr.YMD
       						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_131				  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_91		OR @KPI_REF_ID_91=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
       	     ,bkr.YMD                                                                  --평가월
             ,-47                                                 AS KPI_REF_ID        --지표코드
             ,'천진법인_재공품_합계'                              AS KPI_NAME      	--지표명
             ,'재공품_합계'                                       AS ALIAS				--지표별칭
             ,bkr.RESULT_TS+bkr2.RESULT_TS+
              bkr3.RESULT_TS+bkr4.RESULT_TS+
              bkr5.RESULT_TS+bkr6.RESULT_TS+
              bkr7.RESULT_TS+bkr8.RESULT_TS+
              bkr9.RESULT_TS+bkr10.RESULT_TS+
              bkr11.RESULT_TS                                     AS RESULT_TS         --누계실적
             ,'CJ'                                                AS BU                --사업장구분
             ,'I_12'                                              AS ITEM_CODE         --ITEM코드
             ,'S_04'                                              AS STOCK_CODE        --재고코드
             ,177												   AS SORT_ORDER        --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr2.YMD				  = bkr.YMD
       						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_96	
         JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr3.YMD				  = bkr.YMD
       						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_100
         JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr4.YMD				  = bkr.YMD
       						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_104	
         JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr5.YMD				  = bkr.YMD
       						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_108	
         JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr6.YMD				  = bkr.YMD
       						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_112	
         JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr7.YMD				  = bkr.YMD
       						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_116	
         JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr8.YMD				  = bkr.YMD
       						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_120	
         JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr9.YMD				  = bkr.YMD
       						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_124	
         JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr10.YMD				  = bkr.YMD
       						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_128
         JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
       						  AND bkr11.YMD				  = bkr.YMD
       						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_132				  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_92		OR @KPI_REF_ID_92=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')  
             	   
	    ) AS SUM_ITEM
GROUP BY SUM_ITEM.ESTTERM_REF_ID, SUM_ITEM.YMD

";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds;
        }

        #endregion

        #region =================== 사업부- Item별 - 총괄 ===============================

        public DataSet GetData_M_2_S_4(int estterm_ref_id
                                     , string ymd)
        {
            string query = 
@"





--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부-PTC_매출액
DECLARE @KPI_REF_ID_02 INT   -- DD사업부-VM_매출액
DECLARE @KPI_REF_ID_03 INT   -- DD사업부-EV_매출액
DECLARE @KPI_REF_ID_04 INT   -- DD사업부-AFA_매출액
DECLARE @KPI_REF_ID_05 INT   -- DD사업부-ALC_매출액
DECLARE @KPI_REF_ID_06 INT   -- DD사업부-기타_매출액

DECLARE @KPI_REF_ID_07 INT   -- DO사업부-PCM_매출액
DECLARE @KPI_REF_ID_08 INT   -- DO사업부-TS_매출액
DECLARE @KPI_REF_ID_09 INT   -- DO사업부-Roller_매출액
DECLARE @KPI_REF_ID_10 INT   -- DO사업부-Sleeve_매출액
DECLARE @KPI_REF_ID_11 INT   -- DO사업부-CTR_매출액
DECLARE @KPI_REF_ID_12 INT   -- DO사업부-FCCL_매출액
DECLARE @KPI_REF_ID_13 INT   -- DO사업부-Film_매출액
DECLARE @KPI_REF_ID_14 INT   -- DO사업부-기타_매출액

DECLARE @KPI_REF_ID_15 INT   -- DD사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_16 INT   -- DD사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_17 INT   -- DD사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_18 INT   -- DD사업부-추가여분4_매출액

DECLARE @KPI_REF_ID_19 INT   -- DO사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_20 INT   -- DO사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_21 INT   -- DO사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_22 INT   -- DO사업부-추가여분4_매출액
                             -- 
                             
DECLARE @KPI_REF_ID_23 INT   --천진법인_PTC_내수매출액         
DECLARE @KPI_REF_ID_24 INT   --천진법인_VM_내수매출액         
DECLARE @KPI_REF_ID_25 INT   --천진법인_EV_내수매출액          
DECLARE @KPI_REF_ID_26 INT   --천진법인_AFA_내수매출액          
DECLARE @KPI_REF_ID_27 INT   --천진법인_PCM_내수매출액          
DECLARE @KPI_REF_ID_28 INT   --천진법인_ROLLER_내수매출액       
DECLARE @KPI_REF_ID_29 INT   --천진법인_기타_내수매출액        
                                                          
DECLARE @KPI_REF_ID_30 INT   --천진법인_추가여분1_내수매출액    
DECLARE @KPI_REF_ID_31 INT   --천진법인_추가여분2_내수매출액    
DECLARE @KPI_REF_ID_32 INT   --천진법인_추가여분3_내수매출액    
DECLARE @KPI_REF_ID_33 INT   --천진법인_추가여분4_내수매출액    
                             --
                             --
DECLARE @KPI_REF_ID_34 INT   --천진법인_PTC_총매출액         
DECLARE @KPI_REF_ID_35 INT   --천진법인_VM_총매출액          
DECLARE @KPI_REF_ID_36 INT   --천진법인_EV_총매출액         
DECLARE @KPI_REF_ID_37 INT   --천진법인_AFA_총매출액      
DECLARE @KPI_REF_ID_38 INT   --천진법인_PCM_총매출액        
DECLARE @KPI_REF_ID_39 INT   --천진법인_ROLLER_총매출액     
DECLARE @KPI_REF_ID_40 INT   --천진법인_기타_총매출액        
                                                          
DECLARE @KPI_REF_ID_41 INT   --천진법인_추가여분1_총매출액
DECLARE @KPI_REF_ID_42 INT   --천진법인_추가여분2_총매출액
DECLARE @KPI_REF_ID_43 INT   --천진법인_추가여분3_총매출액  
DECLARE @KPI_REF_ID_44 INT   --천진법인_추가여분4_총매출액                       


--SET @ESTTERM_REF_ID =999
--SET @YMD ='200912'
SET @KPI_REF_ID_01 = 1484    
SET @KPI_REF_ID_02 = 1485
SET @KPI_REF_ID_03 = 1483
SET @KPI_REF_ID_04 = 1481
SET @KPI_REF_ID_05 = 1482
SET @KPI_REF_ID_06 = 1486

SET @KPI_REF_ID_07 = 1490
SET @KPI_REF_ID_08 = 1493
SET @KPI_REF_ID_09 = 1491 
SET @KPI_REF_ID_10 = 1492
SET @KPI_REF_ID_11 = 1487
SET @KPI_REF_ID_12 = 1488
SET @KPI_REF_ID_13 = 1489
SET @KPI_REF_ID_14 = 1494

SET @KPI_REF_ID_15 = 1495
SET @KPI_REF_ID_16 = 1496
SET @KPI_REF_ID_17 = 1497
SET @KPI_REF_ID_18 = 1498

SET @KPI_REF_ID_19 = 1499
SET @KPI_REF_ID_20 = 1500
SET @KPI_REF_ID_21 = 1501
SET @KPI_REF_ID_22 = 1502

--천진법인    
SET @KPI_REF_ID_23 = 1635 
SET @KPI_REF_ID_24 = 1637 
SET @KPI_REF_ID_25 = 1639 
SET @KPI_REF_ID_26 = 1641 
SET @KPI_REF_ID_27 = 1643 
SET @KPI_REF_ID_28 = 1645 
SET @KPI_REF_ID_29 = 1647 
                          
SET @KPI_REF_ID_30 = 1649 
SET @KPI_REF_ID_31 = 1651 
SET @KPI_REF_ID_32 = 1653 
SET @KPI_REF_ID_33 = 1655 


SET @KPI_REF_ID_34 = 1701 
SET @KPI_REF_ID_35 = 1702 
SET @KPI_REF_ID_36 = 1703 
SET @KPI_REF_ID_37 = 1704 
SET @KPI_REF_ID_38 = 1705 
SET @KPI_REF_ID_39 = 1706 
SET @KPI_REF_ID_40 = 1707 
                          
SET @KPI_REF_ID_41 = 1708 
SET @KPI_REF_ID_42 = 1709 
SET @KPI_REF_ID_43 = 1710 
SET @KPI_REF_ID_44 = 1711 


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.22
*	Page view  : DD사업부/DO사업부/천진법인
*				-ITEM별-총괄 (슬라이드 No.10,18)
*	Grid 구성
*	관련 KPI : 상단 정의 참조
*	KPI_REF_ID : 상단 정의 참조
*									 
*									 
**************************************************************************/

/***********
* DD사업부
************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,1                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_02 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
	  ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,2                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,3                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,4                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,5                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,6                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,7                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_15		OR @KPI_REF_ID_15=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,8                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_15	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_16		OR @KPI_REF_ID_16=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,9                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_15	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr11.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr11.RESULT_TS)/bkr11.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
      ,CASE WHEN  (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,10                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_01 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_03 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_15	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_17
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_18		OR @KPI_REF_ID_18=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-1                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부_ITEM_총계'                                AS KPI_NAME			--지표명
      ,'총계'                                              AS ALIAS				--지표별칭
      ,bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
       bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
       bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
       bkt10.TARGET_MS                                     AS TARGET_MS       	--당월계획
      ,bkr.RESULT_MS+bkr2.RESULT_MS+bkr3.RESULT_MS+
       bkr4.RESULT_MS+bkr5.RESULT_MS+bkr6.RESULT_MS+
       bkr7.RESULT_MS+bkr8.RESULT_MS+bkr9.RESULT_MS+
       bkr10.RESULT_MS                                     AS RESULT_MS         --당월실적
      ,CASE WHEN (bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
				  bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
				  bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
				  bkt10.TARGET_MS)<>0 
			THEN  ((bkr.RESULT_MS+bkr2.RESULT_MS+bkr3.RESULT_MS+
					bkr4.RESULT_MS+bkr5.RESULT_MS+bkr6.RESULT_MS+
					bkr7.RESULT_MS+bkr8.RESULT_MS+bkr9.RESULT_MS+
					bkr10.RESULT_MS)/(bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
									  bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
									  bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
									  bkt10.TARGET_MS))*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
	   ,bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
        bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
        bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
        bkt10.TARGET_TS                                     AS TARGET_TS       	--누계계획
       ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
        bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
        bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
        bkr10.RESULT_TS                                     AS RESULT_TS        --누계실적
       ,CASE WHEN (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
	 		       bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
				   bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
				   bkt10.TARGET_TS)<>0 
			 THEN  ((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
					 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
					 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
					 bkr10.RESULT_TS)/(bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
									   bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
									   bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
									   bkt10.TARGET_TS))*100
		     ELSE 0 END                                    AS ACHIVE_RATE_TS    --누계달성율
	   ,CASE WHEN (bkr11.RESULT_TS+bkr12.RESULT_TS+bkr13.RESULT_TS+
				   bkr14.RESULT_TS+bkr15.RESULT_TS+bkr16.RESULT_TS+
				   bkr17.RESULT_TS+bkr18.RESULT_TS+bkr19.RESULT_TS+
				   bkr20.RESULT_TS)<>0 
		     THEN(((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
					bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
					bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
					bkr10.RESULT_TS)-(bkr11.RESULT_TS+bkr12.RESULT_TS+bkr13.RESULT_TS+
									  bkr14.RESULT_TS+bkr15.RESULT_TS+bkr16.RESULT_TS+
									  bkr17.RESULT_TS+bkr18.RESULT_TS+bkr19.RESULT_TS+
									  bkr20.RESULT_TS))/(bkr11.RESULT_TS+bkr12.RESULT_TS+bkr13.RESULT_TS+
														 bkr14.RESULT_TS+bkr15.RESULT_TS+bkr16.RESULT_TS+
														 bkr17.RESULT_TS+bkr18.RESULT_TS+bkr19.RESULT_TS+
														 bkr20.RESULT_TS))*100 
		     ELSE 0 END                                    AS BF_RNF_RATE       --전년동기대비신장율
       ,0                                                  AS RESULT_RATIO      --실적구성비율
       ,'DD'                                               AS BU                --사업장
       ,11                                                 AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_02 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_04 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_16	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_17	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr11.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr11.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr12.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_02
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr14 ON bkr14.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr14.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr14.KPI_REF_ID		  = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr15 ON bkr15.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr15.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr15.KPI_REF_ID		  = @KPI_REF_ID_05
  JOIN BSC_KPI_RESULT bkr16 ON bkr16.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr16.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr16.KPI_REF_ID		  = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr17 ON bkr17.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr17.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr17.KPI_REF_ID		  = @KPI_REF_ID_15
  JOIN BSC_KPI_RESULT bkr18 ON bkr18.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr18.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr18.KPI_REF_ID		  = @KPI_REF_ID_16
  JOIN BSC_KPI_RESULT bkr19 ON bkr19.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr19.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr19.KPI_REF_ID		  = @KPI_REF_ID_17
  JOIN BSC_KPI_RESULT bkr20 ON bkr20.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr20.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr20.KPI_REF_ID		  = @KPI_REF_ID_18
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID	
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt2.YMD				  = bkr.YMD
						 AND bkt2.KPI_REF_ID	   	  = @KPI_REF_ID_02	
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt3.YMD				  = bkr.YMD
						 AND bkt3.KPI_REF_ID	   	  = @KPI_REF_ID_03
  JOIN BSC_KPI_TARGET bkt4 ON bkt4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt4.YMD				  = bkr.YMD
						 AND bkt4.KPI_REF_ID	   	  = @KPI_REF_ID_04	
  JOIN BSC_KPI_TARGET bkt5 ON bkt5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt5.YMD				  = bkr.YMD
						 AND bkt5.KPI_REF_ID	   	  = @KPI_REF_ID_05	
  JOIN BSC_KPI_TARGET bkt6 ON bkt6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt6.YMD				  = bkr.YMD
						 AND bkt6.KPI_REF_ID	   	  = @KPI_REF_ID_06
  JOIN BSC_KPI_TARGET bkt7 ON bkt7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt7.YMD				  = bkr.YMD
						 AND bkt7.KPI_REF_ID	   	  = @KPI_REF_ID_15	
  JOIN BSC_KPI_TARGET bkt8 ON bkt8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt8.YMD				  = bkr.YMD
						 AND bkt8.KPI_REF_ID	   	  = @KPI_REF_ID_16	
  JOIN BSC_KPI_TARGET bkt9 ON bkt9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt9.YMD				  = bkr.YMD
						 AND bkt9.KPI_REF_ID	   	  = @KPI_REF_ID_17	
  JOIN BSC_KPI_TARGET bkt10 ON bkt10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						 AND bkt10.YMD				  = bkr.YMD
						 AND bkt10.KPI_REF_ID	   	  = @KPI_REF_ID_18							 						 						 						 						 						 						 							 		  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')




/***********
* DO사업부
************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,1                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_08 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,2                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,3                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,4                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,5                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,6                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,7                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,8                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_14		OR @KPI_REF_ID_14=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,9                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_19		OR @KPI_REF_ID_19=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,10                                                 AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_19
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_20		OR @KPI_REF_ID_20=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,11                                                 AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_19
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
								 bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,12                                                 AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_09 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_13	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_19
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_22		OR @KPI_REF_ID_22=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-2                                                  AS KPI_REF_ID        --지표코드
      ,'DO사업부_ITEM_총계'                                AS KPI_NAME			--지표명
      ,'총계'                                              AS ALIAS				--지표별칭
      ,bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
       bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
       bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
       bkt10.TARGET_MS+bkt11.TARGET_MS+bkt12.TARGET_MS     AS TARGET_MS       	--당월계획
      ,bkr.RESULT_MS+bkr2.RESULT_MS+bkr3.RESULT_MS+
       bkr4.RESULT_MS+bkr5.RESULT_MS+bkr6.RESULT_MS+
       bkr7.RESULT_MS+bkr8.RESULT_MS+bkr9.RESULT_MS+
       bkr10.RESULT_MS+bkr11.RESULT_MS+bkr12.RESULT_MS     AS RESULT_MS         --당월실적
      ,CASE WHEN (bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
				  bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
				  bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
				  bkt10.TARGET_MS+bkt11.TARGET_MS+bkt12.TARGET_MS)<>0 
			THEN  ((bkr.RESULT_MS+bkr2.RESULT_MS+bkr3.RESULT_MS+
					bkr4.RESULT_MS+bkr5.RESULT_MS+bkr6.RESULT_MS+
					bkr7.RESULT_MS+bkr8.RESULT_MS+bkr9.RESULT_MS+
					bkr10.RESULT_MS+bkr11.RESULT_MS+bkr12.RESULT_MS)
					/(bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
					  bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
					  bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
					  bkt10.TARGET_MS+bkt11.TARGET_MS+bkt12.TARGET_MS))*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
	   ,bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
        bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
        bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
        bkt10.TARGET_TS+bkt11.TARGET_TS+bkt12.TARGET_TS     AS TARGET_TS       	--누계계획
       ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
        bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
        bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
        bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS     AS RESULT_TS        --누계실적
       ,CASE WHEN (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
	 		       bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
				   bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
				   bkt10.TARGET_TS+bkt11.TARGET_TS+bkt12.TARGET_TS)<>0 
			 THEN  ((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
					 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
					 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
					 bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)
					 /(bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
					   bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
					   bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
					   bkt10.TARGET_TS+bkt11.TARGET_TS+bkt12.TARGET_TS))*100
		     ELSE 0 END                                    AS ACHIVE_RATE_TS    --누계달성율
	   ,CASE WHEN (bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
				   bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
				   bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
				   bkr22.RESULT_TS+bkr23.RESULT_TS+bkr24.RESULT_TS)<>0 
		     THEN(((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
					bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
					bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
					bkr10.RESULT_TS+bkr11.RESULT_TS+bkr12.RESULT_TS)
						-(bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
						  bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
						  bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
						  bkr22.RESULT_TS+bkr23.RESULT_TS+bkr24.RESULT_TS))
						       /(bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
								 bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
								 bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
								 bkr22.RESULT_TS+bkr23.RESULT_TS+bkr24.RESULT_TS))*100 
		     ELSE 0 END                                    AS BF_RNF_RATE       --전년동기대비신장율
       ,0                                                  AS RESULT_RATIO      --실적구성비율
       ,'DO'                                               AS BU                --사업장
       ,9                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_08 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_10 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_14	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_19	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr12 ON bkr12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr12.YMD				  = bkr.YMD
						  AND bkr12.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_RESULT bkr14 ON bkr14.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr14.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr14.KPI_REF_ID		  = @KPI_REF_ID_08
  JOIN BSC_KPI_RESULT bkr15 ON bkr15.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr15.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr15.KPI_REF_ID		  = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr16 ON bkr16.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr16.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr16.KPI_REF_ID		  = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr17 ON bkr17.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr17.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr17.KPI_REF_ID		  = @KPI_REF_ID_11
  JOIN BSC_KPI_RESULT bkr18 ON bkr18.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr18.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr18.KPI_REF_ID		  = @KPI_REF_ID_12
  JOIN BSC_KPI_RESULT bkr19 ON bkr19.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr19.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr19.KPI_REF_ID		  = @KPI_REF_ID_13
  JOIN BSC_KPI_RESULT bkr20 ON bkr20.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr20.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr20.KPI_REF_ID		  = @KPI_REF_ID_14
  JOIN BSC_KPI_RESULT bkr21 ON bkr21.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr21.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr21.KPI_REF_ID		  = @KPI_REF_ID_19
  JOIN BSC_KPI_RESULT bkr22 ON bkr22.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr22.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr22.KPI_REF_ID		  = @KPI_REF_ID_20
  JOIN BSC_KPI_RESULT bkr23 ON bkr23.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr23.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr23.KPI_REF_ID		  = @KPI_REF_ID_21
  JOIN BSC_KPI_RESULT bkr24 ON bkr24.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr24.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr24.KPI_REF_ID		  = @KPI_REF_ID_22
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID	
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt2.YMD				  = bkr.YMD
						 AND bkt2.KPI_REF_ID	   	  = @KPI_REF_ID_08	
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt3.YMD				  = bkr.YMD
						 AND bkt3.KPI_REF_ID	   	  = @KPI_REF_ID_09
  JOIN BSC_KPI_TARGET bkt4 ON bkt4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt4.YMD				  = bkr.YMD
						 AND bkt4.KPI_REF_ID	   	  = @KPI_REF_ID_10	
  JOIN BSC_KPI_TARGET bkt5 ON bkt5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt5.YMD				  = bkr.YMD
						 AND bkt5.KPI_REF_ID	   	  = @KPI_REF_ID_11	
  JOIN BSC_KPI_TARGET bkt6 ON bkt6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt6.YMD				  = bkr.YMD
						 AND bkt6.KPI_REF_ID	   	  = @KPI_REF_ID_12
  JOIN BSC_KPI_TARGET bkt7 ON bkt7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt7.YMD				  = bkr.YMD
						 AND bkt7.KPI_REF_ID	   	  = @KPI_REF_ID_13	
  JOIN BSC_KPI_TARGET bkt8 ON bkt8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt8.YMD				  = bkr.YMD
						 AND bkt8.KPI_REF_ID	   	  = @KPI_REF_ID_14	
  JOIN BSC_KPI_TARGET bkt9 ON bkt9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt9.YMD				  = bkr.YMD
						 AND bkt9.KPI_REF_ID	   	  = @KPI_REF_ID_19	
  JOIN BSC_KPI_TARGET bkt10 ON bkt10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						 AND bkt10.YMD				  = bkr.YMD
						 AND bkt10.KPI_REF_ID	   	  = @KPI_REF_ID_20
  JOIN BSC_KPI_TARGET bkt11 ON bkt11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						 AND bkt11.YMD				  = bkr.YMD
						 AND bkt11.KPI_REF_ID	   	  = @KPI_REF_ID_21
  JOIN BSC_KPI_TARGET bkt12 ON bkt12.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						 AND bkt12.YMD				  = bkr.YMD
						 AND bkt12.KPI_REF_ID	   	  = @KPI_REF_ID_22							 						 						 						 						 						 						 							 		  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   

/***********
* 천진법인
************/

SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,1                                                  AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_24 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_25
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_26 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_29
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_23		OR @KPI_REF_ID_23=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,1                                                  AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_35 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_36
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_37 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_40
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_34		OR @KPI_REF_ID_34=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,2                                                  AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_25
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_26 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_29
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_24		OR @KPI_REF_ID_24=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,2                                                  AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_36
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_37 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_40
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_35		OR @KPI_REF_ID_35=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,3                                                  AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_26 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_29
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_25		OR @KPI_REF_ID_25=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,3                                                  AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_37 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_40
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_36		OR @KPI_REF_ID_36=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,4                                                  AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_29
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_26		OR @KPI_REF_ID_26=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,4                                                  AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_40
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_37		OR @KPI_REF_ID_37=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,5                                                  AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_26
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_29
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_27		OR @KPI_REF_ID_27=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,5                                                 AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_37
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_40
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_38		OR @KPI_REF_ID_38=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,6                                                 AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_26
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_29
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_28		OR @KPI_REF_ID_28=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,6                                                 AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_37
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_40
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_39		OR @KPI_REF_ID_39=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,7                                                 AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_26
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_29		OR @KPI_REF_ID_29=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,7                                                 AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_37
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_40		OR @KPI_REF_ID_40=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,8                                                 AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_26
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_29	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_30		OR @KPI_REF_ID_30=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,8                                                 AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_37
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_40	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_41		OR @KPI_REF_ID_41=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,9                                                 AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_26
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_29	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_31		OR @KPI_REF_ID_31=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,9                                                 AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_37
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_40	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_42		OR @KPI_REF_ID_42=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,10                                                 AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_26
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_29	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_31
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_32		OR @KPI_REF_ID_32=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,10                                                 AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_37
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_40	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_42
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_43		OR @KPI_REF_ID_43=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,11                                                 AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_23 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_25 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_26
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_29	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_31
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_33		OR @KPI_REF_ID_33=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      ,bkt.TARGET_MS                                                           	--당월계획
      ,bkr.RESULT_MS                                                            --당월실적
      ,CASE WHEN bkt.TARGET_MS<>0 THEN  (bkr.RESULT_MS/bkt.TARGET_MS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
      ,bkt.TARGET_TS                                                            --누계계획
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN  (bkr.RESULT_TS/bkt.TARGET_TS)*100
		    ELSE 0 END                                     AS ACHIVE_RATE_TS    --누계달성율
	  ,CASE WHEN bkr13.RESULT_TS<>0 
		    THEN((bkr.RESULT_TS-bkr13.RESULT_TS)/bkr13.RESULT_TS)*100 
		    ELSE 0 END                                     AS BF_RNF_RATE       --전년동기대비신장율
     ,CASE WHEN   (bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
				   bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
				   bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
				   bkr10.RESULT_TS+bkr11.RESULT_TS)<>0 
            THEN (bkr.RESULT_TS/(bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
								 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
								 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
							     bkr10.RESULT_TS+bkr11.RESULT_TS))*100 
            ELSE 0 END                                     AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,11                                                 AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_34 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_36 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_37
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_40	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_42
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID			  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_44		OR @KPI_REF_ID_44=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-3                                                  AS KPI_REF_ID        --지표코드
      ,'천진법인_ITEM_내수매출_총계'                       AS KPI_NAME			--지표명
      ,'총계'                                              AS ALIAS				--지표별칭
      ,bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
       bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
       bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
       bkt10.TARGET_MS+bkt11.TARGET_MS                     AS TARGET_MS       	--당월계획
      ,bkr.RESULT_MS+bkr2.RESULT_MS+bkr3.RESULT_MS+
       bkr4.RESULT_MS+bkr5.RESULT_MS+bkr6.RESULT_MS+
       bkr7.RESULT_MS+bkr8.RESULT_MS+bkr9.RESULT_MS+
       bkr10.RESULT_MS+bkr11.RESULT_MS                     AS RESULT_MS         --당월실적
      ,CASE WHEN (bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
				  bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
				  bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
				  bkt10.TARGET_MS+bkt11.TARGET_MS)<>0 
			THEN  ((bkr.RESULT_MS+bkr2.RESULT_MS+bkr3.RESULT_MS+
					bkr4.RESULT_MS+bkr5.RESULT_MS+bkr6.RESULT_MS+
					bkr7.RESULT_MS+bkr8.RESULT_MS+bkr9.RESULT_MS+
					bkr10.RESULT_MS+bkr11.RESULT_MS)
					/(bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
					  bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
					  bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
					  bkt10.TARGET_MS+bkt11.TARGET_MS))*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
	   ,bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
        bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
        bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
        bkt10.TARGET_TS+bkt11.TARGET_TS                    AS TARGET_TS       	--누계계획
       ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
        bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
        bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
        bkr10.RESULT_TS+bkr11.RESULT_TS                    AS RESULT_TS        --누계실적
       ,CASE WHEN (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
	 		       bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
				   bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
				   bkt10.TARGET_TS+bkt11.TARGET_TS)<>0 
			 THEN  ((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
					 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
					 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
					 bkr10.RESULT_TS+bkr11.RESULT_TS)
					 /(bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
					   bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
					   bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
					   bkt10.TARGET_TS+bkt11.TARGET_TS))*100
		     ELSE 0 END                                    AS ACHIVE_RATE_TS    --누계달성율
	   ,CASE WHEN (bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
				   bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
				   bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
				   bkr22.RESULT_TS+bkr23.RESULT_TS)<>0 
		     THEN(((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
					bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
					bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
					bkr10.RESULT_TS+bkr11.RESULT_TS)
						-(bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
						  bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
						  bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
						  bkr22.RESULT_TS+bkr23.RESULT_TS))
						       /(bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
								 bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
								 bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
								 bkr22.RESULT_TS+bkr23.RESULT_TS))*100 
		     ELSE 0 END                                    AS BF_RNF_RATE       --전년동기대비신장율
       ,0                                                  AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,12                                                 AS SORT_ORDER        --정렬순서
       ,1                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_24 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_25
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_26 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_29
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_30	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_31	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_RESULT bkr14 ON bkr14.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr14.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr14.KPI_REF_ID		  = @KPI_REF_ID_24
  JOIN BSC_KPI_RESULT bkr15 ON bkr15.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr15.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr15.KPI_REF_ID		  = @KPI_REF_ID_25
  JOIN BSC_KPI_RESULT bkr16 ON bkr16.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr16.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr16.KPI_REF_ID		  = @KPI_REF_ID_26
  JOIN BSC_KPI_RESULT bkr17 ON bkr17.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr17.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr17.KPI_REF_ID		  = @KPI_REF_ID_27
  JOIN BSC_KPI_RESULT bkr18 ON bkr18.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr18.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr18.KPI_REF_ID		  = @KPI_REF_ID_28
  JOIN BSC_KPI_RESULT bkr19 ON bkr19.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr19.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr19.KPI_REF_ID		  = @KPI_REF_ID_29
  JOIN BSC_KPI_RESULT bkr20 ON bkr20.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr20.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr20.KPI_REF_ID		  = @KPI_REF_ID_30
  JOIN BSC_KPI_RESULT bkr21 ON bkr21.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr21.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr21.KPI_REF_ID		  = @KPI_REF_ID_31
  JOIN BSC_KPI_RESULT bkr22 ON bkr22.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr22.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr22.KPI_REF_ID		  = @KPI_REF_ID_32
  JOIN BSC_KPI_RESULT bkr23 ON bkr23.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr23.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr23.KPI_REF_ID		  = @KPI_REF_ID_33
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID	
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt2.YMD				  = bkr.YMD
						 AND bkt2.KPI_REF_ID	   	  = @KPI_REF_ID_24	
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt3.YMD				  = bkr.YMD
						 AND bkt3.KPI_REF_ID	   	  = @KPI_REF_ID_25
  JOIN BSC_KPI_TARGET bkt4 ON bkt4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt4.YMD				  = bkr.YMD
						 AND bkt4.KPI_REF_ID	   	  = @KPI_REF_ID_26	
  JOIN BSC_KPI_TARGET bkt5 ON bkt5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt5.YMD				  = bkr.YMD
						 AND bkt5.KPI_REF_ID	   	  = @KPI_REF_ID_27	
  JOIN BSC_KPI_TARGET bkt6 ON bkt6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt6.YMD				  = bkr.YMD
						 AND bkt6.KPI_REF_ID	   	  = @KPI_REF_ID_28
  JOIN BSC_KPI_TARGET bkt7 ON bkt7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt7.YMD				  = bkr.YMD
						 AND bkt7.KPI_REF_ID	   	  = @KPI_REF_ID_29	
  JOIN BSC_KPI_TARGET bkt8 ON bkt8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt8.YMD				  = bkr.YMD
						 AND bkt8.KPI_REF_ID	   	  = @KPI_REF_ID_30	
  JOIN BSC_KPI_TARGET bkt9 ON bkt9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt9.YMD				  = bkr.YMD
						 AND bkt9.KPI_REF_ID	   	  = @KPI_REF_ID_31	
  JOIN BSC_KPI_TARGET bkt10 ON bkt10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						 AND bkt10.YMD				  = bkr.YMD
						 AND bkt10.KPI_REF_ID	   	  = @KPI_REF_ID_32
  JOIN BSC_KPI_TARGET bkt11 ON bkt11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						 AND bkt11.YMD				  = bkr.YMD
						 AND bkt11.KPI_REF_ID	   	  = @KPI_REF_ID_33						 						 						 						 						 						 						 							 		  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_23		OR @KPI_REF_ID_23=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,-4                                                  AS KPI_REF_ID        --지표코드
      ,'천진법인_ITEM_총매출_총계'                         AS KPI_NAME			--지표명
      ,'총계'                                              AS ALIAS				--지표별칭
      ,bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
       bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
       bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
       bkt10.TARGET_MS+bkt11.TARGET_MS                     AS TARGET_MS       	--당월계획
      ,bkr.RESULT_MS+bkr2.RESULT_MS+bkr3.RESULT_MS+
       bkr4.RESULT_MS+bkr5.RESULT_MS+bkr6.RESULT_MS+
       bkr7.RESULT_MS+bkr8.RESULT_MS+bkr9.RESULT_MS+
       bkr10.RESULT_MS+bkr11.RESULT_MS                     AS RESULT_MS         --당월실적
      ,CASE WHEN (bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
				  bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
				  bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
				  bkt10.TARGET_MS+bkt11.TARGET_MS)<>0 
			THEN  ((bkr.RESULT_MS+bkr2.RESULT_MS+bkr3.RESULT_MS+
					bkr4.RESULT_MS+bkr5.RESULT_MS+bkr6.RESULT_MS+
					bkr7.RESULT_MS+bkr8.RESULT_MS+bkr9.RESULT_MS+
					bkr10.RESULT_MS+bkr11.RESULT_MS)
					/(bkt.TARGET_MS+bkt2.TARGET_MS+bkt3.TARGET_MS+
					  bkt4.TARGET_MS+bkt5.TARGET_MS+bkt6.TARGET_MS+
					  bkt7.TARGET_MS+bkt8.TARGET_MS+bkt9.TARGET_MS+
					  bkt10.TARGET_MS+bkt11.TARGET_MS))*100
		    ELSE 0 END                                     AS ACHIVE_RATE_MS    --당월달성율
	   ,bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
        bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
        bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
        bkt10.TARGET_TS+bkt11.TARGET_TS                    AS TARGET_TS       	--누계계획
       ,bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
        bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
        bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
        bkr10.RESULT_TS+bkr11.RESULT_TS                    AS RESULT_TS        --누계실적
       ,CASE WHEN (bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
	 		       bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
				   bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
				   bkt10.TARGET_TS+bkt11.TARGET_TS)<>0 
			 THEN  ((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
					 bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
					 bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
					 bkr10.RESULT_TS+bkr11.RESULT_TS)
					 /(bkt.TARGET_TS+bkt2.TARGET_TS+bkt3.TARGET_TS+
					   bkt4.TARGET_TS+bkt5.TARGET_TS+bkt6.TARGET_TS+
					   bkt7.TARGET_TS+bkt8.TARGET_TS+bkt9.TARGET_TS+
					   bkt10.TARGET_TS+bkt11.TARGET_TS))*100
		     ELSE 0 END                                    AS ACHIVE_RATE_TS    --누계달성율
	   ,CASE WHEN (bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
				   bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
				   bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
				   bkr22.RESULT_TS+bkr23.RESULT_TS)<>0 
		     THEN(((bkr.RESULT_TS+bkr2.RESULT_TS+bkr3.RESULT_TS+
					bkr4.RESULT_TS+bkr5.RESULT_TS+bkr6.RESULT_TS+
					bkr7.RESULT_TS+bkr8.RESULT_TS+bkr9.RESULT_TS+
					bkr10.RESULT_TS+bkr11.RESULT_TS)
						-(bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
						  bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
						  bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
						  bkr22.RESULT_TS+bkr23.RESULT_TS))
						       /(bkr13.RESULT_TS+bkr14.RESULT_TS+bkr15.RESULT_TS+
								 bkr16.RESULT_TS+bkr17.RESULT_TS+bkr18.RESULT_TS+
								 bkr19.RESULT_TS+bkr20.RESULT_TS+bkr21.RESULT_TS+
								 bkr22.RESULT_TS+bkr23.RESULT_TS))*100 
		     ELSE 0 END                                    AS BF_RNF_RATE       --전년동기대비신장율
       ,0                                                  AS RESULT_RATIO      --실적구성비율
       ,'CJ'                                               AS BU                --사업장
       ,12                                                 AS SORT_ORDER        --정렬순서
       ,2                                                  AS SORT_ORDER2       --정렬순서2
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr2.YMD				  = bkr.YMD
						  AND bkr2.KPI_REF_ID		  = @KPI_REF_ID_35 
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr3.YMD				  = bkr.YMD
						  AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_36
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr4.YMD				  = bkr.YMD
						  AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_37 	
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr5.YMD				  = bkr.YMD
						  AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr6.YMD				  = bkr.YMD
						  AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr7 ON bkr7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr7.YMD				  = bkr.YMD
						  AND bkr7.KPI_REF_ID		  = @KPI_REF_ID_40
  JOIN BSC_KPI_RESULT bkr8 ON bkr8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr8.YMD				  = bkr.YMD
						  AND bkr8.KPI_REF_ID		  = @KPI_REF_ID_41	
  JOIN BSC_KPI_RESULT bkr9 ON bkr9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						  AND bkr9.YMD				  = bkr.YMD
						  AND bkr9.KPI_REF_ID		  = @KPI_REF_ID_42	
  JOIN BSC_KPI_RESULT bkr10 ON bkr10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr10.YMD				  = bkr.YMD
						  AND bkr10.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr11 ON bkr11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						  AND bkr11.YMD				  = bkr.YMD
						  AND bkr11.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_RESULT bkr13 ON bkr13.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr13.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr13.KPI_REF_ID		  = bkr.KPI_REF_ID
  JOIN BSC_KPI_RESULT bkr14 ON bkr14.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr14.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr14.KPI_REF_ID		  = @KPI_REF_ID_35
  JOIN BSC_KPI_RESULT bkr15 ON bkr15.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr15.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr15.KPI_REF_ID		  = @KPI_REF_ID_36
  JOIN BSC_KPI_RESULT bkr16 ON bkr16.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr16.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr16.KPI_REF_ID		  = @KPI_REF_ID_37
  JOIN BSC_KPI_RESULT bkr17 ON bkr17.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr17.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr17.KPI_REF_ID		  = @KPI_REF_ID_38
  JOIN BSC_KPI_RESULT bkr18 ON bkr18.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr18.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr18.KPI_REF_ID		  = @KPI_REF_ID_39
  JOIN BSC_KPI_RESULT bkr19 ON bkr19.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr19.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr19.KPI_REF_ID		  = @KPI_REF_ID_40
  JOIN BSC_KPI_RESULT bkr20 ON bkr20.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr20.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr20.KPI_REF_ID		  = @KPI_REF_ID_41
  JOIN BSC_KPI_RESULT bkr21 ON bkr21.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr21.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr21.KPI_REF_ID		  = @KPI_REF_ID_42
  JOIN BSC_KPI_RESULT bkr22 ON bkr22.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr22.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr22.KPI_REF_ID		  = @KPI_REF_ID_43
  JOIN BSC_KPI_RESULT bkr23 ON bkr23.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID-1
						  AND SUBSTRING(bkr23.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
						  AND bkr23.KPI_REF_ID		  = @KPI_REF_ID_44
  JOIN BSC_KPI_TARGET bkt ON bkt.ESTTERM_REF_ID       = bkr.ESTTERM_REF_ID
						 AND bkt.YMD				  = bkr.YMD
						 AND bkt.KPI_REF_ID	    	  = bkr.KPI_REF_ID	
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt2.YMD				  = bkr.YMD
						 AND bkt2.KPI_REF_ID	   	  = @KPI_REF_ID_35	
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt3.YMD				  = bkr.YMD
						 AND bkt3.KPI_REF_ID	   	  = @KPI_REF_ID_36
  JOIN BSC_KPI_TARGET bkt4 ON bkt4.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt4.YMD				  = bkr.YMD
						 AND bkt4.KPI_REF_ID	   	  = @KPI_REF_ID_37	
  JOIN BSC_KPI_TARGET bkt5 ON bkt5.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt5.YMD				  = bkr.YMD
						 AND bkt5.KPI_REF_ID	   	  = @KPI_REF_ID_38	
  JOIN BSC_KPI_TARGET bkt6 ON bkt6.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt6.YMD				  = bkr.YMD
						 AND bkt6.KPI_REF_ID	   	  = @KPI_REF_ID_39
  JOIN BSC_KPI_TARGET bkt7 ON bkt7.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt7.YMD				  = bkr.YMD
						 AND bkt7.KPI_REF_ID	   	  = @KPI_REF_ID_40	
  JOIN BSC_KPI_TARGET bkt8 ON bkt8.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt8.YMD				  = bkr.YMD
						 AND bkt8.KPI_REF_ID	   	  = @KPI_REF_ID_41	
  JOIN BSC_KPI_TARGET bkt9 ON bkt9.ESTTERM_REF_ID     = bkr.ESTTERM_REF_ID
						 AND bkt9.YMD				  = bkr.YMD
						 AND bkt9.KPI_REF_ID	   	  = @KPI_REF_ID_42	
  JOIN BSC_KPI_TARGET bkt10 ON bkt10.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						 AND bkt10.YMD				  = bkr.YMD
						 AND bkt10.KPI_REF_ID	   	  = @KPI_REF_ID_43
  JOIN BSC_KPI_TARGET bkt11 ON bkt11.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
						 AND bkt11.YMD				  = bkr.YMD
						 AND bkt11.KPI_REF_ID	   	  = @KPI_REF_ID_44						 						 						 						 						 						 						 							 		  								  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_34		OR @KPI_REF_ID_34=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds;
        }

        #endregion

        #region =================== 사업부- Item별 - 영업전략 ===============================

        #endregion

        #region =================== 사업부- Item별 - 전망 ===============================

        public DataSet GetData_M_2_S_7(int estterm_ref_id
                                     , string ymd)
        {
            string query = 
@"



--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부-PTC_매출액
DECLARE @KPI_REF_ID_02 INT   -- DD사업부-VM_매출액
DECLARE @KPI_REF_ID_03 INT   -- DD사업부-EV_매출액
DECLARE @KPI_REF_ID_04 INT   -- DD사업부-AFA_매출액
DECLARE @KPI_REF_ID_05 INT   -- DD사업부-ALC_매출액
DECLARE @KPI_REF_ID_06 INT   -- DD사업부-기타_매출액

DECLARE @KPI_REF_ID_07 INT   -- DO사업부-PCM_매출액
DECLARE @KPI_REF_ID_08 INT   -- DO사업부-TS_매출액
DECLARE @KPI_REF_ID_09 INT   -- DO사업부-Roller_매출액
DECLARE @KPI_REF_ID_10 INT   -- DO사업부-Sleeve_매출액
DECLARE @KPI_REF_ID_11 INT   -- DO사업부-CTR_매출액
DECLARE @KPI_REF_ID_12 INT   -- DO사업부-FCCL_매출액
DECLARE @KPI_REF_ID_13 INT   -- DO사업부-Film_매출액
DECLARE @KPI_REF_ID_14 INT   -- DO사업부-기타_매출액

DECLARE @KPI_REF_ID_15 INT   -- DD사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_16 INT   -- DD사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_17 INT   -- DD사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_18 INT   -- DD사업부-추가여분4_매출액

DECLARE @KPI_REF_ID_19 INT   -- DO사업부-추가여분1_매출액
DECLARE @KPI_REF_ID_20 INT   -- DO사업부-추가여분2_매출액
DECLARE @KPI_REF_ID_21 INT   -- DO사업부-추가여분3_매출액
DECLARE @KPI_REF_ID_22 INT   -- DO사업부-추가여분4_매출액


DECLARE @KPI_REF_ID_23 INT   --천진법인_PTC_매출액         
DECLARE @KPI_REF_ID_24 INT   --천진법인_VM_매출액          
DECLARE @KPI_REF_ID_25 INT   --천진법인_EV_매출액          
DECLARE @KPI_REF_ID_26 INT   --천진법인_AFA_매출액         
DECLARE @KPI_REF_ID_27 INT   --천진법인_PCM_매출액         
DECLARE @KPI_REF_ID_28 INT   --천진법인_ROLLER_매출액      
DECLARE @KPI_REF_ID_29 INT   --천진법인_기타_매출액        
                                                          
DECLARE @KPI_REF_ID_30 INT   --천진법인_추가여분1_매출액   
DECLARE @KPI_REF_ID_31 INT   --천진법인_추가여분2_매출액   
DECLARE @KPI_REF_ID_32 INT   --천진법인_추가여분3_매출액   
DECLARE @KPI_REF_ID_33 INT   --천진법인_추가여분4_매출액 
                             
                             



--SET @ESTTERM_REF_ID =1000                                        
--SET @YMD ='201012'                                         
SET @KPI_REF_ID_01 = 1484                                                       
SET @KPI_REF_ID_02 = 1485                                                       
SET @KPI_REF_ID_03 = 1483                                                       
SET @KPI_REF_ID_04 = 1481                                                       
SET @KPI_REF_ID_05 = 1482                                                       
SET @KPI_REF_ID_06 = 1486                                                       
                                                                                
SET @KPI_REF_ID_07 = 1490                                                       
SET @KPI_REF_ID_08 = 1493                                                       
SET @KPI_REF_ID_09 = 1491                                                       
SET @KPI_REF_ID_10 = 1492                                                       
SET @KPI_REF_ID_11 = 1487                                                       
SET @KPI_REF_ID_12 = 1488                                                       
SET @KPI_REF_ID_13 = 1489                                                       
SET @KPI_REF_ID_14 = 1494                                                       
                                                                                
SET @KPI_REF_ID_15 = 1495                                                       
SET @KPI_REF_ID_16 = 1496                                                       
SET @KPI_REF_ID_17 = 1497                                                       
SET @KPI_REF_ID_18 = 1498                                                       
                                                                                
SET @KPI_REF_ID_19 = 1499                                                       
SET @KPI_REF_ID_20 = 1500                                                       
SET @KPI_REF_ID_21 = 1501                                                       
SET @KPI_REF_ID_22 = 1502   


--천진법인       
SET @KPI_REF_ID_23 = 1635 
SET @KPI_REF_ID_24 = 1637 
SET @KPI_REF_ID_25 = 1639 
SET @KPI_REF_ID_26 = 1641 
SET @KPI_REF_ID_27 = 1643 
SET @KPI_REF_ID_28 = 1645 
SET @KPI_REF_ID_29 = 1647 
                          
SET @KPI_REF_ID_30 = 1649 
SET @KPI_REF_ID_31 = 1651 
SET @KPI_REF_ID_32 = 1653 
SET @KPI_REF_ID_33 = 1655 

 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.22
*	Page view  : DD사업부/DO사업부/천진법인
*	             -ITEM별-향후영업전략 (슬라이드 No.13,21)
*	Grid 구성
*	관련 KPI : 상단 정의 참조
*	KPI_REF_ID : 상단 정의 참조
*									 
*									 
**************************************************************************/

/************
*  DD사업부
*************/

SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,1                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,2                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,3                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,4                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,5                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,6                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
     ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,7                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_15		OR @KPI_REF_ID_15=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,8                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_16		OR @KPI_REF_ID_16=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
     ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,9                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DD'                                                AS BU                  --사업장구분
      ,10                                                   AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_18		OR @KPI_REF_ID_18=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT ITEM_SUM.ESTTERM_REF_ID                                                    --평가년
	  ,ITEM_SUM.YMD                                                               --평가월
	  ,-1                                                   AS KPI_REF_ID         --지표코드
	  ,'DD사업부_합계'                                      AS KPI_NAME	          --지표명
	  ,'합계'                                               AS ALIAS              --지표별칭
	  ,SUM(ITEM_SUM.TARGET_TS)                              AS TARGET_TS          --연간목표
	  ,SUM(ITEM_SUM.RESULT_TS)                              AS RESULT_TS          --누계실적
	  ,CASE WHEN SUM(ITEM_SUM.TARGET_TS)<>0 
	        THEN (SUM(ITEM_SUM.RESULT_TS)/SUM(ITEM_SUM.TARGET_TS))*100
	        ELSE 0 END                                      AS ACHIEVE_RATE       --달성율
	  ,SUM(ITEM_SUM.[2Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후2분기추정
	  ,SUM(ITEM_SUM.[3Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후3분기추정
	  ,SUM(ITEM_SUM.[4Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후4분기추정
	  ,SUM(ITEM_SUM.EXPT_RESULT_TS_SUM)                     AS EXPT_RESULT_TS_SUM --추정치합계    
	  ,'DD'                                                 AS BU                 --사업장구분
	  ,11                                                   AS SORT_ORDER         --정렬순서
  FROM 
	  (
	  	
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME													     		 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
				    							   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
					    THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
						THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
					    THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,1                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID	= @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
						THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
						THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
						THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,2                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID	= @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
						THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
						THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
						THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,3                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID	= @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
						THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
					    THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
						THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,4                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID	= @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
						THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
						THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
						THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,5                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID   = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
					    THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
					    THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
					    THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
					    THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,6                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID   = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
		     ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											       '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
					    THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
					    THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
						THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,7                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_15		OR @KPI_REF_ID_15=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
						THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
						THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
					    THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,8                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID   = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_16		OR @KPI_REF_ID_16=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
					    THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
					    THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
						THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,9                                                   AS SORT_ORDER          --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2    ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID   = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
       UNION ALL
       SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
       	     ,bkr.YMD                                                                    --평가월
             ,bki.KPI_REF_ID                                                             --지표코드
             ,bkp.KPI_NAME																 --지표명
             ,bkp.KPI_DESC                                        AS ALIAS				 --지표별칭
             ,bkt.TARGET_TS                                                        	     --연간목표
             ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				   THEN bkre.RESULT_TS
				   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06') 
				   THEN bkre2.RESULT_TS 
				   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
												   '04','05','06',
												   '07','08','09') 
				   THEN bkre3.RESULT_TS
				   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			 ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
						THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
						THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
						THEN bkr.RESULT_TS+bkre3.RESULT_TS
				   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
             ,'DD'                                                AS BU                  --사업장구분
             ,10                                                   AS SORT_ORDER         --정렬순서
         FROM BSC_KPI_RESULT bkr
         JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND bki.USE_YN			   = 'Y'
         JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
       										AND bkp.USE_YN			   = 'Y'
         JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkt.YMD,5,6) = '12'
         JOIN BSC_KPI_RESULT_EXPECT bkre     ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
       										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
         JOIN BSC_KPI_RESULT_EXPECT bkre2	 ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre2.YMD,5,6)='09'
         JOIN BSC_KPI_RESULT_EXPECT bkre3    ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
       										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
       										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
        WHERE (bkr.ESTTERM_REF_ID   = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
          AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_18		OR @KPI_REF_ID_18=0)
          AND (bkr.YMD			    = @YMD					OR @YMD=N'')
	  	
	  ) AS ITEM_SUM
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD



/************
*  DO사업부
*************/

SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,12                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,13                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,14                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,15                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,16                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,17                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,18                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,19                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_14		OR @KPI_REF_ID_14=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,20                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_19		OR @KPI_REF_ID_19=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,21                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_20		OR @KPI_REF_ID_20=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,22                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'DO'                                                AS BU                  --사업장구분
      ,23                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_22		OR @KPI_REF_ID_22=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT ITEM_SUM.ESTTERM_REF_ID                                                    --평가년
	  ,ITEM_SUM.YMD                                                               --평가월
	  ,-2                                                   AS KPI_REF_ID         --지표코드
	  ,'DO사업부_합계'                                      AS KPI_NAME	          --지표명
	  ,'합계'                                               AS ALIAS              --지표별칭
	  ,SUM(ITEM_SUM.TARGET_TS)                              AS TARGET_TS          --연간목표
	  ,SUM(ITEM_SUM.RESULT_TS)                              AS RESULT_TS          --누계실적
	  ,CASE WHEN SUM(ITEM_SUM.TARGET_TS)<>0 
	        THEN (SUM(ITEM_SUM.RESULT_TS)/SUM(ITEM_SUM.TARGET_TS))*100
	        ELSE 0 END                                      AS ACHIEVE_RATE       --달성율
	  ,SUM(ITEM_SUM.[2Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후2분기추정
	  ,SUM(ITEM_SUM.[3Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후3분기추정
	  ,SUM(ITEM_SUM.[4Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후4분기추정
	  ,SUM(ITEM_SUM.EXPT_RESULT_TS_SUM)                     AS EXPT_RESULT_TS_SUM --추정치합계    
	  ,'DD'                                                 AS BU                 --사업장구분
	  ,24                                                   AS SORT_ORDER         --정렬순서
  FROM 
	  (
	  	
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME															    --지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				  ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	  THEN bkre.RESULT_TS
			      	  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								      '04','05','06') 
			      	  THEN bkre2.RESULT_TS 
			      	  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      									  '04','05','06',
			      									  '07','08','09') 
			      	  THEN bkre3.RESULT_TS
			      	  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      		   THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      		   THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      		   THEN bkr.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      		   THEN bkr.RESULT_TS				
			      	  ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,12                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      										AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt				 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre      ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2     ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3     ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID    = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				  ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	  THEN bkre.RESULT_TS
			      	  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      									  '04','05','06') 
			      	  THEN bkre2.RESULT_TS 
			      	  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      									  '04','05','06',
			      									  '07','08','09') 
			      	  THEN bkre3.RESULT_TS
			      	  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      		   THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      		   THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      		   THEN bkr.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      		   THEN bkr.RESULT_TS				
			      	  ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,13                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      									AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				  ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	  THEN bkre.RESULT_TS
			      	  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      									  '04','05','06') 
			      	  THEN bkre2.RESULT_TS 
			      	  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			       ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      									   '04','05','06',
			      									   '07','08','09') 
			      	   THEN bkre3.RESULT_TS
			      	   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			       ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      			THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			      	   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      			THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			      	   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      			THEN bkr.RESULT_TS+bkre3.RESULT_TS
			      	   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      		    THEN bkr.RESULT_TS				
			      	   ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,14                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      										AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt				 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre		 ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2     ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3	 ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID    = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
           ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				 ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
		       ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			    	 THEN bkre.RESULT_TS
			    	 ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
		       ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			    									 '04','05','06') 
			    	 THEN bkre2.RESULT_TS 
			    	 ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
		       ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			    									 '04','05','06',
			    									 '07','08','09') 
			    	 THEN bkre3.RESULT_TS
			    	 ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
		       ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			    		  THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			    	 WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			    		  THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			    	 WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			    		  THEN bkr.RESULT_TS+bkre3.RESULT_TS
			    	 WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			    		  THEN bkr.RESULT_TS				
			    	 ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,15                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      										AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt				 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre      ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2     ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3	 ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID    = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				  ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
		      	,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
		      		  THEN bkre.RESULT_TS
		      		  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
		      	,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
		      										  '04','05','06') 
		      		  THEN bkre2.RESULT_TS 
		      		  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
		      	,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
		      										  '04','05','06',
		      										  '07','08','09') 
		      		  THEN bkre3.RESULT_TS
		      		  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
		      	,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
		      			   THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
		      		  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
		      			   THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
		      		  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
		      			   THEN bkr.RESULT_TS+bkre3.RESULT_TS
		      		  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
		      			   THEN bkr.RESULT_TS				
		      		  ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,16                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      										AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt				 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre		 ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      										AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2     ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      										AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3     ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      										AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      										AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID    = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				  ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	  THEN bkre.RESULT_TS
			      	  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      									  '04','05','06') 
			      	  THEN bkre2.RESULT_TS 
			      	  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      									  '04','05','06',
			      									  '07','08','09') 
			      	  THEN bkre3.RESULT_TS
			      	  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
			      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      		   THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      		   THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      		   THEN bkr.RESULT_TS+bkre3.RESULT_TS
			      	  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      		   THEN bkr.RESULT_TS				
			      	  ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,17                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      									AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                  THEN bkre.RESULT_TS
                  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06') 
                  THEN bkre2.RESULT_TS 
                  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06',
			      								'07','08','09') 
                  THEN bkre3.RESULT_TS
                  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      	THEN bkr.RESULT_TS				
			      ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,18                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      									AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                  THEN bkre.RESULT_TS
                  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06') 
                  THEN bkre2.RESULT_TS 
                  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06',
			      								'07','08','09') 
                  THEN bkre3.RESULT_TS
                  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      	THEN bkr.RESULT_TS				
			      ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,19                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      									AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_14		OR @KPI_REF_ID_14=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                  THEN bkre.RESULT_TS
                  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06') 
                  THEN bkre2.RESULT_TS 
                  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06',
			      								'07','08','09') 
                  THEN bkre3.RESULT_TS
                  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      	THEN bkr.RESULT_TS				
			      ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,20                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      									AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_19		OR @KPI_REF_ID_19=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
           ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                 THEN bkre.RESULT_TS
                 ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
           ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			     								'04','05','06') 
                 THEN bkre2.RESULT_TS 
                 ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
           ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			     								'04','05','06',
			     								'07','08','09') 
                 THEN bkre3.RESULT_TS
                 ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
           ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			     	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                 WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			     	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                 WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			     	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                 WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			     	THEN bkr.RESULT_TS				
			     ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,21                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      									AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_20		OR @KPI_REF_ID_20=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                  THEN bkre.RESULT_TS
                  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06') 
                  THEN bkre2.RESULT_TS 
                  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06',
			      								'07','08','09') 
                  THEN bkre3.RESULT_TS
                  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      	THEN bkr.RESULT_TS				
			      ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,22                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      									AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')
      UNION ALL
      SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
      	    ,bkr.YMD                                                                    --평가월
            ,bki.KPI_REF_ID                                                             --지표코드
            ,bkp.KPI_NAME																--지표명
            ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
            ,bkt.TARGET_TS                                                        	    --연간목표
            ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				  ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                  THEN bkre.RESULT_TS
                  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06') 
                  THEN bkre2.RESULT_TS 
                  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06',
			      								'07','08','09') 
                  THEN bkre3.RESULT_TS
                  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      	THEN bkr.RESULT_TS				
			      ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
            ,'DO'                                                AS BU                  --사업장구분
            ,23                                                  AS SORT_ORDER          --정렬순서
        FROM BSC_KPI_RESULT bkr
        JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND bki.USE_YN			   = 'Y'
        JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
      									AND bkp.USE_YN			   = 'Y'
        JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkt.YMD,5,6) = '12'
        JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
      									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
        JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre2.YMD,5,6)='09'
        JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
      									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
      									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
       WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
         AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_22		OR @KPI_REF_ID_22=0)
         AND (bkr.YMD			    = @YMD					OR @YMD=N'')  	
	  	
	  ) AS ITEM_SUM
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD





/************
*  천진법인
*************/

SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,25                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_23		OR @KPI_REF_ID_23=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,26                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_24		OR @KPI_REF_ID_24=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,27                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_25		OR @KPI_REF_ID_25=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,28                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_26		OR @KPI_REF_ID_26=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,29                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_27		OR @KPI_REF_ID_27=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,30                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_28		OR @KPI_REF_ID_28=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,31                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_29		OR @KPI_REF_ID_29=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,32                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_30		OR @KPI_REF_ID_30=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,33                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_31		OR @KPI_REF_ID_31=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,34                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_32		OR @KPI_REF_ID_32=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
	  ,bkr.YMD                                                                    --평가월
      ,bki.KPI_REF_ID                                                             --지표코드
      ,bkp.KPI_NAME																  --지표명
      ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
      ,bkt.TARGET_TS                                                        	  --연간목표
      ,bkr.RESULT_TS                                                              --누계실적
      ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
            THEN bkre.RESULT_TS
            ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06') 
            THEN bkre2.RESULT_TS 
            ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
											'04','05','06',
											'07','08','09') 
            THEN bkre3.RESULT_TS
            ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
      ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
				THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
				THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
				THEN bkr.RESULT_TS+bkre3.RESULT_TS
            WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
				THEN bkr.RESULT_TS				
			ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
      ,'CJ'                                                AS BU                  --사업장구분
      ,35                                                  AS SORT_ORDER          --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND bki.USE_YN			   = 'Y'
  JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
									AND bkp.USE_YN			   = 'Y'
  JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkt.YMD,5,6) = '12'
  JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
  JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre2.YMD,5,6)='09'
  JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_33		OR @KPI_REF_ID_33=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT ITEM_SUM.ESTTERM_REF_ID                                                    --평가년
	  ,ITEM_SUM.YMD                                                               --평가월
	  ,-3                                                   AS KPI_REF_ID         --지표코드
	  ,'천진법인_합계'                                      AS KPI_NAME	          --지표명
	  ,'합계'                                               AS ALIAS              --지표별칭
	  ,SUM(ITEM_SUM.TARGET_TS)                              AS TARGET_TS          --연간목표
	  ,SUM(ITEM_SUM.RESULT_TS)                              AS RESULT_TS          --누계실적
	  ,CASE WHEN SUM(ITEM_SUM.TARGET_TS)<>0 
	        THEN (SUM(ITEM_SUM.RESULT_TS)/SUM(ITEM_SUM.TARGET_TS))*100
	        ELSE 0 END                                      AS ACHIEVE_RATE       --달성율
	  ,SUM(ITEM_SUM.[2Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후2분기추정
	  ,SUM(ITEM_SUM.[3Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후3분기추정
	  ,SUM(ITEM_SUM.[4Q_EXPT_RESULT_TS])                    AS [2Q_EXPT_RESULT_TS]--향후4분기추정
	  ,SUM(ITEM_SUM.EXPT_RESULT_TS_SUM)                     AS EXPT_RESULT_TS_SUM --추정치합계    
	  ,'CJ'                                                 AS BU                 --사업장구분
	  ,36                                                   AS SORT_ORDER         --정렬순서
  FROM 
	  (
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
              ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                    THEN bkre.RESULT_TS
                    ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06') 
                    THEN bkre2.RESULT_TS 
                    ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06',
			        								'07','08','09') 
                    THEN bkre3.RESULT_TS
                    ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			        	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			        	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			        	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			        	THEN bkr.RESULT_TS				
			        ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,24                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_23		OR @KPI_REF_ID_23=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
              ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                    THEN bkre.RESULT_TS
                    ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06') 
                    THEN bkre2.RESULT_TS 
                    ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06',
			        								'07','08','09') 
                    THEN bkre3.RESULT_TS
                    ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			        	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			        	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			        	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			        	THEN bkr.RESULT_TS				
			        ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,25                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_24		OR @KPI_REF_ID_24=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
             ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                   THEN bkre.RESULT_TS
                   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
             ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			       								'04','05','06') 
                   THEN bkre2.RESULT_TS 
                   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
             ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			       								'04','05','06',
			       								'07','08','09') 
                   THEN bkre3.RESULT_TS
                   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
             ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			       	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			       	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			       	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			       	THEN bkr.RESULT_TS				
			       ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,26                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_25		OR @KPI_REF_ID_25=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
              ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                    THEN bkre.RESULT_TS
                    ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06') 
                    THEN bkre2.RESULT_TS 
                    ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06',
			        								'07','08','09') 
                    THEN bkre3.RESULT_TS
                    ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			        	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			        	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			        	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			        	THEN bkr.RESULT_TS				
			        ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,27                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_26		OR @KPI_REF_ID_26=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
              ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                    THEN bkre.RESULT_TS
                    ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06') 
                    THEN bkre2.RESULT_TS 
                    ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06',
			        								'07','08','09') 
                    THEN bkre3.RESULT_TS
                    ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			        	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			        	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			        	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			        	THEN bkr.RESULT_TS				
			        ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,28                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_27		OR @KPI_REF_ID_27=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
             ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                   THEN bkre.RESULT_TS
                   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
             ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			       								'04','05','06') 
                   THEN bkre2.RESULT_TS 
                   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
             ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			       								'04','05','06',
			       								'07','08','09') 
                   THEN bkre3.RESULT_TS
                   ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
             ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			       	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                   WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			       	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                   WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			       	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                   WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			       	THEN bkr.RESULT_TS				
			       ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,29                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_28		OR @KPI_REF_ID_28=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
              ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                    THEN bkre.RESULT_TS
                    ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06') 
                    THEN bkre2.RESULT_TS 
                    ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06',
			        								'07','08','09') 
                    THEN bkre3.RESULT_TS
                    ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			        	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			        	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			        	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			        	THEN bkr.RESULT_TS				
			        ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,30                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_29		OR @KPI_REF_ID_29=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
            ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                  THEN bkre.RESULT_TS
                  ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06') 
                  THEN bkre2.RESULT_TS 
                  ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06',
			      								'07','08','09') 
                  THEN bkre3.RESULT_TS
                  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      	THEN bkr.RESULT_TS				
			      ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,31                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_30		OR @KPI_REF_ID_30=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
             ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				   ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
			       ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	   THEN bkre.RESULT_TS
			      	   ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
			       ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      		        					   '04','05','06') 
			      	   THEN bkre2.RESULT_TS 
			      	   ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			      								'04','05','06',
			      								'07','08','09') 
                  THEN bkre3.RESULT_TS
                  ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
            ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			      	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			      	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			      	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                  WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			      	THEN bkr.RESULT_TS				
			      ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,32                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_31		OR @KPI_REF_ID_31=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
              ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
                    ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                    THEN bkre.RESULT_TS
                    ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06') 
                    THEN bkre2.RESULT_TS 
                    ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06',
			        								'07','08','09') 
                    THEN bkre3.RESULT_TS
                    ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
						THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
					WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
						THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
					WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
						THEN bkr.RESULT_TS+bkre3.RESULT_TS
					WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
						THEN bkr.RESULT_TS				
				ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,33                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_32		OR @KPI_REF_ID_32=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')
        UNION ALL
        SELECT bkr.ESTTERM_REF_ID                                                         --평가년 
        	  ,bkr.YMD                                                                    --평가월
              ,bki.KPI_REF_ID                                                             --지표코드
              ,bkp.KPI_NAME																  --지표명
              ,bkp.KPI_DESC                                        AS ALIAS				  --지표별칭
              ,bkt.TARGET_TS                                                        	  --연간목표
              ,bkr.RESULT_TS                                                              --누계실적
              ,CASE WHEN  bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
            ELSE 0 END                                     AS ACHIEVE_RATE        --달성율
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
                    THEN bkre.RESULT_TS
                    ELSE 0 END                                     AS [2Q_EXPT_RESULT_TS] --향후2분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06') 
                    THEN bkre2.RESULT_TS 
                    ELSE 0 END                                     AS [3Q_EXPT_RESULT_TS] --향후3분기추정
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03',
			        								'04','05','06',
			        								'07','08','09') 
                    THEN bkre3.RESULT_TS
                    ELSE 0 END                                     AS [4Q_EXPT_RESULT_TS] --향후4분기추정     
              ,CASE WHEN SUBSTRING(bkr.YMD,5,6) IN ('01','02','03') 
			        	THEN bkr.RESULT_TS+bkre.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('04','05','06')
			        	THEN bkr.RESULT_TS+bkre2.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('07','08','09')
			        	THEN bkr.RESULT_TS+bkre3.RESULT_TS
                    WHEN SUBSTRING(bkr.YMD,5,6) IN ('10','11','12')
			        	THEN bkr.RESULT_TS				
			        ELSE 0 END                                     AS EXPT_RESULT_TS_SUM  --추정치합계
              ,'CJ'                                                AS BU                  --사업장구분
              ,34                                                  AS SORT_ORDER          --정렬순서
          FROM BSC_KPI_RESULT bkr
          JOIN BSC_KPI_INFO bki				 ON bki.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bki.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND bki.USE_YN			   = 'Y'
          JOIN BSC_KPI_POOL bkp				 ON bkp.KPI_POOL_REF_ID	   = bki.KPI_POOL_REF_ID
        									AND bkp.USE_YN			   = 'Y'
          JOIN BSC_KPI_TARGET bkt			 ON bkt.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkt.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkt.YMD,5,6) = '12'
          JOIN BSC_KPI_RESULT_EXPECT bkre    ON bkre.ESTTERM_REF_ID	   = bkr.ESTTERM_REF_ID
        									AND bkre.KPI_REF_ID		   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre.YMD,5,6)= '06' 	
          JOIN BSC_KPI_RESULT_EXPECT bkre2   ON bkre2.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre2.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre2.YMD,5,6)='09'
          JOIN BSC_KPI_RESULT_EXPECT bkre3   ON bkre3.ESTTERM_REF_ID   = bkr.ESTTERM_REF_ID
        									AND bkre3.KPI_REF_ID	   = bkr.KPI_REF_ID
        									AND SUBSTRING(bkre3.YMD,5,6)='12'				  							  						   						  					      		
         WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
           AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_33		OR @KPI_REF_ID_33=0)
           AND (bkr.YMD			    = @YMD					OR @YMD=N'')	  	
              		  	
	  ) AS ITEM_SUM
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD

";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds;
        }

        #endregion



        // 천진 법인 총괄

        public DataTable GetData_M_4_S_1( int estterm_ref_id
                                        , string ymd)
        {
            string query = 
@"


--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- 천진법인-총매출액
DECLARE @KPI_REF_ID_03 INT   -- 천진법인-매출원가
DECLARE @KPI_REF_ID_04 INT   -- 천진법인-판관비
DECLARE @KPI_REF_ID_05 INT   -- 천진법인-내수매출액

--SET @ESTTERM_REF_ID =1000
--SET @YMD ='201003'
SET @KPI_REF_ID_01 = 1712    
SET @KPI_REF_ID_03 = 1457
SET @KPI_REF_ID_04 = 1713
SET @KPI_REF_ID_05 = 1715
    


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.22
*	Page view  : 천진법인-총괄 
*	Grid 구성
*	관련 KPI : 위 정의 참조
*	KPI_REF_ID : 위 정의 참조
*				 
*				 
**************************************************************************/



SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS                                                        	--당월목표
	  ,bkr.RESULT_MS                                                         	--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,'Y'                                                  AS CHART_YN    		--차트사용여부
	  ,'Y'                                                  AS GRID_YN     		--그리드사용여부
	  ,1                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS                                                        	--당월목표
	  ,bkr.RESULT_MS                                                         	--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,'Y'                                                  AS CHART_YN    		--차트사용여부
	  ,'N'                                                  AS GRID_YN     		--그리드사용여부
	  ,2                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END	                                    AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,'N'                                                  AS CHART_YN    		--차트사용여부
	  ,'Y'                                                  AS GRID_YN     		--그리드사용여부
	  ,3                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'				      
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-1												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익'											AS KPI_NAME 		--지표명
      ,'매출총이익'                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS-bkt2.TARGET_MS                         AS TARGET_MS		--당월목표
	  ,bkr.RESULT_MS-bkr3.RESULT_MS							AS RESULT_MS		--당월실적
	  ,CASE WHEN (bkt.TARGET_MS-bkt2.TARGET_MS)<>0
	        THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/(bkt.TARGET_MS-bkt2.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS-bkt2.TARGET_TS							AS TARGET_TS		--누계목표
	  ,bkr.RESULT_TS-bkr3.RESULT_TS							AS RESULT_TS	    --누계실적
	  ,CASE WHEN (bkt.TARGET_TS-bkt2.TARGET_TS)<>0
			THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/(bkt.TARGET_TS-bkt2.TARGET_TS))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS-bkr4.RESULT_TS						AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN (bkr2.RESULT_TS-bkr4.RESULT_TS)<>0
	        THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-(bkr2.RESULT_TS-bkr4.RESULT_TS))/(bkr2.RESULT_TS-bkr4.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,'Y'                                                  AS CHART_YN    		--차트사용여부
	  ,'Y'                                                  AS GRID_YN     		--그리드사용여부
	  ,4                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_03 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-2												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익율'										AS KPI_NAME 		--지표명
      ,'매출총이익율(%)'									AS ALIAS 		    --지표명
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS)*100   
	        ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0 THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS)*100	
	        ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0 THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS))*100)/((((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS))*100))*100		
	        ELSE 0 END                                      AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN ((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100
	        ELSE 0 END                                  	AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100
	        ELSE 0 END                                   	AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS))*100)/((((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS))*100))*100
	        ELSE 0 END                              		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                   	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100)-(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))/(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,'N'                                                  AS CHART_YN    		--차트사용여부
	  ,'Y'                                                  AS GRID_YN     		--그리드사용여부
	  ,5                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_03 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END	                                    AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,'N'                                                  AS CHART_YN    		--차트사용여부
	  ,'Y'                                                  AS GRID_YN     		--그리드사용여부
	  ,6                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'				      
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-3												    AS KPI_REF_ID   	--지표코드
      ,'영업이익'											AS KPI_NAME 		--지표명
      ,'영업이익'                                           AS ALIAS 			--지표별칭
	  ,(bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS        AS TARGET_MS		--당월목표
	  ,(bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS		AS RESULT_MS		--당월실적
	  ,CASE WHEN ((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)<>0
	        THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,(bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS		AS TARGET_TS		--누계목표
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS		AS RESULT_TS	    --누계실적
	  ,CASE WHEN ((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,(bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS		AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN (bkr2.RESULT_TS-bkr4.RESULT_TS)<>0
	        THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					-((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))
						/((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,'N'                                                  AS CHART_YN    		--차트사용여부
	  ,'Y'                                                  AS GRID_YN     		--그리드사용여부
	  ,7                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID	     = @KPI_REF_ID_03 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID	     = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND bkr5.YMD				 = bkt.YMD 
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID-1
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkt.YMD,5,6)                        
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-4												    AS KPI_REF_ID   	--지표코드
      ,'영업이익율'											AS KPI_NAME 		--지표명
      ,'영업이익율(%)'                                      AS ALIAS 			--지표별칭
	  ,CASE WHEN bkt.TARGET_MS<>0
			THEN (((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)
					/bkt.TARGET_MS)*100  
			ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0
			THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/bkr.RESULT_MS)*100		
			ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0
	        THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)/bkr.RESULT_MS)*100)
						/((((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)/bkt.TARGET_MS)*100 ))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0
			THEN (((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)
					/bkt.TARGET_TS)*100		
			ELSE 0 END										AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/bkr.RESULT_TS)*100
			ELSE 0 END                              		AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 AND bkr.RESULT_TS<>0
			THEN (((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100)
						/((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0
			THEN (((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)
					/bkr2.RESULT_TS)*100
			ELSE 0 END                                     	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0
	        THEN ((((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100)
						-((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))
								/((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,'N'                                                  AS CHART_YN    		--차트사용여부
	  ,'Y'                                                  AS GRID_YN     		--그리드사용여부
	  ,8                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID	     = @KPI_REF_ID_03 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID	     = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND bkr5.YMD				 = bkt.YMD 
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID-1
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkt.YMD,5,6)                        
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds.Tables[0];
        }




        public DataTable GetData_M_4_S_10( int estterm_ref_id
                                        , string ymd)
        {
            string query = 
@"


--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)

DECLARE @KPI_REF_ID_01 INT   -- 천진법인-장기채권금액


--SET @ESTTERM_REF_ID =1000
--SET @YMD ='201001'

SET @KPI_REF_ID_01 = 1716    

 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 03
*	2009.12.23
*	Page view  : 천진법인-장기미수금현항
*	Grid 구성
*	관련 KPI : 상위 정의 참조
*	KPI_REF_ID : 상위 정의 참조
* 
* 
**************************************************************************/



SELECT bkr.ESTTERM_REF_ID														--평가년
      ,bkr.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
      ,bkt.TARGET_MS                                                   			--미수금액
	  ,bkr.RESULT_MS															--수금액
	  ,1                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'  
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bkt.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND bkt.YMD				  = bkr.YMD
 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds.Tables[0];
        }


        public DataSet GetData_M_4_S_11( int estterm_ref_id
                                        , string ymd)
        {
            string query = 
@"


--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT --천진법인_PTC_생산수율        
DECLARE @KPI_REF_ID_02 INT --천진법인_VM_생산수율         
DECLARE @KPI_REF_ID_03 INT --천진법인_EV_생산수율         
DECLARE @KPI_REF_ID_04 INT --천진법인_AFA_생산수율        
DECLARE @KPI_REF_ID_05 INT --천진법인_PCM_생산수율        
DECLARE @KPI_REF_ID_06 INT --천진법인_ROLLER_생산수율     
DECLARE @KPI_REF_ID_07 INT --천진법인_기타_생산수율
     
DECLARE @KPI_REF_ID_08 INT --천진법인_추가여분1_생산수율  
DECLARE @KPI_REF_ID_09 INT --천진법인_추가여분2_생산수율  
DECLARE @KPI_REF_ID_10 INT --천진법인_추가여분3_생산수율  
DECLARE @KPI_REF_ID_11 INT --천진법인_추가여분4_생산수율

DECLARE @KPI_REF_ID_12 INT --천진법인_PTC_공정불량율      
DECLARE @KPI_REF_ID_13 INT --천진법인_VM_공정불량율       
DECLARE @KPI_REF_ID_14 INT --천진법인_EV_공정불량율       
DECLARE @KPI_REF_ID_15 INT --천진법인_AFA_공정불량율      
DECLARE @KPI_REF_ID_16 INT --천진법인_PCM_공정불량율      
DECLARE @KPI_REF_ID_17 INT --천진법인_ROLLER_공정불량율   
DECLARE @KPI_REF_ID_18 INT --천진법인_기타_공정불량율 
 
DECLARE @KPI_REF_ID_19 INT --천진법인_추가여분1_공정불량율
DECLARE @KPI_REF_ID_20 INT --천진법인_추가여분2_공정불량율
DECLARE @KPI_REF_ID_21 INT --천진법인_추가여분3_공정불량율
DECLARE @KPI_REF_ID_22 INT --천진법인_추가여분4_공정불량율

--SET @ESTTERM_REF_ID =1000
--SET @YMD ='201003'

SET @KPI_REF_ID_01 = 1717
SET @KPI_REF_ID_02 = 1718
SET @KPI_REF_ID_03 = 1719
SET @KPI_REF_ID_04 = 1720
SET @KPI_REF_ID_05 = 1721
SET @KPI_REF_ID_06 = 1722
SET @KPI_REF_ID_07 = 1723

SET @KPI_REF_ID_08 = 1724
SET @KPI_REF_ID_09 = 1725
SET @KPI_REF_ID_10 = 1726
SET @KPI_REF_ID_11 = 1727

SET @KPI_REF_ID_12 = 1728
SET @KPI_REF_ID_13 = 1729
SET @KPI_REF_ID_14 = 1730
SET @KPI_REF_ID_15 = 1731
SET @KPI_REF_ID_16 = 1732
SET @KPI_REF_ID_17 = 1733
SET @KPI_REF_ID_18 = 1734

SET @KPI_REF_ID_19 = 1735
SET @KPI_REF_ID_20 = 1736
SET @KPI_REF_ID_21 = 1737
SET @KPI_REF_ID_22 = 1738
    


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.30
*	Page view  : 천진법인-ITEM별 생산수율,공정불량율 
*	Grid 구성
*	관련 KPI : 위 정의 참조
*	KPI_REF_ID : 위 정의 참조
*				 
*				 
**************************************************************************/



SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,1                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,1                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,2                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,2                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_13		OR @KPI_REF_ID_13=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,3                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,3                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_14		OR @KPI_REF_ID_14=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,4                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,4                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_15		OR @KPI_REF_ID_15=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,5                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,5                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_16		OR @KPI_REF_ID_16=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,6                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,6                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_17		OR @KPI_REF_ID_17=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,7                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,7                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_18		OR @KPI_REF_ID_18=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,8                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,8                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_19		OR @KPI_REF_ID_19=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,9                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,9                                                    AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_20		OR @KPI_REF_ID_20=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,10                                                   AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,10                                                   AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_21		OR @KPI_REF_ID_21=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,11                                                   AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,1													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_TS                                                            --누계계획
	  ,bkr.RESULT_TS                                                            --누계실적
	  ,CASE WHEN  bkt.TARGET_TS<>0 
	        THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                                      AS ACHIEVE_RATE     --달성율
	  ,bkr2.RESULT_TS                                       AS BF_RESULT_TS     --전년동기대비실적
	  ,11                                                   AS SORT_ORDER1 		--정렬순서(아이템별)
	  ,2													AS SORT_ORDER2 		--정렬순서(항목별)
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_22		OR @KPI_REF_ID_22=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 

";

            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] 		= CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] 		= CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;

			DataSet ds = DbAgentObj.FillDataSet( query, "DATA" , null, paramArray, CommandType.Text);
			return ds;
        }







        /* 수정작업 : 이천십년 시비월 이일
         * 수정작자 : 장동건
         * 수정요청 : 허성덕
         * 수정내용 : 자화전자 실적조회 변경(총괄, 공장별)
       
         * */




        #region =================== 전사 - 총괄 ===============================

        public DataSet GetData_M_0_S_All(int estterm_ref_id
                                        , string ymd)
        {

            string query_old = @"




--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)

DECLARE @KPI_REF_ID_01 INT   -- 전사-Global매출액
DECLARE @KPI_REF_ID_03 INT   -- 전사-매출원가
DECLARE @KPI_REF_ID_04 INT   -- 전사-판관비
                             -- 
DECLARE @KPI_REF_ID_05 INT   -- DD사업부-Global매출액
DECLARE @KPI_REF_ID_06 INT   -- DD사업부-매출원가
DECLARE @KPI_REF_ID_07 INT   -- DD사업부-판관비
                             -- 
DECLARE @KPI_REF_ID_08 INT   -- DO사업부-Global매출액
DECLARE @KPI_REF_ID_09 INT   -- DO사업부-매출원가
DECLARE @KPI_REF_ID_10 INT   -- DO사업부-판관비

SET @ESTTERM_REF_ID =1000
SET @YMD ='201006'

SET @KPI_REF_ID_01 = 3639  -- 1367->3639로 변경(2010.07.15)  
SET @KPI_REF_ID_03 = 3640  -- 1004->3640로 변경(2010.07.15)
SET @KPI_REF_ID_04 = 3641  -- 1472->3641로 변경(2010.07.15)
    
SET @KPI_REF_ID_05= 1393   -- 1371-> 1393으로 변경(2010.03.18)    
SET @KPI_REF_ID_06= 1383   -- 1375-> 1383으로 변경(2010.03.18)
SET @KPI_REF_ID_07= 1473

SET @KPI_REF_ID_08 = 1400    
SET @KPI_REF_ID_09 = 1389
SET @KPI_REF_ID_10 = 1474
 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 03
*	2009.12.23
*	Page view  : 전사/DD/DO-총괄 (슬라이드 No.2,8,16)
*	Grid 구성
*	관련 KPI : 상위 정의 참조
*	KPI_REF_ID : 상위 정의 참조
* 
* 
**************************************************************************/

/*************
*    전사
**************/

SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭\
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,bkr.RESULT_TS-bkr2.RESULT_TS                         AS BF_RNF           --전년년동기 대비 증감액
	  ,bkr.RESULT_TS-bkt.TARGET_TS                          AS TARGET_RNF       --계획대비 증감액
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
	  		ELSE 0 END                                      AS BF_ACHIVE_RATE_TS --전년동기대비 달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --계획대비 달성율
	  ,1                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,bkr.RESULT_TS-bkr2.RESULT_TS                         AS BF_RNF           --전년년동기 대비 증감액
	  ,bkr.RESULT_TS-bkt.TARGET_TS                          AS TARGET_RNF       --계획대비 증감액
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
	  		ELSE 0 END                                      AS BF_ACHIVE_RATE_TS --전년동기대비 달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --계획대비 달성율
	  ,2                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'				      
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-1												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익'											AS KPI_NAME 		--지표명
      ,'매출총이익'                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS-bkt2.TARGET_MS							AS TARGET_MS		--당월목표
	  ,bkr.RESULT_MS-bkr3.RESULT_MS							AS RESULT_MS	    --당월실적     
	  ,bkr2.RESULT_TS-bkr4.RESULT_TS						AS BF_RESULT_TS		--전년동기실적
	  ,bkt.TARGET_TS-bkt2.TARGET_TS							AS TARGET_TS		--누계목표
	  ,bkr.RESULT_TS-bkr3.RESULT_TS							AS RESULT_TS	    --누계실적
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)
		-(bkr2.RESULT_TS-bkr4.RESULT_TS)					AS BF_RNF			--전년년동기 대비 증감액
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)
		 -(bkt.TARGET_TS-bkt2.TARGET_TS)					AS TARGET_RNF       --계획대비 증감액
	  ,CASE WHEN (bkr2.RESULT_TS-bkr4.RESULT_TS)<>0
			THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/(bkr2.RESULT_TS-bkr4.RESULT_TS))*100
			ELSE 0 END                               		AS BF_ACHIVE_RATE_TS --전년동기대비 달성율
	  ,CASE WHEN (bkt.TARGET_TS-bkt2.TARGET_TS)<>0
			THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/(bkt.TARGET_TS-bkt2.TARGET_TS))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --계획대비 달성율
	  ,3                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_03 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-2												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익율'										AS KPI_NAME 		--지표명
      ,'매출총이익율(%)'									AS ALIAS 		    --지표명
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS)*100   
	        ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0 THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS)*100	
	        ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                   	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN ((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100
	        ELSE 0 END                                  	AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100
	        ELSE 0 END                                   	AS RESULT_TS	    --누계실적 
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0 THEN  (((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100) - (((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100)
	        ELSE 0 END                                      AS BF_RNF			--전년년동기 대비 증감액
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0 THEN  (((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100) - (((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100)
	        ELSE 0 END                                      AS TARGET_RNF       --계획대비 증감액  
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0 THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS))*100)/((((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))*100
	        ELSE 0 END                              		AS BF_ACHIVE_RATE_TS --전년동기대비 달성율       
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0 THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS))*100)/((((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100))*100
	        ELSE 0 END                              		AS ACHIVE_RATE_TS   --계획대비 달성율
	  ,4                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_03 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,bkr.RESULT_TS-bkr2.RESULT_TS                         AS BF_RNF           --전년년동기 대비 증감액
	  ,bkr.RESULT_TS-bkt.TARGET_TS                          AS TARGET_RNF       --계획대비 증감액
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
	  		ELSE 0 END                                      AS BF_ACHIVE_RATE_TS --전년동기대비 달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --계획대비 달성율
	  ,5                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-3												    AS KPI_REF_ID   	--지표코드
      ,'영업이익'											AS KPI_NAME 		--지표명
      ,'영업이익'                                           AS ALIAS 			--지표별칭
	  ,(bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS        AS TARGET_MS		--당월목표
	  ,(bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS		AS RESULT_MS		--당월실적
	  ,(bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS		AS BF_RESULT_TS		--전년동기실적
	  ,(bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS    	AS TARGET_TS		--누계목표
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS    	AS RESULT_TS	    --누계실적
	  ,((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
		-((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)   AS BF_RNF           --전년년동기 대비 증감액
	  ,((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
	    -((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)    AS TARGET_RNF       --계획대비 증감액
	  ,CASE WHEN ((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS )<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))*100
			ELSE 0 END                               		AS BF_ACHIVE_RATE_TS --전년동기대비 달성율
	  ,CASE WHEN ((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS )<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS ))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --계획대비 달성율
	  ,6                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID		 = @KPI_REF_ID_03 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID		 = @KPI_REF_ID_04 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND bkr5.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_04
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-4												    AS KPI_REF_ID   	--지표코드
      ,'영업이익율'											AS KPI_NAME 		--지표명
      ,'영업이익율(%)'                                      AS ALIAS 			--지표별칭
	  ,CASE WHEN bkt.TARGET_MS<>0
			THEN (((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)
					/bkt.TARGET_MS)*100  
			ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0
			THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/bkr.RESULT_MS)*100		
			ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr2.RESULT_TS<>0
			THEN (((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)
					/bkr2.RESULT_TS)*100
			ELSE 0 END                                     	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkt.TARGET_TS<>0
			THEN (((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)
					/bkt.TARGET_TS)*100		
			ELSE 0 END										AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/bkr.RESULT_TS)*100
			ELSE 0 END                              		AS RESULT_TS	    --누계실적			
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0
			THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100)
			   	  -((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100)	
			ELSE 0 END                                      AS BF_RNF           --전년년동기 대비 증감액		
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0
			THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100)
			   	  -((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100	)	
			ELSE 0 END                                      AS TARGET_RNF       --계획대비 증감액	

	  ,CASE WHEN bkt.TARGET_TS<>0 AND bkr2.RESULT_TS<>0
			THEN (((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100)
						/((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))*100
			ELSE 0 END                               		AS BF_ACHIVE_RATE_TS --전년동기대비 달성율              
	  ,CASE WHEN bkt.TARGET_TS<>0 AND bkr.RESULT_TS<>0
			THEN (((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100)
						/((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --계획대비 달성율

	  ,7                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID	     = @KPI_REF_ID_03 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID	     = @KPI_REF_ID_04
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_03
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND bkr5.YMD				 = bkt.YMD 
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID-1
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_04
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkt.YMD,5,6)                        
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/*************
*  DD사업부
**************/

SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,1                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END	                                    AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,2                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'				      
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-1												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익'											AS KPI_NAME 		--지표명
      ,'매출총이익'                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS-bkt2.TARGET_MS                         AS TARGET_MS		--당월목표
	  ,bkr.RESULT_MS-bkr3.RESULT_MS							AS RESULT_MS		--당월실적
	  ,CASE WHEN (bkt.TARGET_MS-bkt2.TARGET_MS)<>0
	        THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/(bkt.TARGET_MS-bkt2.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS-bkt2.TARGET_TS							AS TARGET_TS		--누계목표
	  ,bkr.RESULT_TS-bkr3.RESULT_TS							AS RESULT_TS	    --누계실적
	  ,CASE WHEN (bkt.TARGET_TS-bkt2.TARGET_TS)<>0
			THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/(bkt.TARGET_TS-bkt2.TARGET_TS))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS-bkr4.RESULT_TS						AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN (bkr2.RESULT_TS-bkr4.RESULT_TS)<>0
	        THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-(bkr2.RESULT_TS-bkr4.RESULT_TS))/(bkr2.RESULT_TS-bkr4.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,3                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_06 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_06
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-2												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익율'										AS KPI_NAME 		--지표명
      ,'매출총이익율(%)'									AS ALIAS 		    --지표명
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS)*100   
	        ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0 THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS)*100	
	        ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0 THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS))*100)/((((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS))*100))*100		
	        ELSE 0 END                                      AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN ((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100
	        ELSE 0 END                                  	AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100
	        ELSE 0 END                                   	AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS))*100)/((((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS))*100))*100
	        ELSE 0 END                              		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                   	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100)-(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))/(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,4                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_06 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_06
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                   					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                  					AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,5                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-3												    AS KPI_REF_ID   	--지표코드
      ,'영업이익'											AS KPI_NAME 		--지표명
      ,'영업이익'                                           AS ALIAS 			--지표별칭
	  ,(bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS        AS TARGET_MS		--당월목표
	  ,(bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS		AS RESULT_MS		--당월실적
	  ,CASE WHEN ((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)<>0
	        THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,(bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS    	AS TARGET_TS		--누계목표
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS    	AS RESULT_TS	    --누계실적
	  ,CASE WHEN ((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS )<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS ))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,(bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS		AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)<>0
	        THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					-((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))
						/((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,6                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID		 = @KPI_REF_ID_06 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID		 = @KPI_REF_ID_07 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_07
                          AND bkr5.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_07
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-4												    AS KPI_REF_ID   	--지표코드
      ,'영업이익율'											AS KPI_NAME 		--지표명
      ,'영업이익율(%)'                                      AS ALIAS 			--지표별칭
	  ,CASE WHEN bkt.TARGET_MS<>0
			THEN (((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)
					/bkt.TARGET_MS)*100  
			ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0
			THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/bkr.RESULT_MS)*100		
			ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0
	        THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)/bkr.RESULT_MS)*100)
						/((((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)/bkt.TARGET_MS)*100 ))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0
			THEN (((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)
					/bkt.TARGET_TS)*100		
			ELSE 0 END										AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/bkr.RESULT_TS)*100
			ELSE 0 END                              		AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 AND bkr.RESULT_TS<>0
			THEN (((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100)
						/((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0
			THEN (((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)
					/bkr2.RESULT_TS)*100
			ELSE 0 END                                     	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0
	        THEN ((((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100)
						-((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))
								/((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,7                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID	     = @KPI_REF_ID_06 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID	     = @KPI_REF_ID_07
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_06
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_07
                          AND bkr5.YMD				 = bkt.YMD 
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID-1
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_07
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkt.YMD,5,6)                        
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
   
   
   
   
   
/*************
*  DO사업부
**************/

SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END                                      AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,1                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                     					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	  		ELSE 0 END	                                    AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,2                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'				      
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-1												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익'											AS KPI_NAME 		--지표명
      ,'매출총이익'                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS-bkt2.TARGET_MS                         AS TARGET_MS		--당월목표
	  ,bkr.RESULT_MS-bkr3.RESULT_MS							AS RESULT_MS		--당월실적
	  ,CASE WHEN (bkt.TARGET_MS-bkt2.TARGET_MS)<>0
	        THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/(bkt.TARGET_MS-bkt2.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS-bkt2.TARGET_TS							AS TARGET_TS		--누계목표
	  ,bkr.RESULT_TS-bkr3.RESULT_TS							AS RESULT_TS	    --누계실적
	  ,CASE WHEN (bkt.TARGET_TS-bkt2.TARGET_TS)<>0
			THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/(bkt.TARGET_TS-bkt2.TARGET_TS))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS-bkr4.RESULT_TS						AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN (bkr2.RESULT_TS-bkr4.RESULT_TS)<>0
	        THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-(bkr2.RESULT_TS-bkr4.RESULT_TS))/(bkr2.RESULT_TS-bkr4.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,3                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_09 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_09
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL   
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-2												    AS KPI_REF_ID   	--지표코드
      ,'매출총이익율'										AS KPI_NAME 		--지표명
      ,'매출총이익율(%)'									AS ALIAS 		    --지표명
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS)*100   
	        ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0 THEN ((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS)*100	
	        ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0 THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)/bkr.RESULT_MS))*100)/((((bkt.TARGET_MS-bkt2.TARGET_MS)/bkt.TARGET_MS))*100))*100		
	        ELSE 0 END                                      AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN ((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS)*100
	        ELSE 0 END                                  	AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100
	        ELSE 0 END                                   	AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkt.TARGET_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS))*100)/((((bkt.TARGET_TS-bkt2.TARGET_TS)/bkt.TARGET_TS))*100))*100
	        ELSE 0 END                              		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                   	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0 THEN (((((bkr.RESULT_TS-bkr3.RESULT_TS)/bkr.RESULT_TS)*100)-(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))/(((bkr2.RESULT_TS-bkr4.RESULT_TS)/bkr2.RESULT_TS)*100))*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,4                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD = bkt.YMD
						  AND bkt2.KPI_REF_ID = @KPI_REF_ID_09 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_09
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL  
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,bki.KPI_REF_ID															--지표코드      
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                         AS ALIAS 			--지표별칭
	  ,bkt.TARGET_MS															--당월목표
	  ,bkr.RESULT_MS															--당월실적
	  ,CASE WHEN bkt.TARGET_MS<>0 THEN (bkr.RESULT_MS/bkt.TARGET_MS)*100
	        ELSE 0 END                   					AS ACHIVE_RATE_MS   --당월달성율
	  ,bkt.TARGET_TS															--누계목표
	  ,bkr.RESULT_TS															--누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
	        ELSE 0 END                  					AS ACHIVE_RATE_TS   --누계달성율
	  ,bkr2.RESULT_TS										AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN ((bkr.RESULT_TS-bkr2.RESULT_TS)/bkr2.RESULT_TS)*100
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,5                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		 = bkt.KPI_REF_ID
					      AND bki.USE_YN			 = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	 = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			 = 'Y'
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-3												    AS KPI_REF_ID   	--지표코드
      ,'영업이익'											AS KPI_NAME 		--지표명
      ,'영업이익'                                           AS ALIAS 			--지표별칭
	  ,(bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS        AS TARGET_MS		--당월목표
	  ,(bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS		AS RESULT_MS		--당월실적
	  ,CASE WHEN ((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)<>0
	        THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,(bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS    	AS TARGET_TS		--누계목표
	  ,(bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS    	AS RESULT_TS	    --누계실적
	  ,CASE WHEN ((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS )<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS ))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,(bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS		AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN ((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)<>0
	        THEN ((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					-((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))
						/((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,6                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID		 = @KPI_REF_ID_09 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID		 = @KPI_REF_ID_10 
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_10
                          AND bkr5.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_10
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'') 
 UNION ALL 
SELECT bkt.ESTTERM_REF_ID														--평가년
      ,bkt.YMD																	--평가월
      ,-4												    AS KPI_REF_ID   	--지표코드
      ,'영업이익율'											AS KPI_NAME 		--지표명
      ,'영업이익율(%)'                                      AS ALIAS 			--지표별칭
	  ,CASE WHEN bkt.TARGET_MS<>0
			THEN (((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)
					/bkt.TARGET_MS)*100  
			ELSE 0 END                                      AS TARGET_MS		--당월목표
	  ,CASE WHEN bkr.RESULT_MS<>0
			THEN (((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)
					/bkr.RESULT_MS)*100		
			ELSE 0 END                                      AS RESULT_MS		--당월실적
	  ,CASE WHEN bkr.RESULT_MS<>0 AND bkt.TARGET_MS<>0
	        THEN (((((bkr.RESULT_MS-bkr3.RESULT_MS)-bkr5.RESULT_MS)/bkr.RESULT_MS)*100)
						/((((bkt.TARGET_MS-bkt2.TARGET_MS)-bkt3.TARGET_MS)/bkt.TARGET_MS)*100 ))*100
	        ELSE 0 END                               		AS ACHIVE_RATE_MS   --당월달성율
	  ,CASE WHEN bkt.TARGET_TS<>0
			THEN (((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)
					/bkt.TARGET_TS)*100		
			ELSE 0 END										AS TARGET_TS		--누계목표
	  ,CASE WHEN bkr.RESULT_TS<>0
			THEN (((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)
					/bkr.RESULT_TS)*100
			ELSE 0 END                              		AS RESULT_TS	    --누계실적
	  ,CASE WHEN bkt.TARGET_TS<>0 AND bkr.RESULT_TS<>0
			THEN (((((bkt.TARGET_TS-bkt2.TARGET_TS)-bkt3.TARGET_TS)/bkt.TARGET_TS)*100)
						/((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100))*100
			ELSE 0 END                               		AS ACHIVE_RATE_TS   --누계달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0
			THEN (((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)
					/bkr2.RESULT_TS)*100
			ELSE 0 END                                     	AS BF_RESULT_TS		--전년동기실적
	  ,CASE WHEN bkr.RESULT_TS<>0 AND bkr2.RESULT_TS<>0
	        THEN ((((((bkr.RESULT_TS-bkr3.RESULT_TS)-bkr5.RESULT_TS)/bkr.RESULT_TS)*100)
						-((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))
								/((((bkr2.RESULT_TS-bkr4.RESULT_TS)-bkr6.RESULT_TS)/bkr2.RESULT_TS)*100))*100  
	        ELSE 0 END                                      AS RNF_RATE 		--증감율
	  ,7                                                    AS SORT_ORDER  		--정렬순서
  FROM BSC_KPI_TARGET bkt
  JOIN BSC_KPI_TARGET bkt2 ON bkt2.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt2.YMD				 = bkt.YMD
						  AND bkt2.KPI_REF_ID	     = @KPI_REF_ID_09 
  JOIN BSC_KPI_TARGET bkt3 ON bkt3.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
						  AND bkt3.YMD				 = bkt.YMD
						  AND bkt3.KPI_REF_ID	     = @KPI_REF_ID_10
  JOIN BSC_KPI_RESULT bkr  ON bkr.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr.KPI_REF_ID		 = bkt.KPI_REF_ID
                          AND bkr.YMD				 = bkt.YMD
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		 = bkr.KPI_REF_ID
					      AND SUBSTRING(bkt.YMD,5,6) = SUBSTRING(bkr2.YMD,5,6)
  JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID    = bkr.ESTTERM_REF_ID
					      AND bkr3.YMD				 = bkr.YMD
					      AND bkr3.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	 = bkr.ESTTERM_REF_ID-1
                          AND SUBSTRING(bkr4.YMD,5,6)= SUBSTRING(bkr.YMD,5,6)
                          AND bkr4.KPI_REF_ID		 = @KPI_REF_ID_09
  JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID
                          AND bkr5.KPI_REF_ID		 = @KPI_REF_ID_10
                          AND bkr5.YMD				 = bkt.YMD 
  JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	 = bkt.ESTTERM_REF_ID-1
                          AND bkr6.KPI_REF_ID		 = @KPI_REF_ID_10
                          AND SUBSTRING(bkr6.YMD,5,6)= SUBSTRING(bkt.YMD,5,6)                        
 WHERE (bkt.ESTTERM_REF_ID  = @ESTTERM_REF_ID		OR @ESTTERM_REF_ID =0)
   AND (bkt.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkt.YMD			    = @YMD					OR @YMD=N'')


";



            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] = CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] = CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;
            //paramArray[2] 		= CreateDataParameter("@KPI_REF_ID_01", SqlDbType.Int);
            //paramArray[2].Value = kpi_id_01;
            //paramArray[3] 		= CreateDataParameter("@KPI_REF_ID_02", SqlDbType.Int);
            //paramArray[3].Value = kpi_id_02;
            //paramArray[4] 		= CreateDataParameter("@KPI_REF_ID_03", SqlDbType.Int);
            //paramArray[4].Value = kpi_id_03;
            //paramArray[5] 		= CreateDataParameter("@KPI_REF_ID_04", SqlDbType.Int);
            //paramArray[5].Value = kpi_id_04;

            DataSet ds = DbAgentObj.FillDataSet(query_old, "DATA", null, paramArray, CommandType.Text);
            return ds;
        }



        #endregion

        #region =================== 전사 - 공장별 ===============================

        public DataSet GetData_M_0_S_Factory(int estterm_ref_id
                                        , string ymd)
        {

            string query_old = @"



--DECLARE @ESTTERM_REF_ID INT
--DECLARE @YMD VARCHAR(8)
DECLARE @KPI_REF_ID_01 INT   -- DD사업부-Global매출액
DECLARE @KPI_REF_ID_02 INT   -- DD사업부-Global영업이익
DECLARE @KPI_REF_ID_03 INT   -- DO사업부-Global매출액(실제지표:DO영업팀)
DECLARE @KPI_REF_ID_04 INT   -- DO사업부-Global영업이익(실제지표:DO영업팀)
DECLARE @KPI_REF_ID_05 INT   -- 천진법인_매출액
DECLARE @KPI_REF_ID_06 INT   -- 천진법인_영업이익
DECLARE @KPI_REF_ID_07 INT   -- 혜주법인_매출액
DECLARE @KPI_REF_ID_08 INT   -- 혜주법인_영업이익
DECLARE @KPI_REF_ID_09 INT   -- 말레이법인_매출액
DECLARE @KPI_REF_ID_10 INT   -- 말레이법인_영업이익
DECLARE @KPI_REF_ID_11 INT   -- 베트남법인_매출액
DECLARE @KPI_REF_ID_12 INT   -- 베트남법인_영업이익


SET @ESTTERM_REF_ID =1000
SET @YMD ='201006'
SET @KPI_REF_ID_01 = 3642     -- 1371 -> 3642 로 변경(2010.07.15) 
SET @KPI_REF_ID_02 = 3643     -- 1372 -> 3643 로 변경(2010.07.15)
SET @KPI_REF_ID_03 = 3644     -- 1400 -> 3644 로 변경(2010.07.15)
SET @KPI_REF_ID_04 = 3645     -- 1401 -> 3645 로 변경(2010.07.15)
SET @KPI_REF_ID_05 = 3646     -- 1475 -> 3646 로 변경(2010.07.15)
SET @KPI_REF_ID_06 = 3647     -- 1476 -> 3647 로 변경(2010.07.15)
SET @KPI_REF_ID_07 = 3648     -- 1477 -> 3648 로 변경(2010.07.15)
SET @KPI_REF_ID_08 = 3649     -- 1478 -> 3649 로 변경(2010.07.15)
SET @KPI_REF_ID_09 = 3650     -- 1479 -> 3650 로 변경(2010.07.15)
SET @KPI_REF_ID_10 = 3651     -- 1480 -> 3651 로 변경(2010.07.15)
SET @KPI_REF_ID_11 = 3652     -- 1525 -> 3652 로 변경(2010.07.15)
SET @KPI_REF_ID_12 = 3653     -- 1526 -> 3653 로 변경(2010.07.15)

    


 
/**************************************************************************
* 
* 
*	자화전자 JPM 경영실적보고(EIS) Raw Data 구성 01
*	2009.12.14
*	Page view  : 전사-공장별 (슬라이드 No.03)
*	Grid 구성
*	관련 KPI : 천진법인_매출액
*			   천진법인_영업이익
*			   혜주법인_매출액
*			   혜주법인_영업이익
*			   말레이법인_매출액
*			   말레이법인_영업이익
*	KPI_REF_ID : 1371,1372,1400,1401,1475,1476,1477,1478,1479,1480
*									 
*									 
**************************************************************************/


SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,1                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					      AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					      AND bkt.YMD	              = bkr.YMD
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,2                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					      AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					      AND bkt.YMD	              = bkr.YMD			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,3                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)	
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					      AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					      AND bkt.YMD	              = bkr.YMD						  				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,4                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)	
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					      AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					      AND bkt.YMD	              = bkr.YMD				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL          
SELECT ITEM_SUM.ESTTERM_REF_ID                                                       --평가년 
	  ,ITEM_SUM.YMD                                                                  --평가월
      ,-1                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부/DO사업부 매출액 소계'                     AS KPI_NAME   		--지표명
      ,'소계'                                              AS ALIAS				--지표별칭
      ,SUM(ITEM_SUM.BF_RESULT)                             AS BF_RESULT         --전년동기실적
      ,SUM(ITEM_SUM.TARGET_TS)                             AS TARGET_TS         --누계목표
      ,SUM(ITEM_SUM.RESULT_TS)                             AS RESULT_TS         --누계실적
      ,0												   AS ACHIEVE_RATE      --계획대비달성율
      ,0    											   AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,SUM(ITEM_SUM.RESULT_RNF)                            AS RESULT_RNF        --전년동기증감
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,5                                                   AS SORT_ORDER        --정렬순서
  FROM (
  	
  		SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
			  ,bkr.YMD                                                                  --평가월
			  ,bki.KPI_REF_ID                                                           --지표코드
			  ,bkp.KPI_NAME																--지표명
			  ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
			  --,bkr.RESULT_MS                                                            --당월실적
			  ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
			  ,bkt.TARGET_TS															--누계목표
			  ,bkr.RESULT_TS                                                            --누계실적
			  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
			   ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
			  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
			   ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
			  ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			  ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			  ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			  ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			  ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			  ,'Y'                                                 AS GRID_YN           --그리드사용유무
			  ,1                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
		  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					              AND bkt.YMD	              = bkr.YMD			
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_01		OR @KPI_REF_ID_01=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
		 UNION ALL	
		 SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
				,bkr.YMD                                                                  --평가월
				,bki.KPI_REF_ID                                                           --지표코드
				,bkp.KPI_NAME																--지표명
				,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
				--,bkr.RESULT_MS                                                            --당월실적
				,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
				,bkt.TARGET_TS															--누계목표
				,bkr.RESULT_TS                                                            --누계실적
				,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
				 ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
				,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
				 ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
				,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			    ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			    ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			    ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			    ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			    ,'Y'                                                 AS GRID_YN           --그리드사용유무
			    ,3                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
		  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					              AND bkt.YMD	              = bkr.YMD				
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_03		OR @KPI_REF_ID_03=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')

  ) AS ITEM_SUM
    JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr3.YMD			  = ITEM_SUM.YMD
							AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_05	
	JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr4.YMD			  = ITEM_SUM.YMD
							AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_07
	JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr5.YMD			  = ITEM_SUM.YMD
							AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_09	
	JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr6.YMD			  = ITEM_SUM.YMD
							AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_11	
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD, bkr3.RESULT_TS, bkr4.RESULT_TS, bkr5.RESULT_TS, bkr6.RESULT_TS
UNION ALL      
SELECT ITEM_SUM.ESTTERM_REF_ID                                                       --평가년 
	  ,ITEM_SUM.YMD                                                                  --평가월
      ,-2                                                  AS KPI_REF_ID        --지표코드
      ,'DD사업부/DO사업부 영업이익 소계'                   AS KPI_NAME   		--지표명
      ,'소계'                                              AS ALIAS				--지표별칭
      ,SUM(ITEM_SUM.BF_RESULT)                             AS BF_RESULT         --전년동기실적
      ,SUM(ITEM_SUM.TARGET_TS)                             AS TARGET_TS         --누계목표
      ,SUM(ITEM_SUM.RESULT_TS)                             AS RESULT_TS         --누계실적
      ,0												   AS ACHIEVE_RATE      --계획대비달성율
      ,0    											   AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,SUM(ITEM_SUM.RESULT_RNF)                            AS RESULT_RNF        --전년동기증감
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,6                                                   AS SORT_ORDER        --정렬순서
  FROM (
  	
  		SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
			  ,bkr.YMD                                                                  --평가월
			  ,bki.KPI_REF_ID                                                           --지표코드
			  ,bkp.KPI_NAME																--지표명
			  ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
			  --,bkr.RESULT_MS                                                            --당월실적
			  ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
			  ,bkt.TARGET_TS															--누계목표
			  ,bkr.RESULT_TS                                                            --누계실적
			  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
			   ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
			  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
			   ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
			  ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,2                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
		  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					              AND bkt.YMD	              = bkr.YMD				
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_02		OR @KPI_REF_ID_02=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
		 UNION ALL	
  		SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
			  ,bkr.YMD                                                                  --평가월
			  ,bki.KPI_REF_ID                                                           --지표코드
			  ,bkp.KPI_NAME																--지표명
			  ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
			  --,bkr.RESULT_MS                                                            --당월실적
			  ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
			  ,bkt.TARGET_TS															--누계목표
			  ,bkr.RESULT_TS                                                            --누계실적
			  ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
			   ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
			  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
			   ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
			  ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
			   ,'N'                                                 AS CHARTA_YN         --차트A사용유무
			   ,'N'                                                 AS CHARTB_YN         --차트B사용유무
			   ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
			   ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
			   ,'Y'                                                 AS GRID_YN           --그리드사용유무
			   ,4                                                   AS SORT_ORDER        --정렬순서
		  FROM BSC_KPI_RESULT bkr
		  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
			    				  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					    	      AND bki.USE_YN			  = 'Y'
		  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
							      AND bkp.USE_YN			  = 'Y'
		  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
								  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
								  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
		  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
					              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
					              AND bkt.YMD	              = bkr.YMD				
		 WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
		   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_04		OR @KPI_REF_ID_04=0)
		   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
  	
  	
  ) AS ITEM_SUM
    JOIN BSC_KPI_RESULT bkr3 ON bkr3.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr3.YMD			  = ITEM_SUM.YMD
							AND bkr3.KPI_REF_ID		  = @KPI_REF_ID_06	
	JOIN BSC_KPI_RESULT bkr4 ON bkr4.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr4.YMD			  = ITEM_SUM.YMD
							AND bkr4.KPI_REF_ID		  = @KPI_REF_ID_08
	JOIN BSC_KPI_RESULT bkr5 ON bkr5.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr5.YMD			  = ITEM_SUM.YMD
							AND bkr5.KPI_REF_ID		  = @KPI_REF_ID_10	
	JOIN BSC_KPI_RESULT bkr6 ON bkr6.ESTTERM_REF_ID	  = ITEM_SUM.ESTTERM_REF_ID
							AND bkr6.YMD			  = ITEM_SUM.YMD
							AND bkr6.KPI_REF_ID		  = @KPI_REF_ID_12
GROUP BY ITEM_SUM.ESTTERM_REF_ID ,ITEM_SUM.YMD, bkr3.RESULT_TS, bkr4.RESULT_TS, bkr5.RESULT_TS, bkr6.RESULT_TS  
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,7                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD							  						  			
WHERE (bkr.ESTTERM_REF_ID   = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_05		OR @KPI_REF_ID_05=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,8                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD					
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_06		OR @KPI_REF_ID_06=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,9                                                   AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)	
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_07		OR @KPI_REF_ID_07=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,10                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD					
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_08		OR @KPI_REF_ID_08=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,11                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD							
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_09		OR @KPI_REF_ID_09=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,12                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_10		OR @KPI_REF_ID_10=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'Y'                                                 AS CHARTA_YN         --차트A사용유무
      ,'N'                                                 AS CHARTB_YN         --차트B사용유무
      ,'Y'                                                 AS CHARTC_YN         --차트C사용유무
      ,'N'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,13                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD			
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_11		OR @KPI_REF_ID_11=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')
UNION ALL 
SELECT bkr.ESTTERM_REF_ID                                                       --평가년 
	  ,bkr.YMD                                                                  --평가월
      ,bki.KPI_REF_ID                                                           --지표코드
      ,bkp.KPI_NAME																--지표명
      ,bkp.KPI_DESC                                        AS ALIAS				--지표별칭
      --,bkr.RESULT_MS                                                            --당월실적
      ,bkr2.RESULT_TS									   AS BF_RESULT         --전년동기실적
      ,bkt.TARGET_TS															--누계목표
      ,bkr.RESULT_TS                                                            --누계실적
      ,CASE WHEN bkt.TARGET_TS<>0 THEN (bkr.RESULT_TS/bkt.TARGET_TS)*100
       ELSE 0 END                                          AS ACHIEVE_RATE      --계획대비달성율
	  ,CASE WHEN bkr2.RESULT_TS<>0 THEN (bkr.RESULT_TS/bkr2.RESULT_TS)*100
       ELSE 0 END                                          AS BF_ACHIEVE_RATE   --전년동기대비달성율
      ,bkr.RESULT_TS-bkr2.RESULT_TS                        AS RESULT_RNF        --전년동기증감
      ,'N'                                                 AS CHARTA_YN         --차트A사용유무
      ,'Y'                                                 AS CHARTB_YN         --차트B사용유무
      ,'N'                                                 AS CHARTC_YN         --차트C사용유무
      ,'Y'                                                 AS CHARTD_YN         --차트D사용유무
      ,'Y'                                                 AS GRID_YN           --그리드사용유무
      ,14                                                  AS SORT_ORDER        --정렬순서
  FROM BSC_KPI_RESULT bkr
  JOIN BSC_KPI_INFO bki	   ON bki.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID
						  AND bki.KPI_REF_ID		  = bkr.KPI_REF_ID
					      AND bki.USE_YN			  = 'Y'
  JOIN BSC_KPI_POOL bkp    ON bkp.KPI_POOL_REF_ID	  = bki.KPI_POOL_REF_ID
					      AND bkp.USE_YN			  = 'Y'
  JOIN BSC_KPI_RESULT bkr2 ON bkr2.ESTTERM_REF_ID	  = bkr.ESTTERM_REF_ID-1
						  AND bkr2.KPI_REF_ID		  = bkr.KPI_REF_ID
						  AND SUBSTRING(bkr2.YMD,5,6) = SUBSTRING(bkr.YMD,5,6)
  JOIN BSC_KPI_TARGET bkt  ON bkt.ESTTERM_REF_ID      = bkr.ESTTERM_REF_ID
			              AND bkt.KPI_REF_ID	      = bkr.KPI_REF_ID
			              AND bkt.YMD	              = bkr.YMD				
WHERE (bkr.ESTTERM_REF_ID  = @ESTTERM_REF_ID	    OR @ESTTERM_REF_ID =0)
   AND (bkr.KPI_REF_ID	    = @KPI_REF_ID_12		OR @KPI_REF_ID_12=0)
   AND (bkr.YMD			    = @YMD					OR @YMD=N'')




";



            IDbDataParameter[] paramArray = CreateDataParameters(2);

            paramArray[0] = CreateDataParameter("@ESTTERM_REF_ID", SqlDbType.Int);
            paramArray[0].Value = estterm_ref_id;
            paramArray[1] = CreateDataParameter("@YMD", SqlDbType.NVarChar);
            paramArray[1].Value = ymd;
            //paramArray[2] 		= CreateDataParameter("@KPI_REF_ID_01", SqlDbType.Int);
            //paramArray[2].Value = kpi_id_01;
            //paramArray[3] 		= CreateDataParameter("@KPI_REF_ID_02", SqlDbType.Int);
            //paramArray[3].Value = kpi_id_02;
            //paramArray[4] 		= CreateDataParameter("@KPI_REF_ID_03", SqlDbType.Int);
            //paramArray[4].Value = kpi_id_03;
            //paramArray[5] 		= CreateDataParameter("@KPI_REF_ID_04", SqlDbType.Int);
            //paramArray[5].Value = kpi_id_04;

            DataSet ds = DbAgentObj.FillDataSet(query_old, "DATA", null, paramArray, CommandType.Text);
            return ds;
        }



        #endregion

    }
}
